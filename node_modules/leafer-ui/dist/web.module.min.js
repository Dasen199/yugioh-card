const t={toURL(t,e){let i=encodeURIComponent(t);return"text"===e?i="data:text/plain;charset=utf-8,"+i:"svg"===e&&(i="data:image/svg+xml,"+i),i},image:{hitCanvasSize:100,maxCacheSize:4096e3,maxPatternSize:8847360,crossOrigin:"anonymous",getRealURL(e){const{prefix:i,suffix:s}=t.image;return!s||e.startsWith("data:")||e.startsWith("blob:")||(e+=(e.includes("?")?"&":"?")+s),i&&"/"===e[0]&&(e=i+e),e}}},e={},i={RUNTIME:"runtime",LEAF:"leaf",TASK:"task",CNAVAS:"canvas",IMAGE:"image",types:{},create(t){const{types:e}=s;return e[t]?e[t]++:(e[t]=1,0)}},s=i,{round:n,pow:o,PI:r}=Math,a={within:(t,e,i)=>("object"==typeof e&&(i=e.max,e=e.min),void 0!==e&&t<e&&(t=e),void 0!==i&&t>i&&(t=i),t),fourNumber(t,e){let i;if(t instanceof Array)switch(t.length){case 4:i=void 0===e?t:[...t];break;case 2:i=[t[0],t[1],t[0],t[1]];break;case 3:i=[t[0],t[1],t[2],t[1]];break;case 1:t=t[0];break;default:t=0}if(i||(i=[t,t,t,t]),e)for(let t=0;t<4;t++)i[t]>e&&(i[t]=e);return i},formatRotation:(t,e)=>(t%=360,e?t<0&&(t+=360):(t>180&&(t-=360),t<-180&&(t+=360)),a.float(t)),getGapRotation(t,e,i=0){let s=t+i;if(e>1){const t=Math.abs(s%e);(t<1||t>e-1)&&(s=Math.round(s/e)*e)}return s-i},float(t,e){const i=e?o(10,e):1e12;return-0===(t=n(t*i)/i)?0:t},getScaleData:(t,e,i,s)=>(s||(s={}),e?(s.scaleX=("number"==typeof e?e:e.width)/i.width,s.scaleY=("number"==typeof e?e:e.height)/i.height):t&&a.assignScale(s,t),s),assignScale(t,e){"number"==typeof e?t.scaleX=t.scaleY=e:(t.scaleX=e.x,t.scaleY=e.y)}},h=r/180,l=2*r,d=r/2;function c(){return{x:0,y:0}}function u(){return{x:0,y:0,width:0,height:0}}function _(){return{a:1,b:0,c:0,d:1,e:0,f:0}}const{sin:p,cos:g,acos:f,sqrt:y}=Math,{float:m}=a,v={};function w(){return Object.assign(Object.assign(Object.assign({},{a:1,b:0,c:0,d:1,e:0,f:0}),{x:0,y:0,width:0,height:0}),{scaleX:1,scaleY:1,rotation:0,skewX:0,skewY:0})}const x={defaultMatrix:{a:1,b:0,c:0,d:1,e:0,f:0},defaultWorld:w(),tempMatrix:{},set(t,e=1,i=0,s=0,n=1,o=0,r=0){t.a=e,t.b=i,t.c=s,t.d=n,t.e=o,t.f=r},get:_,getWorld:w,copy(t,e){t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t.e=e.e,t.f=e.f},translate(t,e,i){t.e+=e,t.f+=i},translateInner(t,e,i,s){t.e+=t.a*e+t.c*i,t.f+=t.b*e+t.d*i,s&&(t.e-=e,t.f-=i)},scale(t,e,i=e){t.a*=e,t.b*=e,t.c*=i,t.d*=i},scaleOfOuter(t,e,i,s){b.toInnerPoint(t,e,v),b.scaleOfInner(t,v,i,s)},scaleOfInner(t,e,i,s=i){b.translateInner(t,e.x,e.y),b.scale(t,i,s),b.translateInner(t,-e.x,-e.y)},rotate(t,e){const{a:i,b:s,c:n,d:o}=t,r=g(e*=h),a=p(e);t.a=i*r-s*a,t.b=i*a+s*r,t.c=n*r-o*a,t.d=n*a+o*r},rotateOfOuter(t,e,i){b.toInnerPoint(t,e,v),b.rotateOfInner(t,v,i)},rotateOfInner(t,e,i){b.translateInner(t,e.x,e.y),b.rotate(t,i),b.translateInner(t,-e.x,-e.y)},skew(t,e,i){const{a:s,b:n,c:o,d:r}=t;i&&(i*=h,t.a=s+o*i,t.b=n+r*i),e&&(e*=h,t.c=o+s*e,t.d=r+n*e)},skewOfOuter(t,e,i,s){b.toInnerPoint(t,e,v),b.skewOfInner(t,v,i,s)},skewOfInner(t,e,i,s=0){b.translateInner(t,e.x,e.y),b.skew(t,i,s),b.translateInner(t,-e.x,-e.y)},multiply(t,e){const{a:i,b:s,c:n,d:o,e:r,f:a}=t;t.a=e.a*i+e.b*n,t.b=e.a*s+e.b*o,t.c=e.c*i+e.d*n,t.d=e.c*s+e.d*o,t.e=e.e*i+e.f*n+r,t.f=e.e*s+e.f*o+a},multiplyParent(t,e,i,s,n,o){let{e:r,f:a}=t;if(o&&(r+=o.scrollX,a+=o.scrollY),i||(i=t),void 0===s&&(s=1!==t.a||t.b||t.c||1!==t.d),s){const{a:s,b:o,c:r,d:a}=t;i.a=s*e.a+o*e.c,i.b=s*e.b+o*e.d,i.c=r*e.a+a*e.c,i.d=r*e.b+a*e.d,n&&(i.scaleX=e.scaleX*n.scaleX,i.scaleY=e.scaleY*n.scaleY)}else i.a=e.a,i.b=e.b,i.c=e.c,i.d=e.d,n&&(i.scaleX=e.scaleX,i.scaleY=e.scaleY);i.e=r*e.a+a*e.c+e.e,i.f=r*e.b+a*e.d+e.f},divide(t,e){b.multiply(t,b.tempInvert(e))},divideParent(t,e){b.multiplyParent(t,b.tempInvert(e))},tempInvert(t){const{tempMatrix:e}=b;return b.copy(e,t),b.invert(e),e},invert(t){const{a:e,b:i,c:s,d:n,e:o,f:r}=t;if(i||s){const a=1/(e*n-i*s);t.a=n*a,t.b=-i*a,t.c=-s*a,t.d=e*a,t.e=-(o*n-r*s)*a,t.f=-(r*e-o*i)*a}else if(1===e&&1===n)t.e=-o,t.f=-r;else{const i=1/(e*n);t.a=n*i,t.d=e*i,t.e=-o*n*i,t.f=-r*e*i}},toOuterPoint(t,e,i,s){const{x:n,y:o}=e;i||(i=e),i.x=n*t.a+o*t.c,i.y=n*t.b+o*t.d,s||(i.x+=t.e,i.y+=t.f)},toInnerPoint(t,e,i,s){const{a:n,b:o,c:r,d:a}=t,h=1/(n*a-o*r),{x:l,y:d}=e;if(i||(i=e),i.x=(l*a-d*r)*h,i.y=(d*n-l*o)*h,!s){const{e:e,f:s}=t;i.x-=(e*a-s*r)*h,i.y-=(s*n-e*o)*h}},setLayout(t,e,i,s,n){const{x:o,y:r,scaleX:a,scaleY:l}=e;if(void 0===n&&(n=e.rotation||e.skewX||e.skewY),n){const{rotation:i,skewX:s,skewY:n}=e,o=i*h,r=g(o),d=p(o);if(s||n){const e=s*h,i=n*h;t.a=(r+i*-d)*a,t.b=(d+i*r)*a,t.c=(e*r-d)*l,t.d=(r+e*d)*l}else t.a=r*a,t.b=d*a,t.c=-d*l,t.d=r*l}else t.a=a,t.b=0,t.c=0,t.d=l;t.e=o,t.f=r,(i=i||s)&&b.translateInner(t,-i.x,-i.y,!s)},getLayout(t,e,i,s){const{a:n,b:o,c:r,d:a,e:l,f:c}=t;let u,_,v,w,x,b=l,B=c;if(o||r){const t=n*a-o*r;if(r&&!s){u=y(n*n+o*o),_=t/u;const e=n/u;v=o>0?f(e):-f(e)}else{_=y(r*r+a*a),u=t/_;const e=r/_;v=d-(a>0?f(-e):-f(e))}const e=m(g(v)),i=p(v);u=m(u),_=m(_),w=e?m((r/_+i)/e/h,9):0,x=e?m((o/u-i)/e/h,9):0,v=m(v/h)}else u=n,_=a,v=w=x=0;return(e=i||e)&&(b+=e.x*n+e.y*r,B+=e.x*o+e.y*a,i||(b-=e.x,B-=e.y)),{x:b,y:B,scaleX:u,scaleY:_,rotation:v,skewX:w,skewY:x}},withScale(t,e,i=e){const s=t;if(!e||!i){const{a:s,b:n,c:o,d:r}=t;n||o?i=(s*r-n*o)/(e=y(s*s+n*n)):(e=s,i=r)}return s.scaleX=e,s.scaleY=i,s},reset(t){b.set(t)}},b=x,{toInnerPoint:B,toOuterPoint:R}=x,{sin:C,cos:k,abs:E,sqrt:T,atan2:P,min:O,PI:S}=Math,L={defaultPoint:{x:0,y:0},tempPoint:{},tempRadiusPoint:{},set(t,e=0,i=0){t.x=e,t.y=i},setRadius(t,e,i){t.radiusX=e,t.radiusY=void 0===i?e:i},copy(t,e){t.x=e.x,t.y=e.y},copyFrom(t,e,i){t.x=e,t.y=i},move(t,e,i){t.x+=e,t.y+=i},scale(t,e,i=e){t.x&&(t.x*=e),t.y&&(t.y*=i)},scaleOf(t,e,i,s=i){t.x+=(t.x-e.x)*(i-1),t.y+=(t.y-e.y)*(s-1)},rotate(t,e,i){i||(i=D.defaultPoint);const s=k(e*=h),n=C(e),o=t.x-i.x,r=t.y-i.y;t.x=i.x+o*s-r*n,t.y=i.y+o*n+r*s},tempToInnerOf(t,e){const{tempPoint:i}=D;return A(i,t),B(e,i,i),i},tempToOuterOf(t,e){const{tempPoint:i}=D;return A(i,t),R(e,i,i),i},tempToInnerRadiusPointOf(t,e){const{tempRadiusPoint:i}=D;return A(i,t),D.toInnerRadiusPointOf(t,e,i),i},toInnerRadiusPointOf(t,e,i){i||(i=t),B(e,t,i),i.radiusX=Math.abs(t.radiusX/e.scaleX),i.radiusY=Math.abs(t.radiusY/e.scaleY)},toInnerOf(t,e,i){B(e,t,i)},toOuterOf(t,e,i){R(e,t,i)},getCenter:(t,e)=>({x:t.x+(e.x-t.x)/2,y:t.y+(e.y-t.y)/2}),getCenterX:(t,e)=>t+(e-t)/2,getCenterY:(t,e)=>t+(e-t)/2,getDistance:(t,e)=>M(t.x,t.y,e.x,e.y),getDistanceFrom(t,e,i,s){const n=E(i-t),o=E(s-e);return T(n*n+o*o)},getMinDistanceFrom:(t,e,i,s,n,o)=>O(M(t,e,i,s),M(i,s,n,o)),getAngle:(t,e)=>I(t,e)/h,getRotation:(t,e,i,s)=>(s||(s=e),D.getRadianFrom(t.x,t.y,e.x,e.y,i.x,i.y,s.x,s.y)/h),getRadianFrom(t,e,i,s,n,o,r,a){void 0===r&&(r=i,a=s);let h=P(e-s,t-i);const d=P(o-a,n-r)-h;return d<-S?d+l:d},getAtan2:(t,e)=>P(e.y-t.y,e.x-t.x),getDistancePoint(t,e,i,s){const n=I(t,e);return(e=s?e:{}).x=t.x+k(n)*i,e.y=t.y+C(n)*i,e},toNumberPoints(t){let e=t;return"object"==typeof t[0]&&(e=[],t.forEach((t=>e.push(t.x,t.y)))),e},reset(t){D.reset(t)}},D=L,{getDistanceFrom:M,copy:A,getAtan2:I}=D;class W{constructor(t,e){this.set(t,e)}set(t,e){return"object"==typeof t?L.copy(this,t):L.set(this,t,e),this}get(){const{x:t,y:e}=this;return{x:t,y:e}}clone(){return new W(this)}move(t,e){return L.move(this,t,e),this}scale(t,e){return L.scale(this,t,e),this}scaleOf(t,e,i){return L.scaleOf(this,t,e,i),this}rotate(t,e){return L.rotate(this,t,e),this}rotateOf(t,e){return L.rotate(this,e,t),this}getRotation(t,e,i){return L.getRotation(this,t,e,i)}toInnerOf(t,e){return L.toInnerOf(this,t,e),this}toOuterOf(t,e){return L.toOuterOf(this,t,e),this}getCenter(t){return new W(L.getCenter(this,t))}getDistance(t){return L.getDistance(this,t)}getDistancePoint(t,e,i){return new W(L.getDistancePoint(this,t,e,i))}getAngle(t){return L.getAngle(this,t)}getAtan2(t){return L.getAtan2(this,t)}reset(){return L.reset(this),this}}const F=new W;class z{constructor(t,e,i,s,n,o){this.set(t,e,i,s,n,o)}set(t,e,i,s,n,o){return"object"==typeof t?x.copy(this,t):x.set(this,t,e,i,s,n,o),this}setWith(t){return x.copy(this,t),this.scaleX=t.scaleX,this.scaleY=t.scaleY,this}get(){const{a:t,b:e,c:i,d:s,e:n,f:o}=this;return{a:t,b:e,c:i,d:s,e:n,f:o}}clone(){return new z(this)}translate(t,e){return x.translate(this,t,e),this}translateInner(t,e){return x.translateInner(this,t,e),this}scale(t,e){return x.scale(this,t,e),this}scaleWith(t,e){return x.scale(this,t,e),this.scaleX*=t,this.scaleY*=e||t,this}scaleOfOuter(t,e,i){return x.scaleOfOuter(this,t,e,i),this}scaleOfInner(t,e,i){return x.scaleOfInner(this,t,e,i),this}rotate(t){return x.rotate(this,t),this}rotateOfOuter(t,e){return x.rotateOfOuter(this,t,e),this}rotateOfInner(t,e){return x.rotateOfInner(this,t,e),this}skew(t,e){return x.skew(this,t,e),this}skewOfOuter(t,e,i){return x.skewOfOuter(this,t,e,i),this}skewOfInner(t,e,i){return x.skewOfInner(this,t,e,i),this}multiply(t){return x.multiply(this,t),this}multiplyParent(t){return x.multiplyParent(this,t),this}divide(t){return x.divide(this,t),this}divideParent(t){return x.divideParent(this,t),this}invert(){return x.invert(this),this}invertWith(){return x.invert(this),this.scaleX=1/this.scaleX,this.scaleY=1/this.scaleY,this}toOuterPoint(t,e,i){x.toOuterPoint(this,t,e,i)}toInnerPoint(t,e,i){x.toInnerPoint(this,t,e,i)}setLayout(t,e,i){return x.setLayout(this,t,e,i),this}getLayout(t,e,i){return x.getLayout(this,t,e,i)}withScale(t,e){return x.withScale(this,t,e)}reset(){x.reset(this)}}const N=new z,Y={tempPointBounds:{},setPoint(t,e,i){t.minX=t.maxX=e,t.minY=t.maxY=i},addPoint(t,e,i){t.minX=e<t.minX?e:t.minX,t.minY=i<t.minY?i:t.minY,t.maxX=e>t.maxX?e:t.maxX,t.maxY=i>t.maxY?i:t.maxY},addBounds(t,e,i,s,n){X(t,e,i),X(t,e+s,i+n)},copy(t,e){t.minX=e.minX,t.minY=e.minY,t.maxX=e.maxX,t.maxY=e.maxY},addPointBounds(t,e){t.minX=e.minX<t.minX?e.minX:t.minX,t.minY=e.minY<t.minY?e.minY:t.minY,t.maxX=e.maxX>t.maxX?e.maxX:t.maxX,t.maxY=e.maxY>t.maxY?e.maxY:t.maxY},toBounds(t,e){e.x=t.minX,e.y=t.minY,e.width=t.maxX-t.minX,e.height=t.maxY-t.minY}},{addPoint:X}=Y,{tempPointBounds:j,setPoint:H,addPoint:U,toBounds:V}=Y,{toOuterPoint:G}=x,{float:K,fourNumber:q}=a,{floor:Z,ceil:Q}=Math;let J,$,tt,et;const it={},st={},nt={tempBounds:{},set(t,e=0,i=0,s=0,n=0){t.x=e,t.y=i,t.width=s,t.height=n},copy(t,e){t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height},copyAndSpread(t,e,i,s,n){const{x:o,y:r,width:a,height:h}=e;if(i instanceof Array){const e=q(i);s?ot.set(t,o+e[3],r+e[0],a-e[1]-e[3],h-e[2]-e[0]):ot.set(t,o-e[3],r-e[0],a+e[1]+e[3],h+e[2]+e[0])}else s&&(i=-i),ot.set(t,o-i,r-i,a+2*i,h+2*i);n&&("width"===n?(t.y=r,t.height=h):(t.x=o,t.width=a))},minX:t=>t.width>0?t.x:t.x+t.width,minY:t=>t.height>0?t.y:t.y+t.height,maxX:t=>t.width>0?t.x+t.width:t.x,maxY:t=>t.height>0?t.y+t.height:t.y,move(t,e,i){t.x+=e,t.y+=i},getByMove:(t,e,i)=>(t=Object.assign({},t),ot.move(t,e,i),t),toOffsetOutBounds(t,e,i){e?at(e,t):e=t,i?(e.offsetX=-(ot.maxX(i)-t.x),e.offsetY=-(ot.maxY(i)-t.y)):(e.offsetX=t.x+t.width,e.offsetY=t.y+t.height),ot.move(e,-e.offsetX,-e.offsetY)},scale(t,e,i=e){L.scale(t,e,i),t.width*=e,t.height*=i},scaleOf(t,e,i,s=i){L.scaleOf(t,e,i,s),t.width*=i,t.height*=s},tempToOuterOf:(t,e)=>(ot.copy(ot.tempBounds,t),ot.toOuterOf(ot.tempBounds,e),ot.tempBounds),getOuterOf:(t,e)=>(t=Object.assign({},t),ot.toOuterOf(t,e),t),toOuterOf(t,e,i){if(i||(i=t),0===e.b&&0===e.c){const{a:s,d:n}=e;s>0?(i.width=t.width*s,i.x=e.e+t.x*s):(i.width=t.width*-s,i.x=e.e+t.x*s-i.width),n>0?(i.height=t.height*n,i.y=e.f+t.y*n):(i.height=t.height*-n,i.y=e.f+t.y*n-i.height)}else it.x=t.x,it.y=t.y,G(e,it,st),H(j,st.x,st.y),it.x=t.x+t.width,G(e,it,st),U(j,st.x,st.y),it.y=t.y+t.height,G(e,it,st),U(j,st.x,st.y),it.x=t.x,G(e,it,st),U(j,st.x,st.y),V(j,i)},toInnerOf(t,e,i){i||(i=t),ot.move(i,-e.e,-e.f),ot.scale(i,1/e.a,1/e.d)},getFitMatrix(t,e,i=1){const s=Math.min(i,Math.min(t.width/e.width,t.height/e.height));return new z(s,0,0,s,-e.x*s,-e.y*s)},getSpread(t,e,i){const s={};return ot.copyAndSpread(s,t,e,!1,i),s},spread(t,e,i){ot.copyAndSpread(t,t,e,!1,i)},shrink(t,e,i){ot.copyAndSpread(t,t,e,!0,i)},ceil(t){const{x:e,y:i}=t;t.x=Z(t.x),t.y=Z(t.y),t.width=e>t.x?Q(t.width+e-t.x):Q(t.width),t.height=i>t.y?Q(t.height+i-t.y):Q(t.height)},unsign(t){t.width<0&&(t.x+=t.width,t.width=-t.width),t.height<0&&(t.y+=t.height,t.height=-t.height)},float(t,e){t.x=K(t.x,e),t.y=K(t.y,e),t.width=K(t.width,e),t.height=K(t.height,e)},add(t,e,i){J=t.x+t.width,$=t.y+t.height,tt=e.x,et=e.y,i||(tt+=e.width,et+=e.height),J=J>tt?J:tt,$=$>et?$:et,t.x=t.x<e.x?t.x:e.x,t.y=t.y<e.y?t.y:e.y,t.width=J-t.x,t.height=$-t.y},addList(t,e){ot.setListWithFn(t,e,void 0,!0)},setList(t,e,i=!1){ot.setListWithFn(t,e,void 0,i)},addListWithFn(t,e,i){ot.setListWithFn(t,e,i,!0)},setListWithFn(t,e,i,s=!1){let n,o=!0;for(let r=0,a=e.length;r<a;r++)n=i?i(e[r]):e[r],n&&(n.width||n.height)&&(o?(o=!1,s||at(t,n)):rt(t,n));o&&ot.reset(t)},setPoints(t,e){e.forEach(((t,e)=>0===e?H(j,t.x,t.y):U(j,t.x,t.y))),V(j,t)},setPoint(t,e){ot.set(t,e.x,e.y)},addPoint(t,e){rt(t,e,!0)},getPoints(t){const{x:e,y:i,width:s,height:n}=t;return[{x:e,y:i},{x:e+s,y:i},{x:e+s,y:i+n},{x:e,y:i+n}]},hitRadiusPoint:(t,e,i)=>(i&&(e=L.tempToInnerRadiusPointOf(e,i)),e.x>=t.x-e.radiusX&&e.x<=t.x+t.width+e.radiusX&&e.y>=t.y-e.radiusY&&e.y<=t.y+t.height+e.radiusY),hitPoint:(t,e,i)=>(i&&(e=L.tempToInnerOf(e,i)),e.x>=t.x&&e.x<=t.x+t.width&&e.y>=t.y&&e.y<=t.y+t.height),hit:(t,e,i)=>(i&&(e=ot.tempToOuterOf(e,i)),!(t.y+t.height<e.y||e.y+e.height<t.y||t.x+t.width<e.x||e.x+e.width<t.x)),includes:(t,e,i)=>(i&&(e=ot.tempToOuterOf(e,i)),t.x<=e.x&&t.y<=e.y&&t.x+t.width>=e.x+e.width&&t.y+t.height>=e.y+e.height),getIntersectData(t,e,i){if(i&&(e=ot.tempToOuterOf(e,i)),!ot.hit(t,e))return{x:0,y:0,width:0,height:0};let{x:s,y:n,width:o,height:r}=e;return J=s+o,$=n+r,tt=t.x+t.width,et=t.y+t.height,s=s>t.x?s:t.x,n=n>t.y?n:t.y,J=J<tt?J:tt,$=$<et?$:et,o=J-s,r=$-n,{x:s,y:n,width:o,height:r}},intersect(t,e,i){ot.copy(t,ot.getIntersectData(t,e,i))},isSame:(t,e)=>t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height,isEmpty:t=>0===t.x&&0===t.y&&0===t.width&&0===t.height,reset(t){ot.set(t)}},ot=nt,{add:rt,copy:at}=ot;class ht{get minX(){return nt.minX(this)}get minY(){return nt.minY(this)}get maxX(){return nt.maxX(this)}get maxY(){return nt.maxY(this)}constructor(t,e,i,s){this.set(t,e,i,s)}set(t,e,i,s){return"object"==typeof t?nt.copy(this,t):nt.set(this,t,e,i,s),this}get(){const{x:t,y:e,width:i,height:s}=this;return{x:t,y:e,width:i,height:s}}clone(){return new ht(this)}move(t,e){return nt.move(this,t,e),this}scale(t,e){return nt.scale(this,t,e),this}scaleOf(t,e,i){return nt.scaleOf(this,t,e,i),this}toOuterOf(t,e){return nt.toOuterOf(this,t,e),this}toInnerOf(t,e){return nt.toInnerOf(this,t,e),this}getFitMatrix(t,e){return nt.getFitMatrix(this,t,e)}spread(t,e){return nt.spread(this,t,e),this}shrink(t,e){return nt.shrink(this,t,e),this}ceil(){return nt.ceil(this),this}unsign(){return nt.unsign(this),this}float(t){return nt.float(this,t),this}add(t){return nt.add(this,t),this}addList(t){return nt.setList(this,t,!0),this}setList(t){return nt.setList(this,t),this}addListWithFn(t,e){return nt.setListWithFn(this,t,e,!0),this}setListWithFn(t,e){return nt.setListWithFn(this,t,e),this}setPoint(t){return nt.setPoint(this,t),this}setPoints(t){return nt.setPoints(this,t),this}addPoint(t){return nt.addPoint(this,t),this}getPoints(){return nt.getPoints(this)}hitPoint(t,e){return nt.hitPoint(this,t,e)}hitRadiusPoint(t,e){return nt.hitRadiusPoint(this,t,e)}hit(t,e){return nt.hit(this,t,e)}includes(t,e){return nt.includes(this,t,e)}intersect(t,e){return nt.intersect(this,t,e),this}getIntersect(t,e){return new ht(nt.getIntersectData(this,t,e))}isSame(t){return nt.isSame(this,t)}isEmpty(){return nt.isEmpty(this)}reset(){nt.reset(this)}}const lt=new ht;class dt{constructor(t,e,i,s,n,o){"object"==typeof t?this.copy(t):this.set(t,e,i,s,n,o)}set(t=0,e=0,i=0,s=0,n=0,o=0){this.top=t,this.right=e,this.bottom=i,this.left=s,this.width=n,this.height=o}copy(t){const{top:e,right:i,bottom:s,left:n,width:o,height:r}=t;this.set(e,i,s,n,o,r)}getBoundsFrom(t){const{top:e,right:i,bottom:s,left:n,width:o,height:r}=this;return new ht(n,e,o||t.width-n-i,r||t.height-e-s)}}var ct,ut;!function(t){t[t.top=0]="top",t[t.right=1]="right",t[t.bottom=2]="bottom",t[t.left=3]="left"}(ct||(ct={})),function(t){t[t.topLeft=0]="topLeft",t[t.top=1]="top",t[t.topRight=2]="topRight",t[t.right=3]="right",t[t.bottomRight=4]="bottomRight",t[t.bottom=5]="bottom",t[t.bottomLeft=6]="bottomLeft",t[t.left=7]="left",t[t.center=8]="center",t[t["top-left"]=0]="top-left",t[t["top-right"]=2]="top-right",t[t["bottom-right"]=4]="bottom-right",t[t["bottom-left"]=6]="bottom-left"}(ut||(ut={}));const _t=[{x:0,y:0},{x:.5,y:0},{x:1,y:0},{x:1,y:.5},{x:1,y:1},{x:.5,y:1},{x:0,y:1},{x:0,y:.5},{x:.5,y:.5}];_t.forEach((t=>t.type="percent"));const pt={directionData:_t,tempPoint:{},get:gt,toPoint(t,e,i,s,n){const o=gt(t);i.x=o.x,i.y=o.y,"percent"===o.type&&(i.x*=e.width,i.y*=e.height,n&&(i.x-=n.x,i.y-=n.y,o.x&&(i.x-=1===o.x?n.width:.5===o.x?o.x*n.width:0),o.y&&(i.y-=1===o.y?n.height:.5===o.y?o.y*n.height:0))),s||(i.x+=e.x,i.y+=e.y)}};function gt(t){return"string"==typeof t?_t[ut[t]]:t}const{toPoint:ft}=pt,yt={toPoint(t,e,i,s,n){ft(t,i,s,n,e)}},mt={0:1,1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1,".":1,e:1,E:1};class vt{constructor(t){this.repeatMap={},this.name=t}static get(t){return new vt(t)}static set filter(t){this.filterList=wt(t)}static set exclude(t){this.excludeList=wt(t)}log(...t){if(xt.enable){if(xt.filterList.length&&xt.filterList.every((t=>t!==this.name)))return;if(xt.excludeList.length&&xt.excludeList.some((t=>t===this.name)))return;console.log("%c"+this.name,"color:#21ae62",...t)}}tip(...t){xt.enable&&this.warn(...t)}warn(...t){xt.showWarn&&console.warn(this.name,...t)}repeat(t,...e){this.repeatMap[t]||(this.warn("repeat:"+t,...e),this.repeatMap[t]=!0)}error(...t){try{throw new Error}catch(e){console.error(this.name,...t,e)}}}function wt(t){return t?"string"==typeof t&&(t=[t]):t=[],t}vt.filterList=[],vt.excludeList=[],vt.showWarn=!0;const xt=vt,bt=vt.get("RunTime"),Bt={currentId:0,currentName:"",idMap:{},nameMap:{},nameToIdMap:{},start(t,e){const s=i.create(i.RUNTIME);return Rt.currentId=Rt.idMap[s]=e?performance.now():Date.now(),Rt.currentName=Rt.nameMap[s]=t,Rt.nameToIdMap[t]=s,s},end(t,e){const i=Rt.idMap[t],s=Rt.nameMap[t],n=e?(performance.now()-i)/1e3:Date.now()-i;Rt.idMap[t]=Rt.nameMap[t]=Rt.nameToIdMap[s]=void 0,bt.log(s,n,"ms")},endOfName(t,e){const i=Rt.nameToIdMap[t];void 0!==i&&Rt.end(i,e)}},Rt=Bt;function Ct(t){console.error("need plugin: @leafer-in/"+t)}const kt=vt.get("UICreator"),Et={list:{},register(t){const{__tag:e}=t.prototype;Tt[e]?kt.repeat(e):Tt[e]=t},get(t,e,i,s,n,o){const r=new Tt[t](e);return void 0!==i&&(r.x=i,s&&(r.y=s),n&&(r.width=n),o&&(r.height=o)),r}},{list:Tt}=Et,Pt=vt.get("EventCreator"),Ot={nameList:{},register(t){let e;Object.keys(t).forEach((i=>{e=t[i],"string"==typeof e&&(St[e]?Pt.repeat(e):St[e]=t)}))},changeName(t,e){const i=St[t];if(i){const s=Object.keys(i).find((e=>i[e]===t));s&&(i[s]=e,St[e]=i)}},has(t){return!!this.nameList[t]},get:(t,...e)=>new St[t](...e)},{nameList:St}=Ot;class Lt{constructor(){this.list=[]}add(t){t.manager=this,this.list.push(t)}get(t){let i;const{list:s}=this;for(let e=0,n=s.length;e<n;e++)if(i=s[e],i.recycled&&i.isSameSize(t))return i.recycled=!1,i.manager||(i.manager=this),i;const n=e.canvas(t);return this.add(n),n}recycle(t){t.recycled=!0}clearRecycled(){let t;const e=[];for(let i=0,s=this.list.length;i<s;i++)t=this.list[i],t.recycled?t.destroy():e.push(t);this.list=e}clear(){this.list.forEach((t=>{t.destroy()})),this.list.length=0}destroy(){this.clear()}}const Dt={default:(t,e)=>(Mt(e,t),Mt(t,e),t),assign(t,e){let i;Object.keys(e).forEach((s=>{var n;i=e[s],(null==i?void 0:i.constructor)===Object&&(null===(n=t[s])||void 0===n?void 0:n.constructor)===Object?Mt(t[s],e[s]):t[s]=e[s]}))},copyAttrs:(t,e,i)=>(i.forEach((i=>{void 0!==e[i]&&(t[i]=e[i])})),t),clone:t=>JSON.parse(JSON.stringify(t)),toMap(t){const e={};for(let i=0,s=t.length;i<s;i++)e[t[i]]=!0;return e}},{assign:Mt}=Dt;class At{get __useNaturalRatio(){return!0}get __isLinePath(){const{path:t}=this;return t&&6===t.length&&1===t[0]}get __blendMode(){if(this.eraser&&"path"!==this.eraser)return"destination-out";const{blendMode:t}=this;return"pass-through"===t?null:t}constructor(t){this.__leaf=t}__get(t){if(this.__input){const e=this.__input[t];if(void 0!==e)return e}return this[t]}__getData(){const t={tag:this.__leaf.tag},{__input:e}=this;let i;for(let s in this)"_"!==s[0]&&(i=e?e[s]:void 0,t[s]=void 0===i?this[s]:i);return t}__setInput(t,e){this.__input||(this.__input={}),this.__input[t]=e}__getInput(t){if(this.__input){const e=this.__input[t];if(void 0!==e)return e}if("path"!==t||this.__pathInputed)return this["_"+t]}__removeInput(t){this.__input&&void 0!==this.__input[t]&&(this.__input[t]=void 0)}__getInputData(t,e){const i={};if(t)if(t instanceof Array)for(let e of t)i[e]=this.__getInput(e);else for(let e in t)i[e]=this.__getInput(e);else{let t,e,{__input:s}=this;i.tag=this.__leaf.tag;for(let n in this)if("_"!==n[0]&&(t=this["_"+n],void 0!==t)){if("path"===n&&!this.__pathInputed)continue;e=s?s[n]:void 0,i[n]=void 0===e?t:e}}if(e&&e.matrix){const{a:t,b:e,c:s,d:n,e:o,f:r}=this.__leaf.__localMatrix;i.matrix={a:t,b:e,c:s,d:n,e:o,f:r}}return i}__setMiddle(t,e){this.__middle||(this.__middle={}),this.__middle[t]=e}__getMiddle(t){return this.__middle&&this.__middle[t]}__checkSingle(){const t=this;if("pass-through"===t.blendMode){const e=this.__leaf;t.opacity<1&&e.isBranch||e.__hasEraser||t.eraser?t.__single=!0:t.__single&&(t.__single=!1)}else t.__single=!0}__removeNaturalSize(){this.__naturalWidth=this.__naturalHeight=void 0}destroy(){this.__input=this.__middle=null}}var It;!function(t){t[t.No=0]="No",t[t.Yes=1]="Yes",t[t.NoAndSkip=2]="NoAndSkip",t[t.YesAndSkip=3]="YesAndSkip"}(It||(It={}));const Wt={};function Ft(t){return null==t}function zt(t,e,i,s){var n,o=arguments.length,r=o<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(r=(o<3?n(r):o>3?n(e,i,r):n(e,i))||r);return o>3&&r&&Object.defineProperty(e,i,r),r}function Nt(t,e,i,s){return new(i||(i=Promise))((function(n,o){function r(t){try{h(s.next(t))}catch(t){o(t)}}function a(t){try{h(s.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}h((s=s.apply(t,e||[])).next())}))}function Yt(t){return(e,i)=>{t||(t=i),Object.defineProperty(e,i,{get(){return this.context[t]},set(e){this.context[t]=e}})}}"function"==typeof SuppressedError&&SuppressedError;const Xt=[];function jt(){return(t,e)=>{Xt.push(e)}}const Ht=[];let Ut=class{set blendMode(t){"normal"===t&&(t="source-over"),this.context.globalCompositeOperation=t}get blendMode(){return this.context.globalCompositeOperation}set dashPattern(t){this.context.setLineDash(t||Ht)}get dashPattern(){return this.context.getLineDash()}__bindContext(){let t;Xt.forEach((e=>{t=this.context[e],t&&(this[e]=t.bind(this.context))})),this.textBaseline="alphabetic"}setTransform(t,e,i,s,n,o){}resetTransform(){}getTransform(){}save(){}restore(){}transform(t,e,i,s,n,o){"object"==typeof t?this.context.transform(t.a,t.b,t.c,t.d,t.e,t.f):this.context.transform(t,e,i,s,n,o)}translate(t,e){}scale(t,e){}rotate(t){}fill(t,e){}stroke(t){}clip(t,e){}fillRect(t,e,i,s){}strokeRect(t,e,i,s){}clearRect(t,e,i,s){}drawImage(t,e,i,s,n,o,r,a,h){switch(arguments.length){case 9:if(e<0){const t=-e/s*a;s+=e,e=0,o+=t,a-=t}if(i<0){const t=-i/n*h;n+=i,i=0,r+=t,h-=t}this.context.drawImage(t,e,i,s,n,o,r,a,h);break;case 5:this.context.drawImage(t,e,i,s,n);break;case 3:this.context.drawImage(t,e,i)}}beginPath(){}moveTo(t,e){}lineTo(t,e){}bezierCurveTo(t,e,i,s,n,o){}quadraticCurveTo(t,e,i,s){}closePath(){}arc(t,e,i,s,n,o){}arcTo(t,e,i,s,n){}ellipse(t,e,i,s,n,o,r,a){}rect(t,e,i,s){}roundRect(t,e,i,s,n){}createConicGradient(t,e,i){}createLinearGradient(t,e,i,s){}createPattern(t,e){}createRadialGradient(t,e,i,s,n,o){}fillText(t,e,i,s){}measureText(t){}strokeText(t,e,i,s){}destroy(){this.context=null}};zt([Yt("imageSmoothingEnabled")],Ut.prototype,"smooth",void 0),zt([Yt("imageSmoothingQuality")],Ut.prototype,"smoothLevel",void 0),zt([Yt("globalAlpha")],Ut.prototype,"opacity",void 0),zt([Yt()],Ut.prototype,"fillStyle",void 0),zt([Yt()],Ut.prototype,"strokeStyle",void 0),zt([Yt("lineWidth")],Ut.prototype,"strokeWidth",void 0),zt([Yt("lineCap")],Ut.prototype,"strokeCap",void 0),zt([Yt("lineJoin")],Ut.prototype,"strokeJoin",void 0),zt([Yt("lineDashOffset")],Ut.prototype,"dashOffset",void 0),zt([Yt()],Ut.prototype,"miterLimit",void 0),zt([Yt()],Ut.prototype,"shadowBlur",void 0),zt([Yt()],Ut.prototype,"shadowColor",void 0),zt([Yt()],Ut.prototype,"shadowOffsetX",void 0),zt([Yt()],Ut.prototype,"shadowOffsetY",void 0),zt([Yt()],Ut.prototype,"filter",void 0),zt([Yt()],Ut.prototype,"font",void 0),zt([Yt()],Ut.prototype,"fontKerning",void 0),zt([Yt()],Ut.prototype,"fontStretch",void 0),zt([Yt()],Ut.prototype,"fontVariantCaps",void 0),zt([Yt()],Ut.prototype,"textAlign",void 0),zt([Yt()],Ut.prototype,"textBaseline",void 0),zt([Yt()],Ut.prototype,"textRendering",void 0),zt([Yt()],Ut.prototype,"wordSpacing",void 0),zt([Yt()],Ut.prototype,"letterSpacing",void 0),zt([Yt()],Ut.prototype,"direction",void 0),zt([jt()],Ut.prototype,"setTransform",null),zt([jt()],Ut.prototype,"resetTransform",null),zt([jt()],Ut.prototype,"getTransform",null),zt([jt()],Ut.prototype,"save",null),zt([jt()],Ut.prototype,"restore",null),zt([jt()],Ut.prototype,"translate",null),zt([jt()],Ut.prototype,"scale",null),zt([jt()],Ut.prototype,"rotate",null),zt([jt()],Ut.prototype,"fill",null),zt([jt()],Ut.prototype,"stroke",null),zt([jt()],Ut.prototype,"clip",null),zt([jt()],Ut.prototype,"fillRect",null),zt([jt()],Ut.prototype,"strokeRect",null),zt([jt()],Ut.prototype,"clearRect",null),zt([jt()],Ut.prototype,"beginPath",null),zt([jt()],Ut.prototype,"moveTo",null),zt([jt()],Ut.prototype,"lineTo",null),zt([jt()],Ut.prototype,"bezierCurveTo",null),zt([jt()],Ut.prototype,"quadraticCurveTo",null),zt([jt()],Ut.prototype,"closePath",null),zt([jt()],Ut.prototype,"arc",null),zt([jt()],Ut.prototype,"arcTo",null),zt([jt()],Ut.prototype,"ellipse",null),zt([jt()],Ut.prototype,"rect",null),zt([jt()],Ut.prototype,"roundRect",null),zt([jt()],Ut.prototype,"createConicGradient",null),zt([jt()],Ut.prototype,"createLinearGradient",null),zt([jt()],Ut.prototype,"createPattern",null),zt([jt()],Ut.prototype,"createRadialGradient",null),zt([jt()],Ut.prototype,"fillText",null),zt([jt()],Ut.prototype,"measureText",null),zt([jt()],Ut.prototype,"strokeText",null);const{copy:Vt}=x,Gt={width:1,height:1,pixelRatio:1},Kt=["width","height","pixelRatio"];class qt extends Ut{get width(){return this.size.width}get height(){return this.size.height}get pixelRatio(){return this.size.pixelRatio}get pixelWidth(){return this.width*this.pixelRatio}get pixelHeight(){return this.height*this.pixelRatio}get allowBackgroundColor(){return this.view&&this.parentView}constructor(e,s){super(),this.size={},this.worldTransform={},e||(e=Gt),e.pixelRatio||(e.pixelRatio=t.devicePixelRatio),this.manager=s,this.innerId=i.create(i.CNAVAS);const{width:n,height:o,pixelRatio:r}=e;this.autoLayout=!n||!o,this.size.pixelRatio=r,this.config=e,this.init()}init(){}__createContext(){const{view:t}=this,{contextSettings:e}=this.config;this.context=e?t.getContext("2d",e):t.getContext("2d"),this.__bindContext()}export(t,e){}toBlob(t,e){}toDataURL(t,e){}saveAs(t,e){}resize(t){if(this.isSameSize(t))return;let e;this.context&&!this.unreal&&this.width&&(e=this.getSameCanvas(),e.copyWorld(this)),Dt.copyAttrs(this.size,t,Kt),this.size.pixelRatio||(this.size.pixelRatio=1),this.bounds=new ht(0,0,this.width,this.height),this.context&&!this.unreal&&(this.updateViewSize(),this.smooth=this.config.smooth),this.updateClientBounds(),this.context&&!this.unreal&&e&&(this.clearWorld(e.bounds),this.copyWorld(e),e.recycle())}updateViewSize(){}updateClientBounds(){}getClientBounds(t){return t&&this.updateClientBounds(),this.clientBounds||this.bounds}startAutoLayout(t,e){}stopAutoLayout(){}setCursor(t){}setWorld(t,e){const{pixelRatio:i}=this,s=this.worldTransform;if(e){const{a:n,b:o,c:r,d:a,e:h,f:l}=e;this.setTransform(s.a=(t.a*n+t.b*r)*i,s.b=(t.a*o+t.b*a)*i,s.c=(t.c*n+t.d*r)*i,s.d=(t.c*o+t.d*a)*i,s.e=(t.e*n+t.f*r+h)*i,s.f=(t.e*o+t.f*a+l)*i)}else this.setTransform(s.a=t.a*i,s.b=t.b*i,s.c=t.c*i,s.d=t.d*i,s.e=t.e*i,s.f=t.f*i)}useWorldTransform(t){t&&(this.worldTransform=t);const e=this.worldTransform;e&&this.setTransform(e.a,e.b,e.c,e.d,e.e,e.f)}setStroke(t,e,i){e&&(this.strokeWidth=e),t&&(this.strokeStyle=t),i&&this.setStrokeOptions(i)}setStrokeOptions(t){this.strokeCap="none"===t.strokeCap?"butt":t.strokeCap,this.strokeJoin=t.strokeJoin,this.dashPattern=t.dashPattern,this.dashOffset=t.dashOffset,this.miterLimit=t.miterLimit}saveBlendMode(t){this.savedBlendMode=this.blendMode,this.blendMode=t}restoreBlendMode(){this.blendMode=this.savedBlendMode}hitFill(t,e){return!0}hitStroke(t,e){return!0}hitPixel(t,e,i=1){return!0}setWorldShadow(t,e,i,s){const{pixelRatio:n}=this;this.shadowOffsetX=t*n,this.shadowOffsetY=e*n,this.shadowBlur=i*n,this.shadowColor=s||"black"}setWorldBlur(t){const{pixelRatio:e}=this;this.filter=`blur(${t*e}px)`}copyWorld(t,e,i,s){if(s&&(this.blendMode=s),e){const{pixelRatio:s}=this;i||(i=e),this.drawImage(t.view,e.x*s,e.y*s,e.width*s,e.height*s,i.x*s,i.y*s,i.width*s,i.height*s)}else this.drawImage(t.view,0,0);s&&(this.blendMode="source-over")}copyWorldToInner(t,e,i,s){if(s&&(this.blendMode=s),e.b||e.c)this.save(),this.resetTransform(),this.copyWorld(t,e,nt.tempToOuterOf(i,e)),this.restore();else{const{pixelRatio:s}=this;this.drawImage(t.view,e.x*s,e.y*s,e.width*s,e.height*s,i.x,i.y,i.width,i.height)}s&&(this.blendMode="source-over")}copyWorldByReset(t,e,i,s,n){this.resetTransform(),this.copyWorld(t,e,i,s),n||this.useWorldTransform()}useMask(t,e,i){this.copyWorld(t,e,i,"destination-in")}useEraser(t,e,i){this.copyWorld(t,e,i,"destination-out")}fillWorld(t,e,i){i&&(this.blendMode=i),this.fillStyle=e,lt.set(t).scale(this.pixelRatio),this.fillRect(lt.x,lt.y,lt.width,lt.height),i&&(this.blendMode="source-over")}strokeWorld(t,e,i){i&&(this.blendMode=i),this.strokeStyle=e,lt.set(t).scale(this.pixelRatio),this.strokeRect(lt.x,lt.y,lt.width,lt.height),i&&(this.blendMode="source-over")}clearWorld(t,e){lt.set(t).scale(this.pixelRatio),e&&lt.ceil(),this.clearRect(lt.x,lt.y,lt.width,lt.height)}clipWorld(t,e){this.beginPath(),lt.set(t).scale(this.pixelRatio),e&&lt.ceil(),this.rect(lt.x,lt.y,lt.width,lt.height),this.clip()}clear(){const{pixelRatio:t}=this;this.clearRect(0,0,this.width*t+2,this.height*t+2)}isSameSize(t){return this.width===t.width&&this.height===t.height&&this.pixelRatio===t.pixelRatio}getSameCanvas(t,i){const s=this.manager?this.manager.get(this.size):e.canvas(Object.assign({},this.size));return s.save(),t&&(Vt(s.worldTransform,this.worldTransform),s.useWorldTransform()),i&&(s.smooth=this.smooth),s}recycle(t){this.recycled||(this.restore(),t?this.clearWorld(t,!0):this.clear(),this.manager?this.manager.recycle(this):this.destroy())}updateRender(t){}unrealCanvas(){}destroy(){this.manager=this.view=this.parentView=null}}const Zt={creator:{},parse(t,e){},convertToCanvasData(t,e){}},Qt={N:21,D:22,X:23,G:24,F:25,O:26,P:27,U:28},Jt=Object.assign({M:1,m:10,L:2,l:20,H:3,h:30,V:4,v:40,C:5,c:50,S:6,s:60,Q:7,q:70,T:8,t:80,A:9,a:90,Z:11,z:11,R:12},Qt),$t={M:3,m:3,L:3,l:3,H:2,h:2,V:2,v:2,C:7,c:7,S:5,s:5,Q:5,q:5,T:3,t:3,A:8,a:8,Z:1,z:1,N:5,D:9,X:6,G:9,F:5,O:7,P:4,U:6},te={m:10,l:20,H:3,h:30,V:4,v:40,c:50,S:6,s:60,q:70,T:8,t:80,A:9,a:90},ee=Object.assign(Object.assign({},te),Qt),ie=Jt,se={};for(let t in ie)se[ie[t]]=t;const ne={};for(let t in ie)ne[ie[t]]=$t[t];const oe={drawRoundRect(t,e,i,s,n,o){const r=a.fourNumber(o,Math.min(s/2,n/2)),h=e+s,l=i+n;r[0]?t.moveTo(e+r[0],i):t.moveTo(e,i),r[1]?t.arcTo(h,i,h,l,r[1]):t.lineTo(h,i),r[2]?t.arcTo(h,l,e,l,r[2]):t.lineTo(h,l),r[3]?t.arcTo(e,l,e,i,r[3]):t.lineTo(e,l),r[0]?t.arcTo(e,i,h,i,r[0]):t.lineTo(e,i)}},{sin:re,cos:ae,atan2:he,ceil:le,abs:de,PI:ce,sqrt:ue,pow:_e}=Math,{setPoint:pe,addPoint:ge}=Y,{set:fe,toNumberPoints:ye}=L,{M:me,L:ve,C:we,Q:xe,Z:be}=Jt,Be={},Re={points(t,e,i,s){let n=ye(e);if(t.push(me,n[0],n[1]),i&&n.length>5){let e,o,r,a,h,l,d,c,u,_,p,g,f,y=n.length;const m=!0===i?.5:i;s&&(n=[n[y-2],n[y-1],...n,n[0],n[1],n[2],n[3]],y=n.length);for(let i=2;i<y-2;i+=2)e=n[i-2],o=n[i-1],r=n[i],a=n[i+1],h=n[i+2],l=n[i+3],p=ue(_e(r-e,2)+_e(a-o,2)),g=ue(_e(h-r,2)+_e(l-a,2)),f=p+g,p=m*p/f,g=m*g/f,h-=e,l-=o,d=r-p*h,c=a-p*l,2===i?s||t.push(xe,d,c,r,a):t.push(we,u,_,d,c,r,a),u=r+g*h,_=a+g*l;s||t.push(xe,u,_,n[y-2],n[y-1])}else for(let e=2,i=n.length;e<i;e+=2)t.push(ve,n[e],n[e+1]);s&&t.push(be)},rect(t,e,i,s,n){Zt.creator.path=t,Zt.creator.moveTo(e,i).lineTo(e+s,i).lineTo(e+s,i+n).lineTo(e,i+n).lineTo(e,i)},roundRect(t,e,i,s,n,o){Zt.creator.path=[],oe.drawRoundRect(Zt.creator,e,i,s,n,o),t.push(...Zt.convertToCanvasData(Zt.creator.path,!0))},arcTo(t,e,i,s,n,o,r,a,c,u,_){const p=s-e,g=n-i,f=o-s,y=r-n;let m=he(g,p),v=he(y,f),w=v-m;if(w<0&&(w+=l),w===ce||de(p+g)<1e-12||de(f+y)<1e-12)return t&&t.push(ve,s,n),c&&(pe(c,e,i),ge(c,s,n)),_&&fe(_,e,i),void(u&&fe(u,s,n));const x=p*y-f*g<0,b=x?-1:1,B=a/ae(w/2),R=s+B*ae(m+w/2+d*b),C=n+B*re(m+w/2+d*b);return m-=d*b,v-=d*b,Ee(t,R,C,a,a,0,m/h,v/h,x,c,u,_)},arc:(t,e,i,s,n,o,r,a,h,l)=>Ee(t,e,i,s,s,0,n,o,r,a,h,l),ellipse(t,e,i,s,n,o,r,a,c,u,_,p){const g=o*h,f=re(g),y=ae(g);let m=r*h,v=a*h;m>ce&&(m-=l),v<0&&(v+=l);let w=v-m;w<0?w+=l:w>l&&(w-=l),c&&(w-=l);const x=le(de(w/d)),b=w/x,B=re(b/4),R=8/3*B*B/re(b/2);v=m+b;let C,k,E,T,P,O,S,L,D=ae(m),M=re(m),A=E=y*s*D-f*n*M,I=T=f*s*D+y*n*M,W=e+E,F=i+T;t&&t.push(t.length?ve:me,W,F),u&&pe(u,W,F),p&&fe(p,W,F);for(let o=0;o<x;o++)C=ae(v),k=re(v),E=y*s*C-f*n*k,T=f*s*C+y*n*k,P=e+A-R*(y*s*M+f*n*D),O=i+I-R*(f*s*M-y*n*D),S=e+E+R*(y*s*k+f*n*C),L=i+T+R*(f*s*k-y*n*C),t&&t.push(we,P,O,S,L,e+E,i+T),u&&ke(e+A,i+I,P,O,S,L,e+E,i+T,u,!0),A=E,I=T,D=C,M=k,m=v,v+=b;_&&fe(_,e+E,i+T)},quadraticCurveTo(t,e,i,s,n,o,r){t.push(we,(e+2*s)/3,(i+2*n)/3,(o+2*s)/3,(r+2*n)/3,o,r)},toTwoPointBoundsByQuadraticCurve(t,e,i,s,n,o,r,a){ke(t,e,(t+2*i)/3,(e+2*s)/3,(n+2*i)/3,(o+2*s)/3,n,o,r,a)},toTwoPointBounds(t,e,i,s,n,o,r,a,h,l){const d=[];let c,u,_,p,g,f,y,m,v=t,w=i,x=n,b=r;for(let t=0;t<2;++t)if(1==t&&(v=e,w=s,x=o,b=a),c=-3*v+9*w-9*x+3*b,u=6*v-12*w+6*x,_=3*w-3*v,Math.abs(c)<1e-12){if(Math.abs(u)<1e-12)continue;p=-_/u,0<p&&p<1&&d.push(p)}else y=u*u-4*_*c,m=Math.sqrt(y),y<0||(g=(-u+m)/(2*c),0<g&&g<1&&d.push(g),f=(-u-m)/(2*c),0<f&&f<1&&d.push(f));l?ge(h,t,e):pe(h,t,e),ge(h,r,a);for(let l=0,c=d.length;l<c;l++)Ce(d[l],t,e,i,s,n,o,r,a,Be),ge(h,Be.x,Be.y)},getPointAndSet(t,e,i,s,n,o,r,a,h,l){const d=1-t,c=d*d*d,u=3*d*d*t,_=3*d*t*t,p=t*t*t;l.x=c*e+u*s+_*o+p*a,l.y=c*i+u*n+_*r+p*h},getPoint(t,e,i,s,n,o,r,a,h){const l={};return Ce(t,e,i,s,n,o,r,a,h,l),l}},{getPointAndSet:Ce,toTwoPointBounds:ke,ellipse:Ee}=Re,{sin:Te,cos:Pe,sqrt:Oe,atan2:Se}=Math,{ellipse:Le}=Re,De={ellipticalArc(e,i,s,n,o,r,a,d,c,u,_){const p=(c-i)/2,g=(u-s)/2,f=r*h,y=Te(f),m=Pe(f),v=-m*p-y*g,w=-m*g+y*p,x=n*n,b=o*o,B=w*w,R=v*v,C=x*b-x*B-b*R;let k=0;if(C<0){const t=Oe(1-C/(x*b));n*=t,o*=t}else k=(a===d?-1:1)*Oe(C/(x*B+b*R));const E=k*n*w/o,T=-k*o*v/n,P=Se((w-T)/o,(v-E)/n),O=Se((-w-T)/o,(-v-E)/n);let S=O-P;0===d&&S>0?S-=l:1===d&&S<0&&(S+=l);const L=i+p+m*E-y*T,D=s+g+y*E+m*T,M=S<0?1:0;_||t.ellipseToCurve?Le(e,L,D,n,o,r,P/h,O/h,M):n!==o||r?e.push(Jt.G,L,D,n,o,r,P/h,O/h,M):e.push(Jt.O,L,D,n,P/h,O/h,M)}},{M:Me,m:Ae,L:Ie,l:We,H:Fe,h:ze,V:Ne,v:Ye,C:Xe,c:je,S:He,s:Ue,Q:Ve,q:Ge,T:Ke,t:qe,A:Ze,a:Qe,Z:Je,z:$e,N:ti,D:ei,X:ii,G:si,F:ni,O:oi,P:ri,U:ai}=Jt,{rect:hi,roundRect:li,arcTo:di,arc:ci,ellipse:ui,quadraticCurveTo:_i}=Re,{ellipticalArc:pi}=De,gi=vt.get("PathConvert"),fi={},yi={current:{dot:0},stringify(t,e){let i,s,n,o=0,r=t.length,h="";for(;o<r;){s=t[o],i=ne[s],h+=s===n?" ":se[s];for(let s=1;s<i;s++)h+=a.float(t[o+s],e),s===i-1||(h+=" ");n=s,o+=i}return h},parse(t,e){let i,s,n,o="";const r=[],a=e?ee:te;for(let e=0,h=t.length;e<h;e++)s=t[e],mt[s]?("."===s&&(mi.dot&&(vi(r,o),o=""),mi.dot++),"0"===o&&"."!==s&&(vi(r,o),o=""),o+=s):Jt[s]?(o&&(vi(r,o),o=""),mi.name=Jt[s],mi.length=$t[s],mi.index=0,vi(r,mi.name),!i&&a[s]&&(i=!0)):"-"===s||"+"===s?"e"===n||"E"===n?o+=s:(o&&vi(r,o),o=s):o&&(vi(r,o),o=""),n=s;return o&&vi(r,o),i?yi.toCanvasData(r,e):r},toCanvasData(t,e){let i,s,n,o,r,a=0,h=0,l=0,d=0,c=0,u=t.length;const _=[];for(;c<u;){switch(n=t[c],n){case Ae:t[c+1]+=a,t[c+2]+=h;case Me:a=t[c+1],h=t[c+2],_.push(Me,a,h),c+=3;break;case ze:t[c+1]+=a;case Fe:a=t[c+1],_.push(Ie,a,h),c+=2;break;case Ye:t[c+1]+=h;case Ne:h=t[c+1],_.push(Ie,a,h),c+=2;break;case We:t[c+1]+=a,t[c+2]+=h;case Ie:a=t[c+1],h=t[c+2],_.push(Ie,a,h),c+=3;break;case Ue:t[c+1]+=a,t[c+2]+=h,t[c+3]+=a,t[c+4]+=h,n=He;case He:r=o===Xe||o===He,l=r?2*a-i:t[c+1],d=r?2*h-s:t[c+2],i=t[c+1],s=t[c+2],a=t[c+3],h=t[c+4],_.push(Xe,l,d,i,s,a,h),c+=5;break;case je:t[c+1]+=a,t[c+2]+=h,t[c+3]+=a,t[c+4]+=h,t[c+5]+=a,t[c+6]+=h,n=Xe;case Xe:i=t[c+3],s=t[c+4],a=t[c+5],h=t[c+6],_.push(Xe,t[c+1],t[c+2],i,s,a,h),c+=7;break;case qe:t[c+1]+=a,t[c+2]+=h,n=Ke;case Ke:r=o===Ve||o===Ke,i=r?2*a-i:t[c+1],s=r?2*h-s:t[c+2],e?_i(_,a,h,i,s,t[c+1],t[c+2]):_.push(Ve,i,s,t[c+1],t[c+2]),a=t[c+1],h=t[c+2],c+=3;break;case Ge:t[c+1]+=a,t[c+2]+=h,t[c+3]+=a,t[c+4]+=h,n=Ve;case Ve:i=t[c+1],s=t[c+2],e?_i(_,a,h,i,s,t[c+3],t[c+4]):_.push(Ve,i,s,t[c+3],t[c+4]),a=t[c+3],h=t[c+4],c+=5;break;case Qe:t[c+6]+=a,t[c+7]+=h;case Ze:pi(_,a,h,t[c+1],t[c+2],t[c+3],t[c+4],t[c+5],t[c+6],t[c+7],e),a=t[c+6],h=t[c+7],c+=8;break;case $e:case Je:_.push(Je),c++;break;case ti:a=t[c+1],h=t[c+2],e?hi(_,a,h,t[c+3],t[c+4]):wi(_,t,c,5),c+=5;break;case ei:a=t[c+1],h=t[c+2],e?li(_,a,h,t[c+3],t[c+4],[t[c+5],t[c+6],t[c+7],t[c+8]]):wi(_,t,c,9),c+=9;break;case ii:a=t[c+1],h=t[c+2],e?li(_,a,h,t[c+3],t[c+4],t[c+5]):wi(_,t,c,6),c+=6;break;case si:ui(e?_:wi(_,t,c,9),t[c+1],t[c+2],t[c+3],t[c+4],t[c+5],t[c+6],t[c+7],t[c+8],null,fi),a=fi.x,h=fi.y,c+=9;break;case ni:e?ui(_,t[c+1],t[c+2],t[c+3],t[c+4],0,0,360,!1):wi(_,t,c,5),a=t[c+1]+t[c+3],h=t[c+2],c+=5;break;case oi:ci(e?_:wi(_,t,c,7),t[c+1],t[c+2],t[c+3],t[c+4],t[c+5],t[c+6],null,fi),a=fi.x,h=fi.y,c+=7;break;case ri:e?ci(_,t[c+1],t[c+2],t[c+3],0,360,!1):wi(_,t,c,4),a=t[c+1]+t[c+3],h=t[c+2],c+=4;break;case ai:di(e?_:wi(_,t,c,6),a,h,t[c+1],t[c+2],t[c+3],t[c+4],t[c+5],null,fi),a=fi.x,h=fi.y,c+=6;break;default:return gi.error(`command: ${n} [index:${c}]`,t),_}o=n}return _},objectToCanvasData(t){const e=[];return t.forEach((t=>{switch(t.name){case"M":e.push(Me,t.x,t.y);break;case"L":e.push(Ie,t.x,t.y);break;case"C":e.push(Xe,t.x1,t.y1,t.x2,t.y2,t.x,t.y);break;case"Q":e.push(Ve,t.x1,t.y1,t.x,t.y);break;case"Z":e.push(Je)}})),e},copyData(t,e,i,s){for(let n=i,o=i+s;n<o;n++)t.push(e[n])},pushData(t,e){mi.index===mi.length&&(mi.index=1,t.push(mi.name)),t.push(Number(e)),mi.index++,mi.dot=0}},{current:mi,pushData:vi,copyData:wi}=yi,{M:xi,L:bi,C:Bi,Q:Ri,Z:Ci,N:ki,D:Ei,X:Ti,G:Pi,F:Oi,O:Si,P:Li,U:Di}=Jt,{getMinDistanceFrom:Mi,getRadianFrom:Ai}=L,{tan:Ii,min:Wi,abs:Fi}=Math,zi={},Ni={beginPath(t){t.length=0},moveTo(t,e,i){t.push(xi,e,i)},lineTo(t,e,i){t.push(bi,e,i)},bezierCurveTo(t,e,i,s,n,o,r){t.push(Bi,e,i,s,n,o,r)},quadraticCurveTo(t,e,i,s,n){t.push(Ri,e,i,s,n)},closePath(t){t.push(Ci)},rect(t,e,i,s,n){t.push(ki,e,i,s,n)},roundRect(t,e,i,s,n,o){if("number"==typeof o)t.push(Ti,e,i,s,n,o);else{const r=a.fourNumber(o);r?t.push(Ei,e,i,s,n,...r):t.push(ki,e,i,s,n)}},ellipse(t,e,i,s,n,o,r,a,h){void 0===o?t.push(Oi,e,i,s,n):(void 0===r&&(r=0),void 0===a&&(a=360),t.push(Pi,e,i,s,n,o,r,a,h?1:0))},arc(t,e,i,s,n,o,r){void 0===n?t.push(Li,e,i,s):(void 0===o&&(o=360),t.push(Si,e,i,s,n,o,r?1:0))},arcTo(t,e,i,s,n,o,r,a){if(void 0!==r){const h=Ii(Ai(r,a,e,i,s,n)/2)*(Mi(r,a,e,i,s,n)/2);t.push(Di,e,i,s,n,Wi(o,Fi(h)))}else t.push(Di,e,i,s,n,o)},drawEllipse(t,e,i,s,n,o,r,a,h){Re.ellipse(null,e,i,s,n,void 0===o?0:o,void 0===r?0:r,void 0===a?360:a,h,null,null,zi),t.push(xi,zi.x,zi.y),Yi(t,e,i,s,n,o,r,a,h)},drawArc(t,e,i,s,n,o,r){Re.arc(null,e,i,s,void 0===n?0:n,void 0===o?360:o,r,null,null,zi),t.push(xi,zi.x,zi.y),Xi(t,e,i,s,n,o,r)},drawPoints(t,e,i,s){Re.points(t,e,i,s)}},{ellipse:Yi,arc:Xi}=Ni,{moveTo:ji,lineTo:Hi,quadraticCurveTo:Ui,bezierCurveTo:Vi,closePath:Gi,beginPath:Ki,rect:qi,roundRect:Zi,ellipse:Qi,arc:Ji,arcTo:$i,drawEllipse:ts,drawArc:es,drawPoints:is}=Ni;class ss{set path(t){this.__path=t}get path(){return this.__path}constructor(t){this.clearPath=this.beginPath,this.set(t)}set(t){return this.__path=t?"string"==typeof t?Zt.parse(t):t:[],this}beginPath(){return Ki(this.__path),this.paint(),this}moveTo(t,e){return ji(this.__path,t,e),this.paint(),this}lineTo(t,e){return Hi(this.__path,t,e),this.paint(),this}bezierCurveTo(t,e,i,s,n,o){return Vi(this.__path,t,e,i,s,n,o),this.paint(),this}quadraticCurveTo(t,e,i,s){return Ui(this.__path,t,e,i,s),this.paint(),this}closePath(){return Gi(this.__path),this.paint(),this}rect(t,e,i,s){return qi(this.__path,t,e,i,s),this.paint(),this}roundRect(t,e,i,s,n){return Zi(this.__path,t,e,i,s,n),this.paint(),this}ellipse(t,e,i,s,n,o,r,a){return Qi(this.__path,t,e,i,s,n,o,r,a),this.paint(),this}arc(t,e,i,s,n,o){return Ji(this.__path,t,e,i,s,n,o),this.paint(),this}arcTo(t,e,i,s,n){return $i(this.__path,t,e,i,s,n),this.paint(),this}drawEllipse(t,e,i,s,n,o,r,a){return ts(this.__path,t,e,i,s,n,o,r,a),this.paint(),this}drawArc(t,e,i,s,n,o){return es(this.__path,t,e,i,s,n,o),this.paint(),this}drawPoints(t,e,i){return is(this.__path,t,e,i),this.paint(),this}paint(){}}const{M:ns,L:os,C:rs,Q:as,Z:hs,N:ls,D:ds,X:cs,G:us,F:_s,O:ps,P:gs,U:fs}=Jt,ys=vt.get("PathDrawer"),ms={drawPathByData(t,e){if(!e)return;let i,s=0,n=e.length;for(;s<n;)switch(i=e[s],i){case ns:t.moveTo(e[s+1],e[s+2]),s+=3;break;case os:t.lineTo(e[s+1],e[s+2]),s+=3;break;case rs:t.bezierCurveTo(e[s+1],e[s+2],e[s+3],e[s+4],e[s+5],e[s+6]),s+=7;break;case as:t.quadraticCurveTo(e[s+1],e[s+2],e[s+3],e[s+4]),s+=5;break;case hs:t.closePath(),s+=1;break;case ls:t.rect(e[s+1],e[s+2],e[s+3],e[s+4]),s+=5;break;case ds:t.roundRect(e[s+1],e[s+2],e[s+3],e[s+4],[e[s+5],e[s+6],e[s+7],e[s+8]]),s+=9;break;case cs:t.roundRect(e[s+1],e[s+2],e[s+3],e[s+4],e[s+5]),s+=6;break;case us:t.ellipse(e[s+1],e[s+2],e[s+3],e[s+4],e[s+5]*h,e[s+6]*h,e[s+7]*h,e[s+8]),s+=9;break;case _s:t.ellipse(e[s+1],e[s+2],e[s+3],e[s+4],0,0,l,!1),s+=5;break;case ps:t.arc(e[s+1],e[s+2],e[s+3],e[s+4]*h,e[s+5]*h,e[s+6]),s+=7;break;case gs:t.arc(e[s+1],e[s+2],e[s+3],0,l,!1),s+=4;break;case fs:t.arcTo(e[s+1],e[s+2],e[s+3],e[s+4],e[s+5]),s+=6;break;default:return void ys.error(`command: ${i} [index:${s}]`,e)}}},{M:vs,L:ws,C:xs,Q:bs,Z:Bs,N:Rs,D:Cs,X:ks,G:Es,F:Ts,O:Ps,P:Os,U:Ss}=Jt,{toTwoPointBounds:Ls,toTwoPointBoundsByQuadraticCurve:Ds,arcTo:Ms,arc:As,ellipse:Is}=Re,{addPointBounds:Ws,copy:Fs,addPoint:zs,setPoint:Ns,addBounds:Ys,toBounds:Xs}=Y,js=vt.get("PathBounds");let Hs,Us,Vs;const Gs={},Ks={},qs={},Zs={toBounds(t,e){Zs.toTwoPointBounds(t,Ks),Xs(Ks,e)},toTwoPointBounds(t,e){if(!t||!t.length)return Ns(e,0,0);let i,s,n,o,r,a=0,h=0,l=0;const d=t.length;for(;a<d;)switch(r=t[a],0===a&&(r===Bs||r===xs||r===bs?Ns(e,h,l):Ns(e,t[a+1],t[a+2])),r){case vs:case ws:h=t[a+1],l=t[a+2],zs(e,h,l),a+=3;break;case xs:n=t[a+5],o=t[a+6],Ls(h,l,t[a+1],t[a+2],t[a+3],t[a+4],n,o,Gs),Ws(e,Gs),h=n,l=o,a+=7;break;case bs:i=t[a+1],s=t[a+2],n=t[a+3],o=t[a+4],Ds(h,l,i,s,n,o,Gs),Ws(e,Gs),h=n,l=o,a+=5;break;case Bs:a+=1;break;case Rs:h=t[a+1],l=t[a+2],Ys(e,h,l,t[a+3],t[a+4]),a+=5;break;case Cs:case ks:h=t[a+1],l=t[a+2],Ys(e,h,l,t[a+3],t[a+4]),a+=r===Cs?9:6;break;case Es:Is(null,t[a+1],t[a+2],t[a+3],t[a+4],t[a+5],t[a+6],t[a+7],t[a+8],Gs,qs),0===a?Fs(e,Gs):Ws(e,Gs),h=qs.x,l=qs.y,a+=9;break;case Ts:h=t[a+1],l=t[a+2],Us=t[a+3],Vs=t[a+4],Ys(e,h-Us,l-Vs,2*Us,2*Vs),h+=Us,a+=5;break;case Ps:As(null,t[a+1],t[a+2],t[a+3],t[a+4],t[a+5],t[a+6],Gs,qs),0===a?Fs(e,Gs):Ws(e,Gs),h=qs.x,l=qs.y,a+=7;break;case Os:h=t[a+1],l=t[a+2],Hs=t[a+3],Ys(e,h-Hs,l-Hs,2*Hs,2*Hs),h+=Hs,a+=4;break;case Ss:Ms(null,h,l,t[a+1],t[a+2],t[a+3],t[a+4],t[a+5],Gs,qs),0===a?Fs(e,Gs):Ws(e,Gs),h=qs.x,l=qs.y,a+=6;break;default:return void js.error(`command: ${r} [index:${a}]`,t)}}},{M:Qs,L:Js,C:$s,Z:tn}=Jt,{getCenterX:en,getCenterY:sn}=L,{arcTo:nn}=Ni,on={smooth(t,e,i){let s,n=0,o=0,r=0,a=0,h=0,l=0,d=0,c=0,u=0;const _=t.length,p=[];for(;n<_;)switch(s=t[n],s){case Qs:a=c=t[n+1],h=u=t[n+2],n+=3,t[n]===Js?(l=t[n+1],d=t[n+2],p.push(Qs,en(a,l),sn(h,d))):p.push(Qs,a,h);break;case Js:switch(o=t[n+1],r=t[n+2],n+=3,t[n]){case Js:nn(p,o,r,t[n+1],t[n+2],e,c,u);break;case tn:nn(p,o,r,a,h,e,c,u);break;default:p.push(Js,o,r)}c=o,u=r;break;case $s:p.push($s,t[n+1],t[n+2],t[n+3],t[n+4],t[n+5],t[n+6]),n+=7;break;case tn:nn(p,a,h,l,d,e,c,u),p.push(tn),n+=1}return s!==tn&&(p[1]=a,p[2]=h),p}};Zt.creator=new ss,Zt.parse=yi.parse,Zt.convertToCanvasData=yi.toCanvasData;const rn=new ss,{drawRoundRect:an}=oe;function hn(t){!function(t){t&&!t.roundRect&&(t.roundRect=function(t,e,i,s,n){an(this,t,e,i,s,n)})}(t)}const ln={opacityTypes:["png","webp","svg"],upperCaseTypeMap:{},mineType:t=>!t||t.startsWith("image")?t:("jpg"===t&&(t="jpeg"),"image/"+t),fileType(t){const e=t.split(".");return e[e.length-1]},isOpaqueImage(t){const e=dn.fileType(t);return["jpg","jpeg"].some((t=>t===e))},getExportOptions(t){switch(typeof t){case"object":return t;case"number":return{quality:t};case"boolean":return{blob:t};default:return{}}}},dn=ln;dn.opacityTypes.forEach((t=>dn.upperCaseTypeMap[t]=t.toUpperCase()));const cn=vt.get("TaskProcessor");class un{constructor(t){this.parallel=!0,this.time=1,this.id=i.create(i.TASK),this.task=t}run(){return Nt(this,void 0,void 0,(function*(){try{this.task&&!this.isComplete&&this.parent.running&&(yield this.task())}catch(t){cn.error(t)}}))}complete(){this.isComplete=!0,this.parent=null,this.task=null}cancel(){this.isCancel=!0,this.complete()}}class _n{get total(){return this.list.length+this.delayNumber}get finishedIndex(){return this.isComplete?0:this.index+this.parallelSuccessNumber}get remain(){return this.isComplete?this.total:this.total-this.finishedIndex}get percent(){const{total:t}=this;let e=0,i=0;for(let s=0;s<t;s++)s<=this.finishedIndex?(i+=this.list[s].time,s===this.finishedIndex&&(e=i)):e+=this.list[s].time;return this.isComplete?1:i/e}constructor(t){this.config={parallel:6},this.list=[],this.running=!1,this.isComplete=!0,this.index=0,this.delayNumber=0,t&&Dt.assign(this.config,t),this.empty()}add(t,e){let i,s,n,o;const r=new un(t);return r.parent=this,"number"==typeof e?o=e:e&&(s=e.parallel,i=e.start,n=e.time,o=e.delay),n&&(r.time=n),!1===s&&(r.parallel=!1),void 0===o?this.push(r,i):(this.delayNumber++,setTimeout((()=>{this.delayNumber&&(this.delayNumber--,this.push(r,i))}),o)),this.isComplete=!1,r}push(t,e){this.list.push(t),!1===e||this.timer||(this.timer=setTimeout((()=>this.start())))}empty(){this.index=0,this.parallelSuccessNumber=0,this.list=[],this.parallelList=[],this.delayNumber=0}start(){this.running||(this.running=!0,this.isComplete=!1,this.run())}pause(){clearTimeout(this.timer),this.timer=null,this.running=!1}resume(){this.start()}skip(){this.index++,this.resume()}stop(){this.isComplete=!0,this.list.forEach((t=>{t.isComplete||t.cancel()})),this.pause(),this.empty()}run(){this.running&&(this.setParallelList(),this.parallelList.length>1?this.runParallelTasks():this.remain?this.runTask():this.onComplete())}runTask(){const t=this.list[this.index];t?t.run().then((()=>{this.onTask(t),this.index++,this.nextTask()})).catch((t=>{this.onError(t)})):this.nextTask()}runParallelTasks(){this.parallelList.forEach((t=>this.runParallelTask(t)))}runParallelTask(t){t.run().then((()=>{this.onTask(t),this.fillParallelTask()})).catch((t=>{this.onParallelError(t)}))}nextTask(){this.total===this.finishedIndex?this.onComplete():this.timer=setTimeout((()=>this.run()))}setParallelList(){let t;this.parallelList=[],this.parallelSuccessNumber=0;let e=this.index+this.config.parallel;e>this.list.length&&(e=this.list.length);for(let i=this.index;i<e&&(t=this.list[i],t.parallel);i++)this.parallelList.push(t)}fillParallelTask(){let t;const e=this.parallelList;this.parallelSuccessNumber++,e.pop();const i=e.length,s=this.finishedIndex+i;if(e.length){if(!this.running)return;s<this.total&&(t=this.list[s],t&&t.parallel&&(e.push(t),this.runParallelTask(t)))}else this.index+=this.parallelSuccessNumber,this.parallelSuccessNumber=0,this.nextTask()}onComplete(){this.stop(),this.config.onComplete&&this.config.onComplete()}onTask(t){t.complete(),this.config.onTask&&this.config.onTask()}onParallelError(t){this.parallelList.forEach((t=>{t.parallel=!1})),this.parallelList.length=0,this.parallelSuccessNumber=0,this.onError(t)}onError(t){this.pause(),this.config.onError&&this.config.onError(t)}destroy(){this.stop()}}const pn={map:{},recycledList:[],tasker:new _n,patternTasker:new _n,get isComplete(){return gn.tasker.isComplete},get(t){let i=gn.map[t.url];return i||(i=e.image(t),gn.map[t.url]=i),i.use++,i},recycle(t){t.use--,setTimeout((()=>{t.use||gn.recycledList.push(t)}))},clearRecycled(){const t=gn.recycledList;t.length>100&&(t.forEach((t=>{!t.use&&t.url&&(delete gn.map[t.url],t.destroy())})),t.length=0)},hasOpacityPixel:t=>ln.opacityTypes.some((e=>gn.isFormat(e,t))),isFormat(t,e){if(e.format===t)return!0;const{url:i}=e;if(i.startsWith("data:")){if(i.startsWith("data:"+ln.mineType(t)))return!0}else if(i.includes("."+t)||i.includes("."+ln.upperCaseTypeMap[t]))return!0;return!1},destroy(){gn.map={},gn.recycledList=[]}},gn=pn,{IMAGE:fn,create:yn}=i;class mn{get url(){return this.config.url}get completed(){return this.ready||!!this.error}constructor(t){this.use=0,this.waitComplete=[],this.innerId=yn(fn),this.config=t||{url:""},this.isSVG=pn.isFormat("svg",t),this.hasOpacityPixel=pn.hasOpacityPixel(t)}load(e,i){return this.loading||(this.loading=!0,pn.tasker.add((()=>Nt(this,void 0,void 0,(function*(){return yield t.origin.loadImage(this.url).then((t=>{this.ready=!0,this.width=t.naturalWidth||t.width,this.height=t.naturalHeight||t.height,this.view=t,this.onComplete(!0)})).catch((t=>{this.error=t,this.onComplete(!1)}))}))))),this.waitComplete.push(e,i),this.waitComplete.length-2}unload(t,e){const i=this.waitComplete;if(e){const e=i[t+1];e&&e({type:"stop"})}i[t]=i[t+1]=void 0}onComplete(t){let e;this.waitComplete.forEach(((i,s)=>{e=s%2,i&&(t?e||i(this):e&&i(this.error))})),this.waitComplete.length=0,this.loading=!1}getCanvas(e,i,s,n){if(e||(e=this.width),i||(i=this.height),this.cache){let{params:t,data:e}=this.cache;for(let i in t)if(t[i]!==arguments[i]){e=null;break}if(e)return e}const o=t.origin.createCanvas(e,i),r=o.getContext("2d");return s&&(r.globalAlpha=s),r.drawImage(this.view,0,0,e,i),this.cache=this.use>1?{data:o,params:arguments}:null,o}getPattern(e,i,s,n){const o=t.canvas.createPattern(e,i);try{s&&o.setTransform&&(o.setTransform(s),s=null)}catch(t){}return n&&(n.transform=s),o}destroy(){this.config={url:""},this.cache=null,this.waitComplete.length=0}}function vn(t,e,i,s){s||(i.configurable=i.enumerable=!0),Object.defineProperty(t,e,i)}function wn(t,e){return Object.getOwnPropertyDescriptor(t,e)}function xn(t,e){return(i,s)=>Bn(i,s,t,e&&e(s))}function bn(t){return t}function Bn(t,e,i,s){const n={get(){return this.__getAttr(e)},set(t){this.__setAttr(e,t)}};vn(t,e,Object.assign(n,s||{})),qn(t,e,i)}function Rn(t){return xn(t)}function Cn(t,e){return xn(t,(t=>({set(i){this.__setAttr(t,i,e)&&(this.__layout.matrixChanged||this.__layout.matrixChange())}})))}function kn(t){return xn(t,(t=>({set(e){this.__setAttr(t,e)&&(this.__layout.matrixChanged||this.__layout.matrixChange(),this.__hasAutoLayout=!!(this.origin||this.around||this.flow),this.__local||this.__layout.createLocal())}})))}function En(t,e){return xn(t,(t=>({set(i){this.__setAttr(t,i,e)&&(this.__layout.scaleChanged||this.__layout.scaleChange())}})))}function Tn(t,e){return xn(t,(t=>({set(i){this.__setAttr(t,i,e)&&(this.__layout.rotationChanged||this.__layout.rotationChange())}})))}function Pn(t,e){return xn(t,(t=>({set(i){this.__setAttr(t,i,e)&&Sn(this)}})))}function On(t){return xn(t,(t=>({set(e){this.__setAttr(t,e)&&(Sn(this),this.__.__removeNaturalSize())}})))}function Sn(t){t.__layout.boxChanged||t.__layout.boxChange(),t.__hasAutoLayout&&(t.__layout.matrixChanged||t.__layout.matrixChange())}function Ln(t){return xn(t,(t=>({set(e){const i=this.__;2!==i.__pathInputed&&(i.__pathInputed=e?1:0),e||(i.__pathForRender=void 0),this.__setAttr(t,e),Sn(this)}})))}const Dn=Pn;function Mn(t){return xn(t,(t=>({set(e){this.__setAttr(t,e)&&An(this)}})))}function An(t){t.__layout.strokeChanged||t.__layout.strokeChange(),t.__.__useArrow&&Sn(t)}const In=Mn;function Wn(t){return xn(t,(t=>({set(e){this.__setAttr(t,e),this.__layout.renderChanged||this.__layout.renderChange()}})))}function Fn(t){return xn(t,(t=>({set(e){this.__setAttr(t,e)&&(this.__layout.surfaceChanged||this.__layout.surfaceChange())}})))}function zn(t){return xn(t,(t=>({set(e){this.__setAttr(t,e)&&(this.__layout.opacityChanged||this.__layout.opacityChange())}})))}function Nn(t){return xn(t,(t=>({set(e){const i=this.visible;if(!0===i&&0===e){if(this.animationOut)return this.__runAnimation("out",(()=>Yn(this,t,e,i)))}else 0===i&&!0===e&&this.animation&&this.__runAnimation("in");Yn(this,t,e,i)}})))}function Yn(t,e,i,s){t.__setAttr(e,i)&&(t.__layout.opacityChanged||t.__layout.opacityChange(),0!==s&&0!==i||Sn(t))}function Xn(t){return xn(t,(t=>({set(e){this.__setAttr(t,e)&&(this.__layout.surfaceChanged||this.__layout.surfaceChange(),this.waitParent((()=>{this.parent.__layout.childrenSortChange()})))}})))}function jn(t){return xn(t,(t=>({set(e){this.__setAttr(t,e)&&(this.__layout.boxChanged||this.__layout.boxChange(),this.waitParent((()=>{this.parent.__updateMask(e)})))}})))}function Hn(t){return xn(t,(t=>({set(e){this.__setAttr(t,e)&&this.waitParent((()=>{this.parent.__updateEraser(e)}))}})))}function Un(t){return xn(t,(t=>({set(e){this.__setAttr(t,e)&&(this.__layout.hitCanvasChanged=!0,vt.showHitView&&(this.__layout.surfaceChanged||this.__layout.surfaceChange()),this.leafer&&this.leafer.updateCursor())}})))}function Vn(t){return xn(t,(t=>({set(e){this.__setAttr(t,e),this.leafer&&this.leafer.updateCursor()}})))}function Gn(t){return(e,i)=>{vn(e,"__DataProcessor",{get:()=>t})}}function Kn(t){return(e,i)=>{vn(e,"__LayoutProcessor",{get:()=>t})}}function qn(t,e,i){const s=t.__DataProcessor.prototype,n="_"+e,o=function(t){return"set"+t.charAt(0).toUpperCase()+t.slice(1)}(e),r={get(){const t=this[n];return void 0===t?i:t},set(t){this[n]=t}};if(void 0===i)r.get=function(){return this[n]};else if("object"==typeof i){const{clone:t}=Dt;r.get=function(){let e=this[n];return void 0===e&&(this[n]=e=t(i)),e}}"width"===e?r.get=function(){const t=this[n];if(void 0===t){const t=this;return t._height&&t.__naturalWidth&&t.__useNaturalRatio?t._height*t.__naturalWidth/t.__naturalHeight:t.__naturalWidth||i}return t}:"height"===e&&(r.get=function(){const t=this[n];if(void 0===t){const t=this;return t._width&&t.__naturalHeight&&t.__useNaturalRatio?t._width*t.__naturalHeight/t.__naturalWidth:t.__naturalHeight||i}return t});let a,h=s;for(;!a&&h;)a=wn(h,e),h=h.__proto__;a&&a.set&&(r.set=a.set),s[o]&&(r.set=s[o],delete s[o]),vn(s,e,r)}const Zn=new vt("rewrite"),Qn=[],Jn=["destroy","constructor"];function $n(t){return(e,i)=>{Qn.push({name:e.constructor.name+"."+i,run:()=>{e[i]=t}})}}function to(){return t=>{eo()}}function eo(t){Qn.length&&(Qn.forEach((e=>{t&&Zn.error(e.name,"Class@rewriteAble()"),e.run()})),Qn.length=0)}function io(t,e){return i=>{var s;(t.prototype?(s=t.prototype,Object.getOwnPropertyNames(s)):Object.keys(t)).forEach((s=>{if(!(Jn.includes(s)||e&&e.includes(s)))if(t.prototype){wn(t.prototype,s).writable&&(i.prototype[s]=t.prototype[s])}else i.prototype[s]=t[s]}))}}function so(){return t=>{Et.register(t)}}function no(){return t=>{Ot.register(t)}}setTimeout((()=>eo(!0)));const{copy:oo,toInnerPoint:ro,toOuterPoint:ao,scaleOfOuter:ho,rotateOfOuter:lo,skewOfOuter:co,multiplyParent:uo,divideParent:_o,getLayout:po}=x,go={},fo={updateAllMatrix(t,e,i){if(e&&t.__hasAutoLayout&&t.__layout.matrixChanged&&(i=!0),vo(t,e,i),t.isBranch){const{children:s}=t;for(let t=0,n=s.length;t<n;t++)mo(s[t],e,i)}},updateMatrix(t,e,i){const s=t.__layout;e?i&&(s.waitAutoLayout=!0,t.__hasAutoLayout&&(s.matrixChanged=!1)):s.waitAutoLayout&&(s.waitAutoLayout=!1),s.matrixChanged&&t.__updateLocalMatrix(),s.waitAutoLayout||t.__updateWorldMatrix()},updateBounds(t){const e=t.__layout;e.boundsChanged&&t.__updateLocalBounds(),e.waitAutoLayout||t.__updateWorldBounds()},updateAllWorldOpacity(t){if(t.__updateWorldOpacity(),t.isBranch){const{children:e}=t;for(let t=0,i=e.length;t<i;t++)wo(e[t])}},updateAllChange(t){if(wo(t),t.__updateChange(),t.isBranch){const{children:e}=t;for(let t=0,i=e.length;t<i;t++)xo(e[t])}},worldHittable(t){for(;t;){if(!t.__.hittable)return!1;t=t.parent}return!0},moveWorld(t,e,i=0,s){const n="object"==typeof e?Object.assign({},e):{x:e,y:i};s?ao(t.localTransform,n,n,!0):t.parent&&ro(t.parent.worldTransform,n,n,!0),yo.moveLocal(t,n.x,n.y)},moveLocal(t,e,i=0){"object"==typeof e?(t.x+=e.x,t.y+=e.y):(t.x+=e,t.y+=i)},zoomOfWorld(t,e,i,s,n){yo.zoomOfLocal(t,Bo(t,e),i,s,n)},zoomOfLocal(t,e,i,s=i,n){oo(go,t.__localMatrix),ho(go,e,i,s),t.origin||t.around?yo.setTransform(t,go,n):(bo(t,go),t.scaleResize(i,s,!0!==n))},rotateOfWorld(t,e,i){yo.rotateOfLocal(t,Bo(t,e),i)},rotateOfLocal(t,e,i){oo(go,t.__localMatrix),lo(go,e,i),t.origin||t.around?yo.setTransform(t,go):(bo(t,go),t.rotation=a.formatRotation(t.rotation+i))},skewOfWorld(t,e,i,s,n){yo.skewOfLocal(t,Bo(t,e),i,s,n)},skewOfLocal(t,e,i,s=0,n){oo(go,t.__localMatrix),co(go,e,i,s),yo.setTransform(t,go,n)},transformWorld(t,e,i){oo(go,t.worldTransform),uo(go,e),t.parent&&_o(go,t.parent.worldTransform),yo.setTransform(t,go,i)},transform(t,e,i){oo(go,t.localTransform),uo(go,e),yo.setTransform(t,go,i)},setTransform(t,e,i){const s=po(e,t.origin&&yo.getInnerOrigin(t,t.origin),t.around&&yo.getInnerOrigin(t,t.around));if(i){const e=s.scaleX/t.scaleX,n=s.scaleY/t.scaleY;delete s.scaleX,delete s.scaleY,t.set(s),t.scaleResize(e,n,!0!==i)}else t.set(s)},getFlipTransform(t,e){const i={a:1,b:0,c:0,d:1,e:0,f:0},s="x"===e?1:-1;return ho(i,yo.getLocalOrigin(t,"center"),-1*s,1*s),i},getLocalOrigin:(t,e)=>L.tempToOuterOf(yo.getInnerOrigin(t,e),t.localTransform),getInnerOrigin(t,e){const i={};return pt.toPoint(e,t.boxBounds,i),i},getRelativeWorld:(t,e,i)=>(oo(go,t.worldTransform),_o(go,e.worldTransform),i?go:Object.assign({},go)),drop(t,e,i,s){t.setTransform(yo.getRelativeWorld(t,e,!0),s),e.add(t,i)},hasParent(t,e){if(!e)return!1;for(;t;){if(e===t)return!0;t=t.parent}}},yo=fo,{updateAllMatrix:mo,updateMatrix:vo,updateAllWorldOpacity:wo,updateAllChange:xo}=yo;function bo(t,e){const{e:i,f:s}=t.__localMatrix;t.x+=e.e-i,t.y+=e.f-s}function Bo(t,e){return t.__layout.update(),t.parent?L.tempToInnerOf(e,t.parent.__world):e}const Ro={worldBounds:t=>t.__world,localBoxBounds:t=>t.__.eraser||0===t.__.visible?null:t.__local||t.__layout,localStrokeBounds:t=>t.__.eraser||0===t.__.visible?null:t.__layout.localStrokeBounds,localRenderBounds:t=>t.__.eraser||0===t.__.visible?null:t.__layout.localRenderBounds,maskLocalBoxBounds:t=>t.__.mask?t.__localBoxBounds:null,maskLocalStrokeBounds:t=>t.__.mask?t.__layout.localStrokeBounds:null,maskLocalRenderBounds:t=>t.__.mask?t.__layout.localRenderBounds:null,excludeRenderBounds:(t,e)=>!(!e.bounds||e.bounds.hit(t.__world,e.matrix))||!(!e.hideBounds||!e.hideBounds.includes(t.__world,e.matrix))},{updateBounds:Co}=fo,ko={sort:(t,e)=>t.__.zIndex===e.__.zIndex?t.__tempNumber-e.__tempNumber:t.__.zIndex-e.__.zIndex,pushAllChildBranch(t,e){if(t.__tempNumber=1,t.__.__childBranchNumber){const{children:i}=t;for(let s=0,n=i.length;s<n;s++)(t=i[s]).isBranch&&(t.__tempNumber=1,e.add(t),Eo(t,e))}},pushAllParent(t,e){const{keys:i}=e;if(i)for(;t.parent&&void 0===i[t.parent.innerId];)e.add(t.parent),t=t.parent;else for(;t.parent;)e.add(t.parent),t=t.parent},pushAllBranchStack(t,e){let i=e.length;const{children:s}=t;for(let t=0,i=s.length;t<i;t++)s[t].isBranch&&e.push(s[t]);for(let t=i,s=e.length;t<s;t++)To(e[t],e)},updateBounds(t,e){const i=[t];To(t,i),Po(i,e)},updateBoundsByBranchStack(t,e){let i,s;for(let n=t.length-1;n>-1;n--){i=t[n],s=i.children;for(let t=0,e=s.length;t<e;t++)Co(s[t]);e&&e===i||Co(i)}}},{pushAllChildBranch:Eo,pushAllBranchStack:To,updateBoundsByBranchStack:Po}=ko,Oo={run(t){if(t&&t.length){const e=t.length;for(let i=0;i<e;i++)t[i]();t.length===e?t.length=0:t.splice(0,e)}}},{getRelativeWorld:So}=fo,{toOuterOf:Lo,getPoints:Do,copy:Mo}=nt,Ao="_localContentBounds",Io="_worldContentBounds",Wo="_worldBoxBounds",Fo="_worldStrokeBounds";class zo{get contentBounds(){return this._contentBounds||this.boxBounds}set contentBounds(t){this._contentBounds=t}get strokeBounds(){return this._strokeBounds||this.boxBounds}get renderBounds(){return this._renderBounds||this.boxBounds}get localContentBounds(){return Lo(this.contentBounds,this.leaf.__localMatrix,this[Ao]||(this[Ao]={})),this[Ao]}get localStrokeBounds(){return this._localStrokeBounds||this}get localRenderBounds(){return this._localRenderBounds||this}get worldContentBounds(){return Lo(this.contentBounds,this.leaf.__world,this[Io]||(this[Io]={})),this[Io]}get worldBoxBounds(){return Lo(this.boxBounds,this.leaf.__world,this[Wo]||(this[Wo]={})),this[Wo]}get worldStrokeBounds(){return Lo(this.strokeBounds,this.leaf.__world,this[Fo]||(this[Fo]={})),this[Fo]}get a(){return 1}get b(){return 0}get c(){return 0}get d(){return 1}get e(){return this.leaf.__.x}get f(){return this.leaf.__.y}get x(){return this.e+this.boxBounds.x}get y(){return this.f+this.boxBounds.y}get width(){return this.boxBounds.width}get height(){return this.boxBounds.height}constructor(t){this.leaf=t,this.boxBounds={x:0,y:0,width:0,height:0},this.leaf.__local&&(this._localRenderBounds=this._localStrokeBounds=this.leaf.__local),this.boxChange(),this.matrixChange()}createLocal(){const t=this.leaf.__local={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0};this._localStrokeBounds||(this._localStrokeBounds=t),this._localRenderBounds||(this._localRenderBounds=t)}update(){const{leafer:e}=this.leaf;if(e)e.ready?e.watcher.changed&&e.layouter.layout():e.start();else{let e=this.leaf;for(;e.parent&&!e.parent.leafer;)e=e.parent;t.layout(e)}}getTransform(t="world"){this.update();const{leaf:e}=this;switch(t){case"world":return e.__world;case"local":return e.__localMatrix;case"inner":return x.defaultMatrix;case"page":t=e.zoomLayer;default:return So(e,t)}}getBounds(t,e="world"){switch(this.update(),e){case"world":return this.getWorldBounds(t);case"local":return this.getLocalBounds(t);case"inner":return this.getInnerBounds(t);case"page":e=this.leaf.zoomLayer;default:return new ht(this.getInnerBounds(t)).toOuterOf(this.getTransform(e))}}getInnerBounds(t="box"){switch(t){case"render":return this.renderBounds;case"content":if(this.contentBounds)return this.contentBounds;case"box":return this.boxBounds;case"stroke":return this.strokeBounds}}getLocalBounds(t="box"){switch(t){case"render":return this.localRenderBounds;case"stroke":return this.localStrokeBounds;case"content":if(this.contentBounds)return this.localContentBounds;case"box":return this.leaf.__localBoxBounds}}getWorldBounds(t="box"){switch(t){case"render":return this.leaf.__world;case"stroke":return this.worldStrokeBounds;case"content":if(this.contentBounds)return this.worldContentBounds;case"box":return this.worldBoxBounds}}getLayoutBounds(t,e="world",i){const{leaf:s}=this;let n,o,r,a=this.getInnerBounds(t);switch(e){case"world":n=s.getWorldPoint(a),o=s.__world;break;case"local":const{scaleX:t,scaleY:i,rotation:h,skewX:l,skewY:d}=s.__;r={scaleX:t,scaleY:i,rotation:h,skewX:l,skewY:d},n=s.getLocalPointByInner(a);break;case"inner":n=a,o=x.defaultMatrix;break;case"page":e=s.zoomLayer;default:n=s.getWorldPoint(a,e),o=So(s,e,!0)}if(r||(r=x.getLayout(o)),Mo(r,a),L.copy(r,n),i){const{scaleX:t,scaleY:e}=r,i=Math.abs(t),s=Math.abs(e);1===i&&1===s||(r.scaleX/=i,r.scaleY/=s,r.width*=i,r.height*=s)}return r}getLayoutPoints(t,e="world"){const{leaf:i}=this,s=Do(this.getInnerBounds(t));let n;switch(e){case"world":n=null;break;case"local":n=i.parent;break;case"inner":break;case"page":e=i.zoomLayer;default:n=e}return void 0!==n&&s.forEach((t=>i.innerToWorld(t,null,!1,n))),s}shrinkContent(){const{x:t,y:e,width:i,height:s}=this.boxBounds;this._contentBounds={x:t,y:e,width:i,height:s}}spreadStroke(){const{x:t,y:e,width:i,height:s}=this.strokeBounds;this._strokeBounds={x:t,y:e,width:i,height:s},this._localStrokeBounds={x:t,y:e,width:i,height:s},this.renderSpread||this.spreadRenderCancel()}spreadRender(){const{x:t,y:e,width:i,height:s}=this.renderBounds;this._renderBounds={x:t,y:e,width:i,height:s},this._localRenderBounds={x:t,y:e,width:i,height:s}}shrinkContentCancel(){this._contentBounds=void 0}spreadStrokeCancel(){const t=this.renderBounds===this.strokeBounds;this._strokeBounds=this.boxBounds,this._localStrokeBounds=this.leaf.__localBoxBounds,t&&this.spreadRenderCancel()}spreadRenderCancel(){this._renderBounds=this._strokeBounds,this._localRenderBounds=this._localStrokeBounds}boxChange(){this.boxChanged=!0,this.localBoxChanged||this.localBoxChange(),this.hitCanvasChanged=!0}localBoxChange(){this.localBoxChanged=!0,this.boundsChanged=!0}strokeChange(){this.strokeChanged=!0,this.strokeSpread||(this.strokeSpread=1),this.boundsChanged=!0,this.hitCanvasChanged=!0}renderChange(){this.renderChanged=!0,this.renderSpread||(this.renderSpread=1),this.boundsChanged=!0}scaleChange(){this.scaleChanged=!0,this._scaleOrRotationChange()}rotationChange(){this.rotationChanged=!0,this.affectRotation=!0,this._scaleOrRotationChange()}_scaleOrRotationChange(){this.affectScaleOrRotation=!0,this.matrixChange(),this.leaf.__local||this.createLocal()}matrixChange(){this.matrixChanged=!0,this.localBoxChanged||this.localBoxChange()}surfaceChange(){this.surfaceChanged=!0}opacityChange(){this.opacityChanged=!0,this.surfaceChanged||this.surfaceChange()}childrenSortChange(){this.childrenSortChanged||(this.childrenSortChanged=!0,this.leaf.forceUpdate("surface"))}destroy(){}}class No{constructor(t,e){this.bubbles=!1,this.type=t,e&&(this.target=e)}stopDefault(){this.isStopDefault=!0,this.origin&&t.event.stopDefault(this.origin)}stopNow(){this.isStopNow=!0,this.isStop=!0,this.origin&&t.event.stopNow(this.origin)}stop(){this.isStop=!0,this.origin&&t.event.stop(this.origin)}}class Yo extends No{constructor(t,e,i){super(t,e),this.parent=i,this.child=e}}Yo.ADD="child.add",Yo.REMOVE="child.remove",Yo.CREATED="created",Yo.MOUNTED="mounted",Yo.UNMOUNTED="unmounted",Yo.DESTROY="destroy";class Xo extends No{constructor(t,e,i,s,n){super(t,e),this.attrName=i,this.oldValue=s,this.newValue=n}}Xo.CHANGE="property.change",Xo.LEAFER_CHANGE="property.leafer_change";class jo extends No{constructor(t,e){super(t),Object.assign(this,e)}}jo.LOAD="image.load",jo.LOADED="image.loaded",jo.ERROR="image.error";class Ho extends No{get bigger(){if(!this.old)return!0;const{width:t,height:e}=this.old;return this.width>=t&&this.height>=e}get smaller(){return!this.bigger}get samePixelRatio(){return!this.old||this.pixelRatio===this.old.pixelRatio}constructor(t,e){"object"==typeof t?(super(Ho.RESIZE),Object.assign(this,t)):super(t),this.old=e}}Ho.RESIZE="resize";class Uo extends No{constructor(t,e){super(t),this.data=e}}Uo.REQUEST="watch.request",Uo.DATA="watch.data";class Vo extends No{constructor(t,e,i){super(t),e&&(this.data=e,this.times=i)}}Vo.CHECK_UPDATE="layout.check_update",Vo.REQUEST="layout.request",Vo.START="layout.start",Vo.BEFORE="layout.before",Vo.LAYOUT="layout",Vo.AFTER="layout.after",Vo.AGAIN="layout.again",Vo.END="layout.end";class Go extends No{constructor(t,e,i,s){super(t),e&&(this.times=e),i&&(this.renderBounds=i,this.renderOptions=s)}}Go.REQUEST="render.request",Go.CHILD_START="render.child_start",Go.START="render.start",Go.BEFORE="render.before",Go.RENDER="render",Go.AFTER="render.after",Go.AGAIN="render.again",Go.END="render.end",Go.NEXT="render.next";class Ko extends No{}Ko.START="leafer.start",Ko.BEFORE_READY="leafer.before_ready",Ko.READY="leafer.ready",Ko.AFTER_READY="leafer.after_ready",Ko.VIEW_READY="leafer.view_ready",Ko.VIEW_COMPLETED="leafer.view_completed",Ko.STOP="leafer.stop",Ko.RESTART="leafer.restart",Ko.END="leafer.end";const qo={};class Zo{set event(t){this.on(t)}on(t,e,i){if(!e){let e,i=t;for(let t in i)e=i[t],e instanceof Array?this.on(t,e[0],e[1]):this.on(t,e);return}let s,n,o;i&&("once"===i?n=!0:"boolean"==typeof i?s=i:(s=i.capture,n=i.once));const r=Qo(this,s,!0),a="string"==typeof t?t.split(" "):t,h=n?{listener:e,once:n}:{listener:e};a.forEach((t=>{t&&(o=r[t],o?-1===o.findIndex((t=>t.listener===e))&&o.push(h):r[t]=[h])}))}off(t,e,i){if(t){const s="string"==typeof t?t.split(" "):t;if(e){let t,n,o;i&&(t="boolean"==typeof i?i:"once"!==i&&i.capture);const r=Qo(this,t);s.forEach((t=>{t&&(n=r[t],n&&(o=n.findIndex((t=>t.listener===e)),o>-1&&n.splice(o,1),n.length||delete r[t]))}))}else{const{__bubbleMap:t,__captureMap:e}=this;s.forEach((i=>{t&&delete t[i],e&&delete e[i]}))}}else this.__bubbleMap=this.__captureMap=void 0}on_(t,e,i,s){return i&&(e=e.bind(i)),this.on(t,e,s),{type:t,current:this,listener:e,options:s}}off_(t){if(!t)return;const e=t instanceof Array?t:[t];e.forEach((t=>t.current.off(t.type,t.listener,t.options))),e.length=0}once(t,e,i){this.on(t,e,{once:!0,capture:i})}emit(t,e,i){!e&&Ot.has(t)&&(e=Ot.get(t,{type:t,target:this,current:this}));const s=Qo(this,i)[t];if(s){let n;for(let o=0,r=s.length;o<r&&(n=s[o],n.listener(e),n.once&&(this.off(t,n.listener,i),o--,r--),!e||!e.isStopNow);o++);}this.syncEventer&&this.syncEventer.emitEvent(e,i)}emitEvent(t,e){t.current=this,this.emit(t.type,t,e)}hasEvent(t,e){if(this.syncEventer&&this.syncEventer.hasEvent(t,e))return!0;const{__bubbleMap:i,__captureMap:s}=this,n=i&&i[t],o=s&&s[t];return!!(void 0===e?n||o:e?o:n)}destroy(){this.__captureMap=this.__bubbleMap=this.syncEventer=null}}function Qo(t,e,i){if(e){const{__captureMap:e}=t;return e||(i?t.__captureMap={}:qo)}{const{__bubbleMap:e}=t;return e||(i?t.__bubbleMap={}:qo)}}const{on:Jo,on_:$o,off:tr,off_:er,once:ir,emit:sr,emitEvent:nr,hasEvent:or,destroy:rr}=Zo.prototype,ar={on:Jo,on_:$o,off:tr,off_:er,once:ir,emit:sr,emitEvent:nr,hasEvent:or,destroyEventer:rr},{isFinite:hr}=Number,lr=vt.get("setAttr"),dr={__setAttr(t,e,i){if(this.leaferIsCreated){const s=this.__.__getInput(t);if(i&&!hr(e)&&void 0!==e&&(lr.warn(this.innerName,t,e),e=void 0),"object"==typeof e||s!==e){this.__realSetAttr(t,e);const{CHANGE:i}=Xo,n=new Xo(i,this,t,s,e);return this.isLeafer?this.emitEvent(new Xo(Xo.LEAFER_CHANGE,this,t,s,e)):this.hasEvent(i)&&this.emitEvent(n),this.leafer.emitEvent(n),!0}return!1}return this.__realSetAttr(t,e),!0},__realSetAttr(t,e){const i=this.__;i[t]=e,this.__proxyData&&this.setProxyAttr(t,e),i.normalStyle&&(this.lockNormalStyle||void 0===i.normalStyle[t]||(i.normalStyle[t]=e))},__getAttr(t){return this.__proxyData?this.getProxyAttr(t):this.__.__get(t)}},{setLayout:cr,multiplyParent:ur,translateInner:_r,defaultWorld:pr}=x,{toPoint:gr,tempPoint:fr}=pt,yr={__updateWorldMatrix(){ur(this.__local||this.__layout,this.parent?this.parent.__world:pr,this.__world,!!this.__layout.affectScaleOrRotation,this.__,this.parent&&this.parent.__)},__updateLocalMatrix(){if(this.__local){const t=this.__layout,e=this.__local,i=this.__;t.affectScaleOrRotation&&(t.scaleChanged||t.rotationChanged)&&(cr(e,i,null,null,t.affectRotation),t.scaleChanged=t.rotationChanged=!1),e.e=i.x+i.offsetX,e.f=i.y+i.offsetY,(i.around||i.origin)&&(gr(i.around||i.origin,t.boxBounds,fr),_r(e,-fr.x,-fr.y,!i.around))}this.__layout.matrixChanged=!1}},{updateMatrix:mr,updateAllMatrix:vr}=fo,{updateBounds:wr}=ko,{toOuterOf:xr,copyAndSpread:br,copy:Br}=nt,{toBounds:Rr}=Zs,Cr={__updateWorldBounds(){xr(this.__layout.renderBounds,this.__world,this.__world),this.__layout.resized&&(this.__onUpdateSize(),this.__layout.resized=!1)},__updateLocalBounds(){const t=this.__layout;t.boxChanged&&(this.__.__pathInputed||this.__updatePath(),this.__updateRenderPath(),this.__updateBoxBounds(),t.resized=!0),t.localBoxChanged&&(this.__local&&this.__updateLocalBoxBounds(),t.localBoxChanged=!1,t.strokeSpread&&(t.strokeChanged=!0),t.renderSpread&&(t.renderChanged=!0),this.parent&&this.parent.__layout.boxChange()),t.boxChanged=!1,t.strokeChanged&&(t.strokeSpread=this.__updateStrokeSpread(),t.strokeSpread?(t.strokeBounds===t.boxBounds&&t.spreadStroke(),this.__updateStrokeBounds(),this.__updateLocalStrokeBounds()):t.spreadStrokeCancel(),t.strokeChanged=!1,(t.renderSpread||t.strokeSpread!==t.strokeBoxSpread)&&(t.renderChanged=!0),this.parent&&this.parent.__layout.strokeChange(),t.resized=!0),t.renderChanged&&(t.renderSpread=this.__updateRenderSpread(),t.renderSpread?(t.renderBounds!==t.boxBounds&&t.renderBounds!==t.strokeBounds||t.spreadRender(),this.__updateRenderBounds(),this.__updateLocalRenderBounds()):t.spreadRenderCancel(),t.renderChanged=!1,this.parent&&this.parent.__layout.renderChange()),t.boundsChanged=!1},__updateLocalBoxBounds(){this.__hasMotionPath&&this.__updateMotionPath(),this.__hasAutoLayout&&this.__updateAutoLayout(),xr(this.__layout.boxBounds,this.__local,this.__local)},__updateLocalStrokeBounds(){xr(this.__layout.strokeBounds,this.__localMatrix,this.__layout.localStrokeBounds)},__updateLocalRenderBounds(){xr(this.__layout.renderBounds,this.__localMatrix,this.__layout.localRenderBounds)},__updateBoxBounds(){const t=this.__layout.boxBounds,e=this.__;e.__pathInputed?Rr(e.path,t):(t.x=0,t.y=0,t.width=e.width,t.height=e.height)},__updateAutoLayout(){this.__layout.matrixChanged=!0,this.isBranch?(this.leaferIsReady&&this.leafer.layouter.addExtra(this),this.__.flow?(this.__layout.boxChanged&&this.__updateFlowLayout(),vr(this),wr(this,this),this.__.__autoSide&&this.__updateBoxBounds(!0)):(vr(this),wr(this,this))):mr(this)},__updateNaturalSize(){const{__:t,__layout:e}=this;t.__naturalWidth=e.boxBounds.width,t.__naturalHeight=e.boxBounds.height},__updateStrokeBounds(){const t=this.__layout;br(t.strokeBounds,t.boxBounds,t.strokeBoxSpread)},__updateRenderBounds(){const t=this.__layout;t.renderSpread>0?br(t.renderBounds,t.boxBounds,t.renderSpread):Br(t.renderBounds,t.strokeBounds)}},kr={__render(t,e){if(this.__worldOpacity)if(t.setWorld(this.__nowWorld=this.__getNowWorld(e)),t.opacity=this.__.opacity,this.__.__single){if("path"===this.__.eraser)return this.__renderEraser(t,e);const i=t.getSameCanvas(!0,!0);this.__draw(i,e),this.__worldFlipped?t.copyWorldByReset(i,this.__nowWorld,null,this.__.__blendMode,!0):t.copyWorldToInner(i,this.__nowWorld,this.__layout.renderBounds,this.__.__blendMode),i.recycle(this.__nowWorld)}else this.__draw(t,e)},__clip(t,e){this.__worldOpacity&&(t.setWorld(this.__nowWorld=this.__getNowWorld(e)),this.__drawRenderPath(t),this.windingRule?t.clip(this.windingRule):t.clip())},__updateWorldOpacity(){this.__worldOpacity=this.__.visible?this.parent?this.parent.__worldOpacity*this.__.opacity:this.__.opacity:0,this.__layout.opacityChanged&&(this.__layout.opacityChanged=!1)}},{excludeRenderBounds:Er}=Ro,Tr={__updateChange(){const{__layout:t}=this;t.childrenSortChanged&&(this.__updateSortChildren(),t.childrenSortChanged=!1),this.__.__checkSingle()},__render(t,e){if(this.__worldOpacity)if(this.__.__single){if("path"===this.__.eraser)return this.__renderEraser(t,e);const i=t.getSameCanvas(!1,!0);this.__renderBranch(i,e);const s=this.__getNowWorld(e);t.opacity=this.__.opacity,t.copyWorldByReset(i,s,s,this.__.__blendMode,!0),i.recycle(s)}else this.__renderBranch(t,e)},__renderBranch(t,e){if(this.__hasMask)this.__renderMask(t,e);else{const{children:i}=this;for(let s=0,n=i.length;s<n;s++)Er(i[s],e)||i[s].__render(t,e)}},__clip(t,e){if(this.__worldOpacity){const{children:i}=this;for(let s=0,n=i.length;s<n;s++)Er(i[s],e)||i[s].__clip(t,e)}}},{LEAF:Pr,create:Or}=i,{toInnerPoint:Sr,toOuterPoint:Lr,multiplyParent:Dr}=x,{toOuterOf:Mr}=nt,{copy:Ar,move:Ir}=L,{moveLocal:Wr,zoomOfLocal:Fr,rotateOfLocal:zr,skewOfLocal:Nr,moveWorld:Yr,zoomOfWorld:Xr,rotateOfWorld:jr,skewOfWorld:Hr,transform:Ur,transformWorld:Vr,setTransform:Gr,getFlipTransform:Kr,getLocalOrigin:qr,getRelativeWorld:Zr,drop:Qr}=fo;let Jr=class{get tag(){return this.__tag}set tag(t){}get __tag(){return"Leaf"}get innerName(){return this.__.name||this.tag+this.innerId}get __DataProcessor(){return At}get __LayoutProcessor(){return zo}get leaferIsCreated(){return this.leafer&&this.leafer.created}get leaferIsReady(){return this.leafer&&this.leafer.ready}get isLeafer(){return!1}get isBranch(){return!1}get isBranchLeaf(){return!1}get __localMatrix(){return this.__local||this.__layout}get __localBoxBounds(){return this.__local||this.__layout}get worldTransform(){return this.__layout.getTransform("world")}get localTransform(){return this.__layout.getTransform("local")}get boxBounds(){return this.getBounds("box","inner")}get renderBounds(){return this.getBounds("render","inner")}get worldBoxBounds(){return this.getBounds("box")}get worldStrokeBounds(){return this.getBounds("stroke")}get worldRenderBounds(){return this.getBounds("render")}get worldOpacity(){return this.__layout.update(),this.__worldOpacity}get __worldFlipped(){return this.__world.scaleX<0||this.__world.scaleY<0}get __onlyHitMask(){return this.__hasMask&&!this.__.hitChildren}get __ignoreHitWorld(){return(this.__hasMask||this.__hasEraser)&&this.__.hitChildren}get __inLazyBounds(){const{leafer:t}=this;return t&&t.created&&t.lazyBounds.hit(this.__world)}get pathInputed(){return this.__.__pathInputed}set event(t){this.on(t)}constructor(t){this.innerId=Or(Pr),this.reset(t),this.__bubbleMap&&this.__emitLifeEvent(Yo.CREATED)}reset(t){this.leafer&&this.leafer.forceRender(this.__world),this.__world={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0,scaleX:1,scaleY:1},null!==t&&(this.__local={a:1,b:0,c:0,d:1,e:0,f:0,x:0,y:0,width:0,height:0}),this.__worldOpacity=1,this.__=new this.__DataProcessor(this),this.__layout=new this.__LayoutProcessor(this),this.__level&&this.resetCustom(),t&&(t.__&&(t=t.toJSON()),t.children?this.set(t):Object.assign(this,t))}resetCustom(){this.__hasMask=this.__hasEraser=null,this.forceUpdate()}waitParent(t,e){e&&(t=t.bind(e)),this.parent?t():this.on(Yo.ADD,t,"once")}waitLeafer(t,e){e&&(t=t.bind(e)),this.leafer?t():this.on(Yo.MOUNTED,t,"once")}nextRender(t,e,i){this.leafer?this.leafer.nextRender(t,e,i):this.waitLeafer((()=>this.leafer.nextRender(t,e,i)))}removeNextRender(t){this.nextRender(t,null,"off")}__bindLeafer(t){if(this.isLeafer&&null!==t&&(t=this),this.leafer&&!t&&this.leafer.leafs--,this.leafer=t,t?(t.leafs++,this.__level=this.parent?this.parent.__level+1:1,this.animation&&this.__runAnimation("in"),this.__bubbleMap&&this.__emitLifeEvent(Yo.MOUNTED)):this.__emitLifeEvent(Yo.UNMOUNTED),this.isBranch){const{children:e}=this;for(let i=0,s=e.length;i<s;i++)e[i].__bindLeafer(t)}}set(t,e){}get(t){}setAttr(t,e){this[t]=e}getAttr(t){return this[t]}getComputedAttr(t){return this.__[t]}toJSON(t){return t&&this.__layout.update(),this.__.__getInputData(null,t)}toString(t){return JSON.stringify(this.toJSON(t))}toSVG(){}__SVG(t){}toHTML(){}__setAttr(t,e){return!0}__getAttr(t){}setProxyAttr(t,e){}getProxyAttr(t){}find(t,e){}findTag(t){}findOne(t,e){}findId(t){}focus(t){}updateState(){}updateLayout(){this.__layout.update()}forceUpdate(t){void 0===t?t="width":"surface"===t&&(t="blendMode");const e=this.__.__getInput(t);this.__[t]=void 0===e?null:void 0,this[t]=e}forceRender(t){this.forceUpdate("surface")}__updateWorldMatrix(){}__updateLocalMatrix(){}__updateWorldBounds(){}__updateLocalBounds(){}__updateLocalBoxBounds(){}__updateLocalStrokeBounds(){}__updateLocalRenderBounds(){}__updateBoxBounds(){}__updateContentBounds(){}__updateStrokeBounds(){}__updateRenderBounds(){}__updateAutoLayout(){}__updateFlowLayout(){}__updateNaturalSize(){}__updateStrokeSpread(){return 0}__updateRenderSpread(){return 0}__onUpdateSize(){}__updateEraser(t){this.__hasEraser=!!t||this.children.some((t=>t.__.eraser))}__renderEraser(t,e){t.save(),this.__clip(t,e);const{renderBounds:i}=this.__layout;t.clearRect(i.x,i.y,i.width,i.height),t.restore()}__updateMask(t){this.__hasMask=!!t||this.children.some((t=>t.__.mask))}__renderMask(t,e){}__getNowWorld(t){if(t.matrix){this.__cameraWorld||(this.__cameraWorld={});const e=this.__cameraWorld;return Dr(this.__world,t.matrix,e,void 0,this.__world),Mr(this.__layout.renderBounds,e,e),e}return this.__world}getTransform(t){return this.__layout.getTransform(t||"local")}getBounds(t,e){return this.__layout.getBounds(t,e)}getLayoutBounds(t,e,i){return this.__layout.getLayoutBounds(t,e,i)}getLayoutPoints(t,e){return this.__layout.getLayoutPoints(t,e)}getWorldBounds(t,e,i){const s=e?Zr(this,e):this.worldTransform,n=i?t:{};return Mr(t,s,n),n}worldToLocal(t,e,i,s){this.parent?this.parent.worldToInner(t,e,i,s):e&&Ar(e,t)}localToWorld(t,e,i,s){this.parent?this.parent.innerToWorld(t,e,i,s):e&&Ar(e,t)}worldToInner(t,e,i,s){s&&(s.innerToWorld(t,e,i),t=e||t),Sr(this.worldTransform,t,e,i)}innerToWorld(t,e,i,s){Lr(this.worldTransform,t,e,i),s&&s.worldToInner(e||t,null,i)}getBoxPoint(t,e,i,s){return this.getBoxPointByInner(this.getInnerPoint(t,e,i,s),null,null,!0)}getBoxPointByInner(t,e,i,s){const n=s?t:Object.assign({},t),{x:o,y:r}=this.boxBounds;return Ir(n,-o,-r),n}getInnerPoint(t,e,i,s){const n=s?t:{};return this.worldToInner(t,n,i,e),n}getInnerPointByBox(t,e,i,s){const n=s?t:Object.assign({},t),{x:o,y:r}=this.boxBounds;return Ir(n,o,r),n}getInnerPointByLocal(t,e,i,s){return this.getInnerPoint(t,this.parent,i,s)}getLocalPoint(t,e,i,s){const n=s?t:{};return this.worldToLocal(t,n,i,e),n}getLocalPointByInner(t,e,i,s){return this.getWorldPoint(t,this.parent,i,s)}getPagePoint(t,e,i,s){return(this.leafer?this.leafer.zoomLayer:this).getInnerPoint(t,e,i,s)}getWorldPoint(t,e,i,s){const n=s?t:{};return this.innerToWorld(t,n,i,e),n}getWorldPointByBox(t,e,i,s){return this.getWorldPoint(this.getInnerPointByBox(t,null,null,s),e,i,!0)}getWorldPointByLocal(t,e,i,s){const n=s?t:{};return this.localToWorld(t,n,i,e),n}getWorldPointByPage(t,e,i,s){return(this.leafer?this.leafer.zoomLayer:this).getWorldPoint(t,e,i,s)}setTransform(t,e){Gr(this,t,e)}transform(t,e){Ur(this,t,e)}move(t,e){Wr(this,t,e)}moveInner(t,e){Yr(this,t,e,!0)}scaleOf(t,e,i,s){Fr(this,qr(this,t),e,i,s)}rotateOf(t,e){zr(this,qr(this,t),e)}skewOf(t,e,i,s){Nr(this,qr(this,t),e,i,s)}transformWorld(t,e){Vr(this,t,e)}moveWorld(t,e){Yr(this,t,e)}scaleOfWorld(t,e,i,s){Xr(this,t,e,i,s)}rotateOfWorld(t,e){jr(this,t,e)}skewOfWorld(t,e,i,s){Hr(this,t,e,i,s)}flip(t){Ur(this,Kr(this,t))}scaleResize(t,e=t,i){this.scaleX*=t,this.scaleY*=e}__scaleResize(t,e){}resizeWidth(t){}resizeHeight(t){}__hitWorld(t){return!0}__hit(t){return!0}__hitFill(t){return!0}__hitStroke(t,e){return!0}__hitPixel(t){return!0}__drawHitPath(t){}__updateHitCanvas(){}__render(t,e){}__drawFast(t,e){}__draw(t,e){}__clip(t,e){}__renderShape(t,e,i,s){}__updateWorldOpacity(){}__updateChange(){}__drawPath(t){}__drawRenderPath(t){}__updatePath(){}__updateRenderPath(){}getMotionPathData(){return Ct("path")}getMotionPoint(t){return Ct("path")}getMotionTotal(){return 0}__updateMotionPath(){}__runAnimation(t,e){}__updateSortChildren(){}add(t,e){}remove(t,e){this.parent&&this.parent.remove(this,e)}dropTo(t,e,i){Qr(this,t,e,i)}on(t,e,i){}off(t,e,i){}on_(t,e,i,s){}off_(t){}once(t,e,i){}emit(t,e,i){}emitEvent(t,e){}hasEvent(t,e){return!1}static changeAttr(t,e,i){i?this.addAttr(t,e,i):qn(this.prototype,t,e)}static addAttr(t,e,i){i||(i=Pn),i(e)(this.prototype,t)}__emitLifeEvent(t){this.hasEvent(t)&&this.emitEvent(new Yo(t,this,this.parent))}destroy(){if(!this.destroyed){const{parent:t}=this;t&&this.remove(),this.children&&this.removeAll(!0),this.__emitLifeEvent(Yo.DESTROY),this.__.destroy(),this.__layout.destroy(),this.destroyEventer(),this.destroyed=!0}}};Jr=zt([io(dr),io(yr),io(Cr),io(ar),io(kr)],Jr);const{setListWithFn:$r}=nt,{sort:ta}=ko,{localBoxBounds:ea,localStrokeBounds:ia,localRenderBounds:sa,maskLocalBoxBounds:na,maskLocalStrokeBounds:oa,maskLocalRenderBounds:ra}=Ro;let aa=class extends Jr{__updateStrokeSpread(){const{children:t}=this;for(let e=0,i=t.length;e<i;e++)if(t[e].__layout.strokeSpread)return 1;return 0}__updateRenderSpread(){const{children:t}=this;for(let e=0,i=t.length;e<i;e++)if(t[e].__layout.renderSpread)return 1;return 0}__updateBoxBounds(){$r(this.__layout.boxBounds,this.children,this.__hasMask?na:ea)}__updateStrokeBounds(){$r(this.__layout.strokeBounds,this.children,this.__hasMask?oa:ia)}__updateRenderBounds(){$r(this.__layout.renderBounds,this.children,this.__hasMask?ra:sa)}__updateSortChildren(){let t;const{children:e}=this;if(e.length>1){for(let i=0,s=e.length;i<s;i++)e[i].__tempNumber=i,e[i].__.zIndex&&(t=!0);e.sort(ta),this.__layout.affectChildrenSort=t}}add(t,e){if(t===this)return;const i=void 0===e;if(!t.__){if(t instanceof Array)return t.forEach((t=>{this.add(t,e),i||e++}));t=Et.get(t.tag,t)}t.parent&&t.parent.remove(t),t.parent=this,i?this.children.push(t):this.children.splice(e,0,t),t.isBranch&&(this.__.__childBranchNumber=(this.__.__childBranchNumber||0)+1),t.__layout.boxChanged||t.__layout.boxChange(),t.__layout.matrixChanged||t.__layout.matrixChange(),t.__bubbleMap&&t.__emitLifeEvent(Yo.ADD),this.leafer&&(t.__bindLeafer(this.leafer),this.leafer.created&&this.__emitChildEvent(Yo.ADD,t)),this.__layout.affectChildrenSort&&this.__layout.childrenSortChange()}addMany(...t){this.add(t)}remove(t,e){t?t.__?t.animationOut?t.__runAnimation("out",(()=>this.__remove(t,e))):this.__remove(t,e):this.find(t).forEach((t=>this.remove(t,e))):void 0===t&&super.remove(null,e)}removeAll(t){const{children:e}=this;e.length&&(this.children=[],this.__preRemove(),this.__.__childBranchNumber=0,e.forEach((e=>{this.__realRemoveChild(e),t&&e.destroy()})))}clear(){this.removeAll(!0)}__remove(t,e){const i=this.children.indexOf(t);i>-1&&(this.children.splice(i,1),t.isBranch&&(this.__.__childBranchNumber=(this.__.__childBranchNumber||1)-1),this.__preRemove(),this.__realRemoveChild(t),e&&t.destroy())}__preRemove(){this.__hasMask&&this.__updateMask(),this.__hasEraser&&this.__updateEraser(),this.__layout.boxChange(),this.__layout.affectChildrenSort&&this.__layout.childrenSortChange()}__realRemoveChild(t){t.__emitLifeEvent(Yo.REMOVE),t.parent=null,this.leafer&&(t.__bindLeafer(null),this.leafer.created&&(this.__emitChildEvent(Yo.REMOVE,t),this.leafer.hitCanvasManager&&this.leafer.hitCanvasManager.clear()))}__emitChildEvent(t,e){const i=new Yo(t,e,this);this.hasEvent(t)&&!this.isLeafer&&this.emitEvent(i),this.leafer.emitEvent(i)}};aa=zt([io(Tr)],aa);class ha{get length(){return this.list.length}constructor(t){this.reset(),t&&(t instanceof Array?this.addList(t):this.add(t))}has(t){return t&&void 0!==this.keys[t.innerId]}indexAt(t){return this.list[t]}indexOf(t){const e=this.keys[t.innerId];return void 0===e?-1:e}add(t){const{list:e,keys:i}=this;void 0===i[t.innerId]&&(e.push(t),i[t.innerId]=e.length-1)}addAt(t,e=0){const{keys:i}=this;if(void 0===i[t.innerId]){const{list:s}=this;for(let t=e,n=s.length;t<n;t++)i[s[t].innerId]++;0===e?s.unshift(t):(e>s.length&&(e=s.length),s.splice(e,0,t)),i[t.innerId]=e}}addList(t){for(let e=0;e<t.length;e++)this.add(t[e])}remove(t){const{list:e}=this;let i;for(let s=0,n=e.length;s<n;s++)void 0!==i?this.keys[e[s].innerId]=s-1:e[s].innerId===t.innerId&&(i=s,delete this.keys[t.innerId]);void 0!==i&&e.splice(i,1)}sort(t){const{list:e}=this;t?e.sort(((t,e)=>e.__level-t.__level)):e.sort(((t,e)=>t.__level-e.__level))}forEach(t){this.list.forEach(t)}clone(){const t=new ha;return t.list=[...this.list],t.keys=Object.assign({},this.keys),t}update(){this.keys={};const{list:t,keys:e}=this;for(let i=0,s=t.length;i<s;i++)e[t[i].innerId]=i}reset(){this.list=[],this.keys={}}destroy(){this.reset()}}class la{get length(){return this._length}constructor(t){this._length=0,this.reset(),t&&(t instanceof Array?this.addList(t):this.add(t))}has(t){return void 0!==this.keys[t.innerId]}without(t){return void 0===this.keys[t.innerId]}sort(t){const{levels:e}=this;t?e.sort(((t,e)=>e-t)):e.sort(((t,e)=>t-e))}addList(t){t.forEach((t=>{this.add(t)}))}add(t){const{keys:e,levelMap:i}=this;e[t.innerId]||(e[t.innerId]=1,i[t.__level]?i[t.__level].push(t):(i[t.__level]=[t],this.levels.push(t.__level)),this._length++)}forEach(t){let e;this.levels.forEach((i=>{e=this.levelMap[i];for(let i=0,s=e.length;i<s;i++)t(e[i])}))}reset(){this.levelMap={},this.keys={},this.levels=[],this._length=0}destroy(){this.levelMap=null}}const da="1.0.6",ca=vt.get("LeaferCanvas");class ua extends qt{set zIndex(t){const{style:e}=this.view;e.zIndex=t,this.setAbsolute(this.view)}set childIndex(t){const{view:e,parentView:i}=this;if(e&&i){const s=i.children[t];s?(this.setAbsolute(s),i.insertBefore(e,s)):i.appendChild(s)}}init(){const{config:e}=this,i=e.view||e.canvas;i?this.__createViewFrom(i):this.__createView();const{style:s}=this.view;if(s.display||(s.display="block"),this.parentView=this.view.parentElement,this.parentView){const t=this.parentView.style;t.webkitUserSelect=t.userSelect="none"}t.syncDomFont&&!this.parentView&&(s.display="none",document.body.appendChild(this.view)),this.__createContext(),this.autoLayout||this.resize(e)}set backgroundColor(t){this.view.style.backgroundColor=t}get backgroundColor(){return this.view.style.backgroundColor}set hittable(t){this.view.style.pointerEvents=t?"auto":"none"}get hittable(){return"none"!==this.view.style.pointerEvents}__createView(){this.view=document.createElement("canvas")}__createViewFrom(t){let e="string"==typeof t?document.getElementById(t):t;if(e)if(e instanceof HTMLCanvasElement)this.view=e;else{let t=e;if(e===window||e===document){const e=document.createElement("div"),{style:i}=e;i.position="absolute",i.top=i.bottom=i.left=i.right="0px",document.body.appendChild(e),t=e}this.__createView();const i=this.view;t.hasChildNodes()&&(this.setAbsolute(i),t.style.position||(t.style.position="relative")),t.appendChild(i)}else ca.error(`no id: ${t}`),this.__createView()}setAbsolute(t){const{style:e}=t;e.position="absolute",e.top=e.left="0px"}updateViewSize(){const{width:t,height:e,pixelRatio:i}=this,{style:s}=this.view;s.width=t+"px",s.height=e+"px",this.view.width=Math.ceil(t*i),this.view.height=Math.ceil(e*i)}updateClientBounds(){this.clientBounds=this.view.getBoundingClientRect()}startAutoLayout(e,i){if(this.resizeListener=i,e){this.autoBounds=e;try{this.resizeObserver=new ResizeObserver((t=>{this.updateClientBounds();for(const e of t)this.checkAutoBounds(e.contentRect)}));const t=this.parentView;t?(this.resizeObserver.observe(t),this.checkAutoBounds(t.getBoundingClientRect())):(this.checkAutoBounds(this.view),ca.warn("no parent"))}catch(t){this.imitateResizeObserver()}}else window.addEventListener("resize",(()=>{const e=t.devicePixelRatio;if(this.pixelRatio!==e){const{width:t,height:i}=this;this.emitResize({width:t,height:i,pixelRatio:e})}}))}imitateResizeObserver(){this.autoLayout&&(this.parentView&&this.checkAutoBounds(this.parentView.getBoundingClientRect()),t.requestRender(this.imitateResizeObserver.bind(this)))}checkAutoBounds(e){const i=this.view,{x:s,y:n,width:o,height:r}=this.autoBounds.getBoundsFrom(e),a={width:o,height:r,pixelRatio:t.devicePixelRatio};if(!this.isSameSize(a)){const{style:t}=i;t.marginLeft=s+"px",t.marginTop=n+"px",this.emitResize(a)}}stopAutoLayout(){this.autoLayout=!1,this.resizeListener=null,this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null)}emitResize(t){const e={};Dt.copyAttrs(e,this,Kt),this.resize(t),this.resizeListener&&void 0!==this.width&&this.resizeListener(new Ho(t,e))}unrealCanvas(){if(!this.unreal&&this.parentView){const t=this.view;t&&t.remove(),this.view=this.parentView,this.unreal=!0}}destroy(){if(this.view){if(this.stopAutoLayout(),!this.unreal){const t=this.view;t.parentElement&&t.remove()}super.destroy()}}}hn(CanvasRenderingContext2D.prototype),hn(Path2D.prototype);const{mineType:_a,fileType:pa}=ln;function ga(i,s){t.origin={createCanvas(t,e){const i=document.createElement("canvas");return i.width=t,i.height=e,i},canvasToDataURL:(t,e,i)=>t.toDataURL(_a(e),i),canvasToBolb:(t,e,i)=>new Promise((s=>t.toBlob(s,_a(e),i))),canvasSaveAs:(e,i,s)=>{const n=e.toDataURL(_a(pa(i)),s);return t.origin.download(n,i)},download:(t,e)=>new Promise((i=>{let s=document.createElement("a");s.href=t,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),i()})),loadImage:e=>new Promise(((i,s)=>{const n=new Image,{crossOrigin:o}=t.image;o&&(n.setAttribute("crossOrigin",o),n.crossOrigin=o),n.onload=()=>{i(n)},n.onerror=t=>{s(t)},n.src=t.image.getRealURL(e)}))},t.event={stopDefault(t){t.preventDefault()},stopNow(t){t.stopImmediatePropagation()},stop(t){t.stopPropagation()}},t.canvas=e.canvas(),t.conicGradientSupport=!!t.canvas.context.createConicGradient}Object.assign(e,{canvas:(t,e)=>new ua(t,e),image:t=>new mn(t)}),t.name="web",t.isMobile="ontouchstart"in window,t.requestRender=function(t){window.requestAnimationFrame(t)},vn(t,"devicePixelRatio",{get:()=>Math.max(1,devicePixelRatio)});const{userAgent:fa}=navigator;fa.indexOf("Firefox")>-1?(t.conicGradientRotate90=!0,t.intWheelDeltaY=!0,t.syncDomFont=!0):fa.indexOf("Safari")>-1&&-1===fa.indexOf("Chrome")&&(t.fullImageShadow=!0),fa.indexOf("Windows")>-1?(t.os="Windows",t.intWheelDeltaY=!0):fa.indexOf("Mac")>-1?t.os="Mac":fa.indexOf("Linux")>-1&&(t.os="Linux");class ya{get childrenChanged(){return this.hasAdd||this.hasRemove||this.hasVisible}get updatedList(){if(this.hasRemove){const t=new ha;return this.__updatedList.list.forEach((e=>{e.leafer&&t.add(e)})),t}return this.__updatedList}constructor(t,e){this.totalTimes=0,this.config={},this.__updatedList=new ha,this.target=t,e&&(this.config=Dt.default(e,this.config)),this.__listenEvents()}start(){this.disabled||(this.running=!0)}stop(){this.running=!1}disable(){this.stop(),this.__removeListenEvents(),this.disabled=!0}update(){this.changed=!0,this.running&&this.target.emit(Go.REQUEST)}__onAttrChange(t){this.__updatedList.add(t.target),this.update()}__onChildEvent(t){t.type===Yo.ADD?(this.hasAdd=!0,this.__pushChild(t.child)):(this.hasRemove=!0,this.__updatedList.add(t.parent)),this.update()}__pushChild(t){this.__updatedList.add(t),t.isBranch&&this.__loopChildren(t)}__loopChildren(t){const{children:e}=t;for(let t=0,i=e.length;t<i;t++)this.__pushChild(e[t])}__onRquestData(){this.target.emitEvent(new Uo(Uo.DATA,{updatedList:this.updatedList})),this.__updatedList=new ha,this.totalTimes++,this.changed=!1,this.hasVisible=!1,this.hasRemove=!1,this.hasAdd=!1}__listenEvents(){const{target:t}=this;this.__eventIds=[t.on_(Xo.CHANGE,this.__onAttrChange,this),t.on_([Yo.ADD,Yo.REMOVE],this.__onChildEvent,this),t.on_(Uo.REQUEST,this.__onRquestData,this)]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=null,this.__updatedList=null)}}const{updateAllMatrix:ma,updateBounds:va,updateAllWorldOpacity:wa}=fo,{pushAllChildBranch:xa,pushAllParent:ba}=ko;const{worldBounds:Ba}=Ro,Ra={x:0,y:0,width:1e5,height:1e5};class Ca{constructor(t){this.updatedBounds=new ht,this.beforeBounds=new ht,this.afterBounds=new ht,t instanceof Array&&(t=new ha(t)),this.updatedList=t}setBefore(){this.beforeBounds.setListWithFn(this.updatedList.list,Ba)}setAfter(){const{list:t}=this.updatedList;t.some((t=>t.noBounds))?this.afterBounds.set(Ra):this.afterBounds.setListWithFn(t,Ba),this.updatedBounds.setList([this.beforeBounds,this.afterBounds])}merge(t){this.updatedList.addList(t.updatedList.list),this.beforeBounds.add(t.beforeBounds),this.afterBounds.add(t.afterBounds),this.updatedBounds.add(t.updatedBounds)}destroy(){this.updatedList=null}}const{updateAllMatrix:ka,updateAllChange:Ea}=fo,Ta=vt.get("Layouter");class Pa{constructor(t,e){this.totalTimes=0,this.config={},this.__levelList=new la,this.target=t,e&&(this.config=Dt.default(e,this.config)),this.__listenEvents()}start(){this.disabled||(this.running=!0)}stop(){this.running=!1}disable(){this.stop(),this.__removeListenEvents(),this.disabled=!0}layout(){if(!this.running)return;const{target:t}=this;this.times=0;try{t.emit(Vo.START),this.layoutOnce(),t.emitEvent(new Vo(Vo.END,this.layoutedBlocks,this.times))}catch(t){Ta.error(t)}this.layoutedBlocks=null}layoutAgain(){this.layouting?this.waitAgain=!0:this.layoutOnce()}layoutOnce(){return this.layouting?Ta.warn("layouting"):this.times>3?Ta.warn("layout max times"):(this.times++,this.totalTimes++,this.layouting=!0,this.target.emit(Uo.REQUEST),this.totalTimes>1?this.partLayout():this.fullLayout(),this.layouting=!1,void(this.waitAgain&&(this.waitAgain=!1,this.layoutOnce())))}partLayout(){var t;if(!(null===(t=this.__updatedList)||void 0===t?void 0:t.length))return;const e=Bt.start("PartLayout"),{target:i,__updatedList:s}=this,{BEFORE:n,LAYOUT:o,AFTER:r}=Vo,a=this.getBlocks(s);a.forEach((t=>t.setBefore())),i.emitEvent(new Vo(n,a,this.times)),this.extraBlock=null,s.sort(),function(t,e){let i;t.list.forEach((t=>{i=t.__layout,e.without(t)&&!i.proxyZoom&&(i.matrixChanged?(ma(t,!0),e.add(t),t.isBranch&&xa(t,e),ba(t,e)):i.boundsChanged&&(e.add(t),t.isBranch&&(t.__tempNumber=0),ba(t,e)))}))}(s,this.__levelList),function(t){let e,i,s;t.sort(!0),t.levels.forEach((n=>{e=t.levelMap[n];for(let t=0,n=e.length;t<n;t++){if(i=e[t],i.isBranch&&i.__tempNumber){s=i.children;for(let t=0,e=s.length;t<e;t++)s[t].isBranch||va(s[t])}va(i)}}))}(this.__levelList),function(t){let e;t.list.forEach((t=>{e=t.__layout,e.opacityChanged&&wa(t),e.stateStyleChanged&&setTimeout((()=>e.stateStyleChanged&&t.updateState())),t.__updateChange()}))}(s),this.extraBlock&&a.push(this.extraBlock),a.forEach((t=>t.setAfter())),i.emitEvent(new Vo(o,a,this.times)),i.emitEvent(new Vo(r,a,this.times)),this.addBlocks(a),this.__levelList.reset(),this.__updatedList=null,Bt.end(e)}fullLayout(){const t=Bt.start("FullLayout"),{target:e}=this,{BEFORE:i,LAYOUT:s,AFTER:n}=Vo,o=this.getBlocks(new ha(e));e.emitEvent(new Vo(i,o,this.times)),Pa.fullLayout(e),o.forEach((t=>{t.setAfter()})),e.emitEvent(new Vo(s,o,this.times)),e.emitEvent(new Vo(n,o,this.times)),this.addBlocks(o),Bt.end(t)}static fullLayout(t){ka(t,!0),t.isBranch?ko.updateBounds(t):fo.updateBounds(t),Ea(t)}addExtra(t){if(!this.__updatedList.has(t)){const{updatedList:e,beforeBounds:i}=this.extraBlock||(this.extraBlock=new Ca([]));e.length?i.add(t.__world):i.set(t.__world),e.add(t)}}createBlock(t){return new Ca(t)}getBlocks(t){return[this.createBlock(t)]}addBlocks(t){this.layoutedBlocks?this.layoutedBlocks.push(...t):this.layoutedBlocks=t}__onReceiveWatchData(t){this.__updatedList=t.data.updatedList}__listenEvents(){const{target:t}=this;this.__eventIds=[t.on_(Vo.REQUEST,this.layout,this),t.on_(Vo.AGAIN,this.layoutAgain,this),t.on_(Uo.DATA,this.__onReceiveWatchData,this)]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=this.config=null)}}const Oa=vt.get("Renderer");class Sa{get needFill(){return!(this.canvas.allowBackgroundColor||!this.config.fill)}constructor(t,e,i){this.FPS=60,this.totalTimes=0,this.times=0,this.config={usePartRender:!0,maxFPS:60},this.target=t,this.canvas=e,i&&(this.config=Dt.default(i,this.config)),this.__listenEvents(),this.__requestRender()}start(){this.running=!0}stop(){this.running=!1}update(){this.changed=!0}requestLayout(){this.target.emit(Vo.REQUEST)}render(t){if(!this.running||!this.canvas.view)return void(this.changed=!0);const{target:e}=this;this.times=0,this.totalBounds=new ht,Oa.log(e.innerName,"---\x3e");try{e.app.emit(Go.CHILD_START,e),this.emitRender(Go.START),this.renderOnce(t),this.emitRender(Go.END,this.totalBounds),pn.clearRecycled()}catch(t){this.rendering=!1,Oa.error(t)}Oa.log("-------------|")}renderAgain(){this.rendering?this.waitAgain=!0:this.renderOnce()}renderOnce(t){if(this.rendering)return Oa.warn("rendering");if(this.times>3)return Oa.warn("render max times");if(this.times++,this.totalTimes++,this.rendering=!0,this.changed=!1,this.renderBounds=new ht,this.renderOptions={},t)this.emitRender(Go.BEFORE),t();else{if(this.requestLayout(),this.ignore)return void(this.ignore=this.rendering=!1);this.emitRender(Go.BEFORE),this.config.usePartRender&&this.totalTimes>1?this.partRender():this.fullRender()}this.emitRender(Go.RENDER,this.renderBounds,this.renderOptions),this.emitRender(Go.AFTER,this.renderBounds,this.renderOptions),this.updateBlocks=null,this.rendering=!1,this.waitAgain&&(this.waitAgain=!1,this.renderOnce())}partRender(){const{canvas:t,updateBlocks:e}=this;if(!e)return Oa.warn("PartRender: need update attr");this.mergeBlocks(),e.forEach((e=>{t.bounds.hit(e)&&!e.isEmpty()&&this.clipRender(e)}))}clipRender(t){const e=Bt.start("PartRender"),{canvas:i}=this,s=t.getIntersect(i.bounds),n=t.includes(this.target.__world),o=new ht(s);i.save(),n&&!vt.showRepaint?i.clear():(s.spread(10+1/this.canvas.pixelRatio).ceil(),i.clearWorld(s,!0),i.clipWorld(s,!0)),this.__render(s,n,o),i.restore(),Bt.end(e)}fullRender(){const t=Bt.start("FullRender"),{canvas:e}=this;e.save(),e.clear(),this.__render(e.bounds,!0),e.restore(),Bt.end(t)}__render(t,e,i){const s=t.includes(this.target.__world)?{includes:e}:{bounds:t,includes:e};this.needFill&&this.canvas.fillWorld(t,this.config.fill),vt.showRepaint&&this.canvas.strokeWorld(t,"red"),this.target.__render(this.canvas,s),this.renderBounds=i=i||t,this.renderOptions=s,this.totalBounds.isEmpty()?this.totalBounds=i:this.totalBounds.add(i),vt.showHitView&&this.renderHitView(s),vt.showBoundsView&&this.renderBoundsView(s),this.canvas.updateRender(i)}renderHitView(t){}renderBoundsView(t){}addBlock(t){this.updateBlocks||(this.updateBlocks=[]),this.updateBlocks.push(t)}mergeBlocks(){const{updateBlocks:t}=this;if(t){const e=new ht;e.setList(t),t.length=0,t.push(e)}}__requestRender(){const e=Date.now();t.requestRender((()=>{this.FPS=Math.min(60,Math.ceil(1e3/(Date.now()-e))),this.running&&(this.changed&&this.canvas.view&&this.render(),this.target.emit(Go.NEXT)),this.target&&this.__requestRender()}))}__onResize(t){if(!this.canvas.unreal){if(t.bigger||!t.samePixelRatio){const{width:e,height:i}=t.old;if(!new ht(0,0,e,i).includes(this.target.__world)||this.needFill||!t.samePixelRatio)return this.addBlock(this.canvas.bounds),void this.target.forceUpdate("surface")}this.addBlock(new ht(0,0,1,1)),this.changed=!0}}__onLayoutEnd(t){t.data&&t.data.map((t=>{let e;t.updatedList&&t.updatedList.list.some((t=>(e=!t.__world.width||!t.__world.height,e&&(t.isLeafer||Oa.tip(t.innerName,": empty"),e=!t.isBranch||t.isBranchLeaf),e))),this.addBlock(e?this.canvas.bounds:t.updatedBounds)}))}emitRender(t,e,i){this.target.emitEvent(new Go(t,this.times,e,i))}__listenEvents(){const{target:t}=this;this.__eventIds=[t.on_(Go.REQUEST,this.update,this),t.on_(Vo.END,this.__onLayoutEnd,this),t.on_(Go.AGAIN,this.renderAgain,this),t.on_(Ho.RESIZE,this.__onResize,this)]}__removeListenEvents(){this.target.off_(this.__eventIds)}destroy(){this.target&&(this.stop(),this.__removeListenEvents(),this.target=this.canvas=this.config=null)}}const{hitRadiusPoint:La}=nt;class Da{constructor(t,e){this.target=t,this.selector=e}getByPoint(t,e,i){e||(e=0),i||(i={});const s=i.through||!1,n=i.ignoreHittable||!1,o=i.target||this.target;this.exclude=i.exclude||null,this.point={x:t.x,y:t.y,radiusX:e,radiusY:e},this.findList=new ha(i.findList),i.findList||this.hitBranch(o);const{list:r}=this.findList,a=this.getBestMatchLeaf(r,i.bottomList,n),h=n?this.getPath(a):this.getHitablePath(a);return this.clear(),s?{path:h,target:a,throughPath:r.length?this.getThroughPath(r):h}:{path:h,target:a}}getBestMatchLeaf(t,e,i){if(t.length){let e;this.findList=new ha;const{x:s,y:n}=this.point,o={x:s,y:n,radiusX:0,radiusY:0};for(let s=0,n=t.length;s<n;s++)if(e=t[s],(i||fo.worldHittable(e))&&(this.hitChild(e,o),this.findList.length))return this.findList.list[0]}if(e)for(let t=0,i=e.length;t<i;t++)if(this.hitChild(e[t].target,this.point,e[t].proxy),this.findList.length)return this.findList.list[0];return t[0]}getPath(t){const e=new ha;for(;t;)e.add(t),t=t.parent;return e.add(this.target),e}getHitablePath(t){const e=this.getPath(t&&t.hittable?t:null);let i,s=new ha;for(let t=e.list.length-1;t>-1&&(i=e.list[t],i.__.hittable)&&(s.addAt(i,0),i.__.hitChildren);t--);return s}getThroughPath(t){const e=new ha,i=[];for(let e=t.length-1;e>-1;e--)i.push(this.getPath(t[e]));let s,n,o;for(let t=0,r=i.length;t<r;t++){s=i[t],n=i[t+1];for(let t=0,i=s.length;t<i&&(o=s.list[t],!n||!n.has(o));t++)e.add(o)}return e}hitBranch(t){this.eachFind(t.children,t.__onlyHitMask)}eachFind(t,e){let i,s;const{point:n}=this;for(let o=t.length-1;o>-1;o--)i=t[o],!i.__.visible||e&&!i.__.mask||(s=!!i.__.hitRadius||La(i.__world,n),i.isBranch?(s||i.__ignoreHitWorld)&&(this.eachFind(i.children,i.__onlyHitMask),i.isBranchLeaf&&this.hitChild(i,n)):s&&this.hitChild(i,n))}hitChild(t,e,i){if((!this.exclude||!this.exclude.has(t))&&t.__hitWorld(e)){const{parent:s}=t;if(s&&s.__hasMask&&!t.__.mask&&!s.children.some((t=>t.__.mask&&t.__hitWorld(e))))return;this.findList.add(i||t)}}clear(){this.point=null,this.findList=null,this.exclude=null}destroy(){this.clear()}}const{Yes:Ma,NoAndSkip:Aa,YesAndSkip:Ia}=It,Wa={},Fa={},za={};class Na{constructor(t,e){this.config={},this.innerIdMap={},this.idMap={},this.methods={id:(t,e)=>t.id===e?(this.idMap[e]=t,1):0,innerId:(t,e)=>t.innerId===e?(this.innerIdMap[e]=t,1):0,className:(t,e)=>t.className===e?1:0,tag:(t,e)=>t.__tag===e?1:0,tags:(t,e)=>e[t.__tag]?1:0},this.target=t,e&&(this.config=Dt.default(e,this.config)),this.picker=new Da(t,this),this.__listenEvents()}getBy(t,e,i,s){switch(typeof t){case"number":const n=this.getByInnerId(t,e);return i?n:n?[n]:[];case"string":switch(t[0]){case"#":Wa.id=t.substring(1),t=Wa;break;case".":Fa.className=t.substring(1),t=Fa;break;default:za.tag=t,t=za}case"object":if(void 0!==t.id){const s=this.getById(t.id,e);return i?s:s?[s]:[]}if(t.tag){const{tag:s}=t,n=s instanceof Array;return this.getByMethod(n?this.methods.tags:this.methods.tag,e,i,n?Dt.toMap(s):s)}return this.getByMethod(this.methods.className,e,i,t.className);case"function":return this.getByMethod(t,e,i,s)}}getByPoint(e,i,s){return"node"===t.name&&this.target.emit(Vo.CHECK_UPDATE),this.picker.getByPoint(e,i,s)}getByInnerId(t,e){const i=this.innerIdMap[t];return i||(this.eachFind(this.toChildren(e),this.methods.innerId,null,t),this.findLeaf)}getById(t,e){const i=this.idMap[t];return i&&fo.hasParent(i,e||this.target)?i:(this.eachFind(this.toChildren(e),this.methods.id,null,t),this.findLeaf)}getByClassName(t,e){return this.getByMethod(this.methods.className,e,!1,t)}getByTag(t,e){return this.getByMethod(this.methods.tag,e,!1,t)}getByMethod(t,e,i,s){const n=i?null:[];return this.eachFind(this.toChildren(e),t,n,s),n||this.findLeaf}eachFind(t,e,i,s){let n,o;for(let r=0,a=t.length;r<a;r++){if(n=t[r],o=e(n,s),o===Ma||o===Ia){if(!i)return void(this.findLeaf=n);i.push(n)}n.isBranch&&o<Aa&&this.eachFind(n.children,e,i,s)}}toChildren(t){return this.findLeaf=null,[t||this.target]}__onRemoveChild(t){const{id:e,innerId:i}=t.child;this.idMap[e]&&delete this.idMap[e],this.innerIdMap[i]&&delete this.innerIdMap[i]}__checkIdChange(t){if("id"===t.attrName){const e=t.oldValue;this.idMap[e]&&delete this.idMap[e]}}__listenEvents(){this.__eventIds=[this.target.on_(Yo.REMOVE,this.__onRemoveChild,this),this.target.on_(Xo.CHANGE,this.__checkIdChange,this)]}__removeListenEvents(){this.target.off_(this.__eventIds),this.__eventIds.length=0}destroy(){this.__eventIds.length&&(this.__removeListenEvents(),this.picker.destroy(),this.findLeaf=null,this.innerIdMap={},this.idMap={})}}function Ya(t){return xn(t,(t=>({set(e){this.__setAttr(t,e),e&&(this.__.__useEffect=!0),this.__layout.renderChanged||this.__layout.renderChange()}})))}function Xa(t){return xn(t,(t=>({set(e){this.__setAttr(t,e),this.__layout.boxChanged||this.__layout.boxChange(),this.__updateSize()}})))}function ja(){return(t,e)=>{const i="_"+e;vn(t,e,{set(t){this.isLeafer&&(this[i]=t)},get(){return this.isApp?this.tree.zoomLayer:this.isLeafer?this[i]||this:this.leafer&&this.leafer.zoomLayer}})}}Object.assign(e,{watcher:(t,e)=>new ya(t,e),layouter:(t,e)=>new Pa(t,e),renderer:(t,e,i)=>new Sa(t,e,i),selector:(t,e)=>new Na(t,e)}),t.layout=Pa.fullLayout;const Ha={},Ua={},Va={number:(t,e)=>"object"==typeof t?"percent"===t.type?t.value*e:t.value:t},Ga={},Ka={},qa={},Za={},Qa={},Ja={},$a={setStyleName:(t,e,i)=>Ct("state"),set:(t,e)=>Ct("state")},th={list:{},register(t,e){th.list[t]=e},get:t=>th.list[t]},{parse:eh,objectToCanvasData:ih}=yi,sh={},nh=vt.get("UIData");class oh extends At{get scale(){const{scaleX:t,scaleY:e}=this;return t!==e?{x:t,y:e}:t}get __strokeWidth(){const{strokeWidth:t,strokeWidthFixed:e}=this;if(e){const e=this.__leaf;let{scaleX:i}=e.__nowWorld||e.__world;return i<0&&(i=-i),i>1?t/i:t}return t}get __hasStroke(){return this.stroke&&this.strokeWidth}get __clipAfterFill(){return this.cornerRadius||this.__pathInputed}get __autoWidth(){return!this._width}get __autoHeight(){return!this._height}get __autoSide(){return!this._width||!this._height}get __autoSize(){return!this._width&&!this._height}setVisible(t){this._visible=t;const{leafer:e}=this.__leaf;e&&(e.watcher.hasVisible=!0)}setWidth(t){t<0?(this._width=-t,this.__leaf.scaleX*=-1,nh.warn("width < 0, instead -scaleX ",this)):this._width=t}setHeight(t){t<0?(this._height=-t,this.__leaf.scaleY*=-1,nh.warn("height < 0, instead -scaleY",this)):this._height=t}setFill(t){this.__naturalWidth&&this.__removeNaturalSize(),"string"!=typeof t&&t?"object"==typeof t&&(this.__setInput("fill",t),this.__leaf.__layout.boxChanged||this.__leaf.__layout.boxChange(),this.__isFills=!0,this._fill||(this._fill=sh)):(this.__isFills&&(this.__removeInput("fill"),qa.recycleImage("fill",this),this.__isFills=!1,this.__pixelFill&&(this.__pixelFill=!1)),this._fill=t)}setStroke(t){"string"!=typeof t&&t?"object"==typeof t&&(this.__setInput("stroke",t),this.__leaf.__layout.boxChanged||this.__leaf.__layout.boxChange(),this.__isStrokes=!0,this._stroke||(this._stroke=sh)):(this.__isStrokes&&(this.__removeInput("stroke"),qa.recycleImage("stroke",this),this.__isStrokes=!1,this.__pixelStroke&&(this.__pixelStroke=!1)),this._stroke=t)}setPath(t){const e="string"==typeof t;e||t&&"object"==typeof t[0]?(this.__setInput("path",t),this._path=e?eh(t):ih(t)):(this.__input&&this.__removeInput("path"),this._path=t)}setShadow(t){this.__setInput("shadow",t),t instanceof Array?(t.some((t=>!1===t.visible))&&(t=t.filter((t=>!1!==t.visible))),this._shadow=t.length?t:null):this._shadow=t&&!1!==t.visible?[t]:null}setInnerShadow(t){this.__setInput("innerShadow",t),t instanceof Array?(t.some((t=>!1===t.visible))&&(t=t.filter((t=>!1!==t.visible))),this._innerShadow=t.length?t:null):this._innerShadow=t&&!1!==t.visible?[t]:null}__computePaint(){const{fill:t,stroke:e}=this.__input;t&&Ka.compute("fill",this.__leaf),e&&Ka.compute("stroke",this.__leaf),this.__needComputePaint=!1}}class rh extends oh{}class ah extends rh{get __boxStroke(){return!this.__pathInputed}get __drawAfterFill(){return"hide"===this.overflow&&this.__clipAfterFill&&this.__leaf.children.length}get __clipAfterFill(){return this.__leaf.isOverflow||super.__clipAfterFill}}class hh extends rh{__getInputData(t,e){const i=super.__getInputData(t,e);return Kt.forEach((t=>delete i[t])),i}}class lh extends ah{}class dh extends oh{}class ch extends oh{get __boxStroke(){return!this.__pathInputed}}class uh extends oh{get __boxStroke(){return!this.__pathInputed}}class _h extends oh{}class ph extends oh{}class gh extends oh{get __pathInputed(){return 2}}class fh extends rh{}const yh={thin:100,"extra-light":200,light:300,normal:400,medium:500,"semi-bold":600,bold:700,"extra-bold":800,black:900};class mh extends oh{get __useNaturalRatio(){return!1}setFontWeight(t){"string"==typeof t?(this.__setInput("fontWeight",t),this._fontWeight=yh[t]||400):(this.__input&&this.__removeInput("fontWeight"),this._fontWeight=t)}}class vh extends ch{setUrl(t){this.__setImageFill(t),this._url=t}__setImageFill(t){this.__leaf.image&&(this.__leaf.image=null),this.fill=t?{type:"image",mode:"stretch",url:t}:void 0}__getData(){const t=super.__getData();return delete t.fill,t}__getInputData(t,e){const i=super.__getInputData(t,e);return delete i.fill,i}}class wh extends ch{get __isCanvas(){return!0}get __drawAfterFill(){return!0}__getInputData(t,e){const i=super.__getInputData(t,e);return i.url=this.__leaf.canvas.toDataURL("image/png"),i}}const xh={__updateStrokeSpread(){let t=0,e=0;const i=this.__,{strokeAlign:s,strokeWidth:n}=i;if((i.stroke||"all"===i.hitStroke)&&n&&"inside"!==s&&(e=t="center"===s?n/2:n,!i.__boxStroke)){const e=i.__isLinePath?0:10*t,s="none"===i.strokeCap?0:n;t+=Math.max(e,s)}return i.__useArrow&&(t+=5*n),this.__layout.strokeBoxSpread=e,t},__updateRenderSpread(){let t=0;const{shadow:e,innerShadow:i,blur:s,backgroundBlur:n}=this.__;e&&e.forEach((e=>t=Math.max(t,Math.max(Math.abs(e.y),Math.abs(e.x))+(e.spread>0?e.spread:0)+1.5*e.blur))),s&&(t=Math.max(t,s));let o=t=Math.ceil(t);return i&&i.forEach((t=>o=Math.max(o,Math.max(Math.abs(t.y),Math.abs(t.x))+(t.spread<0?-t.spread:0)+1.5*t.blur))),n&&(o=Math.max(o,n)),this.__layout.renderShapeSpread=o,t+(this.__layout.strokeSpread||0)}},bh={__updateChange(){const t=this.__;if(t.__useEffect){const{shadow:e,innerShadow:i,blur:s,backgroundBlur:n}=this.__;t.__useEffect=!!(e||i||s||n)}t.__checkSingle();t.__isFills||t.__isStrokes||t.cornerRadius||t.__useEffect?t.__complex=!0:t.__complex&&(t.__complex=!1)},__drawFast(t,e){Bh(this,t,e)},__draw(t,e){const i=this.__;if(i.__complex){i.__needComputePaint&&i.__computePaint();const{fill:s,stroke:n,__drawAfterFill:o}=i;if(this.__drawRenderPath(t),i.__useEffect){const r=Ka.shape(this,t,e);this.__nowWorld=this.__getNowWorld(e);const{shadow:a,innerShadow:h}=i;a&&Qa.shadow(this,t,r),s&&(i.__isFills?Ka.fills(s,this,t):Ka.fill(s,this,t)),o&&this.__drawAfterFill(t,e),h&&Qa.innerShadow(this,t,r),n&&(i.__isStrokes?Ka.strokes(n,this,t):Ka.stroke(n,this,t)),r.worldCanvas&&r.worldCanvas.recycle(),r.canvas.recycle()}else s&&(i.__isFills?Ka.fills(s,this,t):Ka.fill(s,this,t)),o&&this.__drawAfterFill(t,e),n&&(i.__isStrokes?Ka.strokes(n,this,t):Ka.stroke(n,this,t))}else i.__pathInputed?Bh(this,t,e):this.__drawFast(t,e)},__renderShape(t,e,i,s){if(this.__worldOpacity){t.setWorld(this.__nowWorld=this.__getNowWorld(e));const{fill:n,stroke:o}=this.__;this.__drawRenderPath(t),n&&!i&&(this.__.__pixelFill?Ka.fills(n,this,t):Ka.fill("#000000",this,t)),this.__.__isCanvas&&this.__drawAfterFill(t,e),o&&!s&&(this.__.__pixelStroke?Ka.strokes(o,this,t):Ka.stroke("#000000",this,t))}},__drawAfterFill(t,e){this.__.__clipAfterFill?(t.save(),this.windingRule?t.clip(this.windingRule):t.clip(),this.__drawContent(t,e),t.restore()):this.__drawContent(t,e)}};function Bh(t,e,i){const{fill:s,stroke:n,__drawAfterFill:o}=t.__;t.__drawRenderPath(e),s&&Ka.fill(s,t,e),o&&t.__drawAfterFill(e,i),n&&Ka.stroke(n,t,e)}const Rh={__drawFast(t,e){let{width:i,height:s,fill:n,stroke:o,__drawAfterFill:r}=this.__;if(n&&(t.fillStyle=n,t.fillRect(0,0,i,s)),r&&this.__drawAfterFill(t,e),o){const{strokeAlign:n,__strokeWidth:r}=this.__;if(!r)return;t.setStroke(o,r,this.__);const a=r/2;switch(n){case"center":t.strokeRect(0,0,i,s);break;case"inside":i-=r,s-=r,i<0||s<0?(t.save(),this.__clip(t,e),t.strokeRect(a,a,i,s),t.restore()):t.strokeRect(a,a,i,s);break;case"outside":t.strokeRect(-a,-a,i+r,s+r)}}}};var Ch;let kh=Ch=class extends Jr{get app(){return this.leafer&&this.leafer.app}get isFrame(){return!1}set scale(t){a.assignScale(this,t)}get scale(){return this.__.scale}get pen(){const{path:t}=this.__;return rn.set(this.path=t||[]),t||this.__drawPathByBox(rn),rn}get editConfig(){}get editOuter(){return""}get editInner(){return""}constructor(t){super(t)}reset(t){}set(t,e){e?(this.lockNormalStyle=!0,Object.assign(this,t),this.lockNormalStyle=!1):Object.assign(this,t)}get(t){return"string"==typeof t?this.__.__getInput(t):this.__.__getInputData(t)}createProxyData(){}find(t,e){}findTag(t){return this.find({tag:t})}findOne(t,e){}findId(t){return this.findOne({id:t})}getPath(t,e){this.__layout.update();let i=e?this.__.__pathForRender:this.__.path;return i||(rn.set(i=[]),this.__drawPathByBox(rn)),t?yi.toCanvasData(i,!0):i}getPathString(t,e){return yi.stringify(this.getPath(t,e))}load(){this.__.__computePaint()}__onUpdateSize(){if(this.__.__input){const t=this.__;!t.lazy||this.__inLazyBounds||Ja.running?t.__computePaint():t.__needComputePaint=!0}}__updateRenderPath(){if(this.__.path){const t=this.__;t.__pathForRender=t.cornerRadius?on.smooth(t.path,t.cornerRadius,t.cornerSmoothing):t.path,t.__useArrow&&Ga.addArrows(this,!t.cornerRadius)}}__drawRenderPath(t){t.beginPath(),this.__drawPathByData(t,this.__.__pathForRender)}__drawPath(t){t.beginPath(),this.__drawPathByData(t,this.__.path)}__drawPathByData(t,e){e?ms.drawPathByData(t,e):this.__drawPathByBox(t)}__drawPathByBox(t){const{x:e,y:i,width:s,height:n}=this.__layout.boxBounds;if(this.__.cornerRadius){const{cornerRadius:o}=this.__;t.roundRect(e,i,s,n,"number"==typeof o?[o]:o)}else t.rect(e,i,s,n)}animate(t,e,i,s){return Ct("animate")}killAnimate(t){}export(t,e){return Ja.export(this,t,e)}clone(t){const e=this.toJSON();return t&&Object.assign(e,t),Ch.one(e)}static one(t,e,i,s,n){return Et.get(t.tag||this.prototype.__tag,t,e,i,s,n)}static registerUI(){so()(this)}static registerData(t){Gn(t)(this.prototype)}static setEditConfig(t){}static setEditOuter(t){}static setEditInner(t){}destroy(){this.fill=this.stroke=null,this.__animate&&this.killAnimate(),super.destroy()}};zt([Gn(oh)],kh.prototype,"__",void 0),zt([ja()],kh.prototype,"zoomLayer",void 0),zt([Rn("")],kh.prototype,"id",void 0),zt([Rn("")],kh.prototype,"name",void 0),zt([Rn("")],kh.prototype,"className",void 0),zt([Fn("pass-through")],kh.prototype,"blendMode",void 0),zt([zn(1)],kh.prototype,"opacity",void 0),zt([Nn(!0)],kh.prototype,"visible",void 0),zt([Fn(!1)],kh.prototype,"locked",void 0),zt([Xn(0)],kh.prototype,"zIndex",void 0),zt([jn(!1)],kh.prototype,"mask",void 0),zt([Hn(!1)],kh.prototype,"eraser",void 0),zt([Cn(0,!0)],kh.prototype,"x",void 0),zt([Cn(0,!0)],kh.prototype,"y",void 0),zt([Pn(100,!0)],kh.prototype,"width",void 0),zt([Pn(100,!0)],kh.prototype,"height",void 0),zt([En(1,!0)],kh.prototype,"scaleX",void 0),zt([En(1,!0)],kh.prototype,"scaleY",void 0),zt([Tn(0,!0)],kh.prototype,"rotation",void 0),zt([Tn(0,!0)],kh.prototype,"skewX",void 0),zt([Tn(0,!0)],kh.prototype,"skewY",void 0),zt([Cn(0,!0)],kh.prototype,"offsetX",void 0),zt([Cn(0,!0)],kh.prototype,"offsetY",void 0),zt([Cn(0,!0)],kh.prototype,"scrollX",void 0),zt([Cn(0,!0)],kh.prototype,"scrollY",void 0),zt([kn()],kh.prototype,"origin",void 0),zt([kn()],kh.prototype,"around",void 0),zt([Rn(!1)],kh.prototype,"lazy",void 0),zt([On(1)],kh.prototype,"pixelRatio",void 0),zt([Ln()],kh.prototype,"path",void 0),zt([Dn()],kh.prototype,"windingRule",void 0),zt([Dn(!0)],kh.prototype,"closed",void 0),zt([Pn(0)],kh.prototype,"padding",void 0),zt([Rn(!1)],kh.prototype,"draggable",void 0),zt([Rn()],kh.prototype,"dragBounds",void 0),zt([Rn(!1)],kh.prototype,"editable",void 0),zt([Un(!0)],kh.prototype,"hittable",void 0),zt([Un("path")],kh.prototype,"hitFill",void 0),zt([In("path")],kh.prototype,"hitStroke",void 0),zt([Un(!1)],kh.prototype,"hitBox",void 0),zt([Un(!0)],kh.prototype,"hitChildren",void 0),zt([Un(!0)],kh.prototype,"hitSelf",void 0),zt([Un()],kh.prototype,"hitRadius",void 0),zt([Vn("")],kh.prototype,"cursor",void 0),zt([Fn()],kh.prototype,"fill",void 0),zt([In()],kh.prototype,"stroke",void 0),zt([In("inside")],kh.prototype,"strokeAlign",void 0),zt([In(1)],kh.prototype,"strokeWidth",void 0),zt([In(!1)],kh.prototype,"strokeWidthFixed",void 0),zt([In("none")],kh.prototype,"strokeCap",void 0),zt([In("miter")],kh.prototype,"strokeJoin",void 0),zt([In()],kh.prototype,"dashPattern",void 0),zt([In()],kh.prototype,"dashOffset",void 0),zt([In(10)],kh.prototype,"miterLimit",void 0),zt([Dn(0)],kh.prototype,"cornerRadius",void 0),zt([Dn()],kh.prototype,"cornerSmoothing",void 0),zt([Ya()],kh.prototype,"shadow",void 0),zt([Ya()],kh.prototype,"innerShadow",void 0),zt([Ya()],kh.prototype,"blur",void 0),zt([Ya()],kh.prototype,"backgroundBlur",void 0),zt([Ya()],kh.prototype,"grayscale",void 0),zt([Rn({})],kh.prototype,"data",void 0),zt([$n(Jr.prototype.reset)],kh.prototype,"reset",null),kh=Ch=zt([io(xh),io(bh),to()],kh);let Eh=class extends kh{get __tag(){return"Group"}get isBranch(){return!0}constructor(t){super(t)}reset(t){this.__setBranch(),super.reset(t)}__setBranch(){this.children||(this.children=[])}set(t,e){if(t.children){const{children:i}=t;delete t.children,this.children?this.clear():this.__setBranch(),super.set(t,e),i.forEach((t=>this.add(t))),t.children=i}else super.set(t,e)}toJSON(t){const e=super.toJSON(t);return e.children=this.children.map((e=>e.toJSON(t))),e}pick(t,e){}addAt(t,e){this.add(t,e)}addAfter(t,e){this.add(t,this.children.indexOf(e)+1)}addBefore(t,e){this.add(t,this.children.indexOf(e))}add(t,e){}addMany(...t){}remove(t,e){}removeAll(t){}clear(){}};var Th;zt([Gn(rh)],Eh.prototype,"__",void 0),Eh=zt([io(aa),so()],Eh);const Ph=vt.get("Leafer");let Oh=Th=class extends Eh{get __tag(){return"Leafer"}get isApp(){return!1}get app(){return this.parent||this}get isLeafer(){return!0}get imageReady(){return this.viewReady&&pn.isComplete}get layoutLocked(){return!this.layouter.running}get FPS(){return this.renderer?this.renderer.FPS:60}get cursorPoint(){return this.interaction&&this.interaction.hoverData||{x:this.width/2,y:this.height/2}}get clientBounds(){return this.canvas&&this.canvas.getClientBounds()}constructor(t,e){super(e),this.config={type:"design",start:!0,hittable:!0,smooth:!0,lazySpeard:100,zoom:{min:.01,max:256},move:{holdSpaceKey:!0,holdMiddleKey:!0,autoDistance:2}},this.leafs=0,this.__eventIds=[],this.__controllers=[],this.__readyWait=[],this.__viewReadyWait=[],this.__viewCompletedWait=[],this.__nextRenderWait=[],this.userConfig=t,t&&(t.view||t.width)&&this.init(t),Th.list.add(this)}init(t,i){if(this.canvas)return;let s;this.__setLeafer(this),t&&Dt.assign(this.config,t);const{config:n}=this;this.initType(n.type);const o=this.canvas=e.canvas(n);this.__controllers.push(this.renderer=e.renderer(this,o,n),this.watcher=e.watcher(this,n),this.layouter=e.layouter(this,n)),this.isApp&&this.__setApp(),this.__checkAutoLayout(n,i),this.view=o.view,i?(this.__bindApp(i),s=i.running):(this.selector=e.selector(this),this.interaction=e.interaction(this,o,this.selector,n),this.interaction&&(this.__controllers.unshift(this.interaction),this.hitCanvasManager=e.hitCanvasManager()),this.canvasManager=new Lt,s=n.start),this.hittable=n.hittable,this.fill=n.fill,this.canvasManager.add(o),this.__listenEvents(),s&&(this.__startTimer=setTimeout(this.start.bind(this))),Oo.run(this.__initWait),this.onInit()}onInit(){}initType(t){}set(t){this.waitInit((()=>{super.set(t)}))}start(){clearTimeout(this.__startTimer),!this.running&&this.canvas&&(this.ready?this.emitLeafer(Ko.RESTART):this.emitLeafer(Ko.START),this.__controllers.forEach((t=>t.start())),this.isApp||this.renderer.render(),this.running=!0)}stop(){clearTimeout(this.__startTimer),this.running&&this.canvas&&(this.__controllers.forEach((t=>t.stop())),this.running=!1,this.emitLeafer(Ko.STOP))}unlockLayout(){this.layouter.start(),this.updateLayout()}lockLayout(){this.updateLayout(),this.layouter.stop()}resize(t){const e=Dt.copyAttrs({},t,Kt);Object.keys(e).forEach((t=>this[t]=e[t]))}forceRender(t){this.renderer.addBlock(t?new ht(t):this.canvas.bounds),this.viewReady&&this.renderer.update()}updateCursor(t){const e=this.interaction;e&&(t?e.setCursor(t):e.updateCursor())}updateLazyBounds(){this.lazyBounds=this.canvas.bounds.clone().spread(this.config.lazySpeard)}__doResize(t){const{canvas:e}=this;if(!e||e.isSameSize(t))return;const i=Dt.copyAttrs({},this.canvas,Kt);e.resize(t),this.updateLazyBounds(),this.__onResize(new Ho(t,i))}__onResize(t){this.emitEvent(t),Dt.copyAttrs(this.__,t,Kt),t.width&&t.height||Ph.warn("w = 0 or h = 0"),setTimeout((()=>{this.canvasManager&&this.canvasManager.clearRecycled()}),0)}__setApp(){}__bindApp(t){this.selector=t.selector,this.interaction=t.interaction,this.canvasManager=t.canvasManager,this.hitCanvasManager=t.hitCanvasManager}__setLeafer(t){this.leafer=t,this.__level=1}__checkAutoLayout(t,e){e||(t.width&&t.height||(this.autoLayout=new dt(t)),this.canvas.startAutoLayout(this.autoLayout,this.__onResize.bind(this)))}__setAttr(t,e){return this.canvas&&(Kt.includes(t)?(e||Ph.warn(t+" is 0"),this.__changeCanvasSize(t,e)):"fill"===t?this.__changeFill(e):"hittable"===t?this.parent||(this.canvas.hittable=e):"zIndex"===t&&(this.canvas.zIndex=e,setTimeout((()=>this.parent&&this.parent.__updateSortChildren())))),super.__setAttr(t,e)}__getAttr(t){return this.canvas&&Kt.includes(t)?this.canvas[t]:super.__getAttr(t)}__changeCanvasSize(t,e){const i=Dt.copyAttrs({},this.canvas,Kt);i[t]=this.config[t]=e,e&&this.canvas.stopAutoLayout(),this.__doResize(i)}__changeFill(t){this.config.fill=t,this.canvas.allowBackgroundColor?this.canvas.backgroundColor=t:this.forceRender()}__onCreated(){this.created=!0}__onReady(){this.ready||(this.ready=!0,this.emitLeafer(Ko.BEFORE_READY),this.emitLeafer(Ko.READY),this.emitLeafer(Ko.AFTER_READY),Oo.run(this.__readyWait))}__onViewReady(){this.viewReady||(this.viewReady=!0,this.emitLeafer(Ko.VIEW_READY),Oo.run(this.__viewReadyWait))}__onNextRender(){if(this.viewReady){Oo.run(this.__nextRenderWait);const{imageReady:t}=this;t&&!this.viewCompleted&&this.__checkViewCompleted(),t||(this.viewCompleted=!1)}}__checkViewCompleted(t=!0){this.nextRender((()=>{this.imageReady&&(t&&this.emitLeafer(Ko.VIEW_COMPLETED),Oo.run(this.__viewCompletedWait),this.viewCompleted=!0)}))}__onWatchData(){this.watcher.childrenChanged&&this.interaction&&this.nextRender((()=>this.interaction.updateCursor()))}waitInit(t,e){e&&(t=t.bind(e)),this.__initWait||(this.__initWait=[]),this.canvas?t():this.__initWait.push(t)}waitReady(t,e){e&&(t=t.bind(e)),this.ready?t():this.__readyWait.push(t)}waitViewReady(t,e){e&&(t=t.bind(e)),this.viewReady?t():this.__viewReadyWait.push(t)}waitViewCompleted(t,e){e&&(t=t.bind(e)),this.__viewCompletedWait.push(t),this.viewCompleted?this.__checkViewCompleted(!1):this.running||this.start()}nextRender(t,e,i){e&&(t=t.bind(e));const s=this.__nextRenderWait;if(i){for(let e=0;e<s.length;e++)if(s[e]===t){s.splice(e,1);break}}else s.push(t)}zoom(t,e,i){return Ct("view")}getValidMove(t,e){return{x:t,y:e}}getValidScale(t){return t}getWorldPointByClient(t,e){return this.interaction&&this.interaction.getLocal(t,e)}getPagePointByClient(t,e){return this.getPagePoint(this.getWorldPointByClient(t,e))}updateClientBounds(){this.canvas&&this.canvas.updateClientBounds()}receiveEvent(t){}__checkUpdateLayout(){this.__layout.update()}emitLeafer(t){this.emitEvent(new Ko(t,this))}__listenEvents(){const t=Bt.start("FirstCreate "+this.innerName);this.once(Ko.START,(()=>Bt.end(t))),this.once(Vo.START,(()=>this.updateLazyBounds())),this.once(Vo.END,(()=>this.__onReady())),this.once(Go.START,(()=>this.__onCreated())),this.once(Go.END,(()=>this.__onViewReady())),this.__eventIds.push(this.on_(Uo.DATA,this.__onWatchData,this),this.on_(Go.NEXT,this.__onNextRender,this),this.on_(Vo.CHECK_UPDATE,this.__checkUpdateLayout,this))}__removeListenEvents(){this.off_(this.__eventIds),this.__eventIds.length=0}destroy(t){const e=()=>{if(!this.destroyed){Th.list.remove(this);try{this.stop(),this.emitEvent(new Ko(Ko.END,this)),this.__removeListenEvents(),this.__controllers.forEach((t=>{this.parent&&t===this.interaction||t.destroy()})),this.__controllers.length=0,this.parent||(this.selector&&this.selector.destroy(),this.hitCanvasManager&&this.hitCanvasManager.destroy(),this.canvasManager.destroy()),this.canvas.destroy(),this.config.view=this.view=null,this.userConfig&&(this.userConfig.view=null),super.destroy(),setTimeout((()=>{pn.clearRecycled()}),100)}catch(t){Ph.error(t)}}};t?e():setTimeout(e)}};Oh.list=new ha,zt([Gn(hh)],Oh.prototype,"__",void 0),zt([Pn()],Oh.prototype,"pixelRatio",void 0),Oh=Th=zt([so()],Oh);let Sh=class extends kh{get __tag(){return"Rect"}constructor(t){super(t)}};zt([Gn(ch)],Sh.prototype,"__",void 0),Sh=zt([io(Rh),to(),so()],Sh);const{copy:Lh,add:Dh,includes:Mh}=nt,Ah=Sh.prototype,Ih=Eh.prototype,Wh={};let Fh=class extends Eh{get __tag(){return"Box"}get isBranchLeaf(){return!0}constructor(t){super(t),this.__layout.renderChanged||this.__layout.renderChange()}__updateStrokeSpread(){return 0}__updateRectRenderSpread(){return 0}__updateRenderSpread(){return this.__updateRectRenderSpread()||-1}__updateRectBoxBounds(){}__updateBoxBounds(t){const e=this.__;if(this.children.length)if(e.__autoSide){super.__updateBoxBounds();const{boxBounds:t}=this.__layout;e.__autoSize||(e.__autoWidth?(t.width+=t.x,t.x=0,t.height=e.height,t.y=0):(t.height+=t.y,t.y=0,t.width=e.width,t.x=0)),this.__updateNaturalSize()}else this.__updateRectBoxBounds();else this.__updateRectBoxBounds()}__updateStrokeBounds(){}__updateRenderBounds(){let t;const{renderBounds:e}=this.__layout;this.children.length?(super.__updateRenderBounds(),Lh(Wh,e),this.__updateRectRenderBounds(),t=!Mh(e,Wh),t&&"hide"!==this.__.overflow&&Dh(e,Wh)):this.__updateRectRenderBounds(),!this.isOverflow!=!t&&(this.isOverflow=t)}__updateRectRenderBounds(){}__updateRectChange(){}__updateChange(){super.__updateChange(),this.__updateRectChange()}__renderRect(t,e){}__renderGroup(t,e){}__render(t,e){this.__.__drawAfterFill?this.__renderRect(t,e):(this.__renderRect(t,e),this.children.length&&this.__renderGroup(t,e))}__drawContent(t,e){this.__renderGroup(t,e),this.__.__hasStroke&&(t.setWorld(this.__nowWorld),this.__drawRenderPath(t))}};zt([Gn(ah)],Fh.prototype,"__",void 0),zt([Rn(!1)],Fh.prototype,"resizeChildren",void 0),zt([Rn(!1)],Fh.prototype,"textBox",void 0),zt([Wn("show")],Fh.prototype,"overflow",void 0),zt([$n(Ah.__updateStrokeSpread)],Fh.prototype,"__updateStrokeSpread",null),zt([$n(Ah.__updateRenderSpread)],Fh.prototype,"__updateRectRenderSpread",null),zt([$n(Ah.__updateBoxBounds)],Fh.prototype,"__updateRectBoxBounds",null),zt([$n(Ah.__updateStrokeBounds)],Fh.prototype,"__updateStrokeBounds",null),zt([$n(Ah.__updateRenderBounds)],Fh.prototype,"__updateRectRenderBounds",null),zt([$n(Ah.__updateChange)],Fh.prototype,"__updateRectChange",null),zt([$n(Ah.__render)],Fh.prototype,"__renderRect",null),zt([$n(Ih.__render)],Fh.prototype,"__renderGroup",null),Fh=zt([to(),so()],Fh);let zh=class extends Fh{get __tag(){return"Frame"}get isFrame(){return!0}constructor(t){super(t)}};zt([Gn(lh)],zh.prototype,"__",void 0),zt([Fn("#FFFFFF")],zh.prototype,"fill",void 0),zt([Wn("hide")],zh.prototype,"overflow",void 0),zh=zt([so()],zh);const{moveTo:Nh,closePath:Yh,ellipse:Xh}=Ni;let jh=class extends kh{get __tag(){return"Ellipse"}constructor(t){super(t)}__updatePath(){const{width:e,height:i,innerRadius:s,startAngle:n,endAngle:o}=this.__,r=e/2,a=i/2,h=this.__.path=[];s?(n||o?(s<1&&Xh(h,r,a,r*s,a*s,0,n,o,!1),Xh(h,r,a,r,a,0,o,n,!0),s<1&&Yh(h)):(s<1&&(Xh(h,r,a,r*s,a*s),Nh(h,e,a)),Xh(h,r,a,r,a,0,360,0,!0)),t.ellipseToCurve&&(this.__.path=this.getPath(!0))):n||o?(Nh(h,r,a),Xh(h,r,a,r,a,0,n,o,!1),Yh(h)):Xh(h,r,a,r,a)}};zt([Gn(uh)],jh.prototype,"__",void 0),zt([Dn(0)],jh.prototype,"innerRadius",void 0),zt([Dn(0)],jh.prototype,"startAngle",void 0),zt([Dn(0)],jh.prototype,"endAngle",void 0),jh=zt([so()],jh);const{moveTo:Hh,lineTo:Uh,drawPoints:Vh}=Ni,{rotate:Gh,getAngle:Kh,getDistance:qh,defaultPoint:Zh}=L,{toBounds:Qh}=Zs;let Jh=class extends kh{get __tag(){return"Line"}get toPoint(){const{width:t,rotation:e}=this.__,i={x:0,y:0};return t&&(i.x=t),e&&Gh(i,e),i}set toPoint(t){this.width=qh(Zh,t),this.rotation=Kh(Zh,t),this.height&&(this.height=0)}constructor(t){super(t)}__updatePath(){const t=this.__,e=t.path=[];t.points?Vh(e,t.points,!1,t.closed):(Hh(e,0,0),Uh(e,this.width,0))}__updateRenderPath(){const t=this.__;!this.pathInputed&&t.points&&t.curve?(Vh(t.__pathForRender=[],t.points,t.curve,t.closed),t.__useArrow&&Ga.addArrows(this,!1)):super.__updateRenderPath()}__updateBoxBounds(){this.points?Qh(this.__.__pathForRender,this.__layout.boxBounds):super.__updateBoxBounds()}};zt([Gn(dh)],Jh.prototype,"__",void 0),zt([Mn("center")],Jh.prototype,"strokeAlign",void 0),zt([Pn(0)],Jh.prototype,"height",void 0),zt([Dn()],Jh.prototype,"points",void 0),zt([Dn(0)],Jh.prototype,"curve",void 0),zt([Dn(!1)],Jh.prototype,"closed",void 0),Jh=zt([so()],Jh);const{sin:$h,cos:tl,PI:el}=Math,{moveTo:il,lineTo:sl,closePath:nl,drawPoints:ol}=Ni,rl=Jh.prototype;let al=class extends kh{get __tag(){return"Polygon"}constructor(t){super(t)}__updatePath(){const t=this.__.path=[];if(this.__.points)ol(t,this.__.points,!1,!0);else{const{width:e,height:i,sides:s}=this.__,n=e/2,o=i/2;il(t,n,0);for(let e=1;e<s;e++)sl(t,n+n*$h(2*e*el/s),o-o*tl(2*e*el/s))}nl(t)}__updateRenderPath(){}__updateBoxBounds(){}};zt([Gn(_h)],al.prototype,"__",void 0),zt([Dn(3)],al.prototype,"sides",void 0),zt([Dn()],al.prototype,"points",void 0),zt([Dn(0)],al.prototype,"curve",void 0),zt([$n(rl.__updateRenderPath)],al.prototype,"__updateRenderPath",null),zt([$n(rl.__updateBoxBounds)],al.prototype,"__updateBoxBounds",null),al=zt([to(),so()],al);const{sin:hl,cos:ll,PI:dl}=Math,{moveTo:cl,lineTo:ul,closePath:_l}=Ni;let pl=class extends kh{get __tag(){return"Star"}constructor(t){super(t)}__updatePath(){const{width:t,height:e,corners:i,innerRadius:s}=this.__,n=t/2,o=e/2,r=this.__.path=[];cl(r,n,0);for(let t=1;t<2*i;t++)ul(r,n+(t%2==0?n:n*s)*hl(t*dl/i),o-(t%2==0?o:o*s)*ll(t*dl/i));_l(r)}};zt([Gn(ph)],pl.prototype,"__",void 0),zt([Dn(5)],pl.prototype,"corners",void 0),zt([Dn(.382)],pl.prototype,"innerRadius",void 0),pl=zt([so()],pl);let gl=class extends Sh{get __tag(){return"Image"}get ready(){return!!this.image&&this.image.ready}constructor(t){super(t),this.on(jo.LOADED,(t=>{"fill"===t.attrName&&t.attrValue.url===this.url&&(this.image=t.image)}))}destroy(){this.image=null,super.destroy()}};zt([Gn(vh)],gl.prototype,"__",void 0),zt([Pn("")],gl.prototype,"url",void 0),gl=zt([so()],gl);const fl=gl;let yl=class extends Sh{get __tag(){return"Canvas"}get ready(){return!this.url}constructor(t){super(t),this.canvas=e.canvas(this.__),this.context=this.canvas.context,t&&t.url&&this.drawImage(t.url)}drawImage(t){new mn({url:t}).load((t=>{this.context.drawImage(t.view,0,0),this.url=void 0,this.paint(),this.emitEvent(new jo(jo.LOADED,{image:t}))}))}draw(t,e,i,s){const n=new z(t.worldTransform).invert(),o=new z;e&&o.translate(e.x,e.y),i&&("number"==typeof i?o.scale(i):o.scale(i.x,i.y)),s&&o.rotate(s),n.multiplyParent(o),t.__render(this.canvas,{matrix:n.withScale()}),this.paint()}paint(){this.forceRender()}__drawContent(t,e){const{width:i,height:s}=this.__,{view:n}=this.canvas;t.drawImage(n,0,0,n.width,n.height,0,0,i,s)}__updateSize(){const{canvas:t}=this;if(t){const{smooth:e}=this.__;t.smooth!==e&&(t.smooth=e),t.resize(this.__)}}destroy(){this.canvas&&(this.canvas.destroy(),this.canvas=this.context=null),super.destroy()}};zt([Gn(wh)],yl.prototype,"__",void 0),zt([Xa(100)],yl.prototype,"width",void 0),zt([Xa(100)],yl.prototype,"height",void 0),zt([Xa(1)],yl.prototype,"pixelRatio",void 0),zt([Xa(!0)],yl.prototype,"smooth",void 0),zt([Xa()],yl.prototype,"contextSettings",void 0),yl=zt([so()],yl);const{copyAndSpread:ml,includes:vl,isSame:wl,spread:xl,setList:bl}=nt;let Bl=class extends kh{get __tag(){return"Text"}get textDrawData(){return this.__layout.update(),this.__.__textDrawData}constructor(t){super(t)}__drawHitPath(t){const{__lineHeight:e,fontSize:i,__baseLine:s,__textDrawData:n}=this.__;t.beginPath(),this.__.__letterSpacing<0?this.__drawPathByData(t):n.rows.forEach((n=>t.rect(n.x,n.y-s,n.width,e<i?i:e)))}__drawPathByData(t,e){const{x:i,y:s,width:n,height:o}=this.__layout.boxBounds;t.rect(i,s,n,o)}__drawRenderPath(t){t.font=this.__.__font}__updateTextDrawData(){const t=this.__;t.__textDrawData=Ha.getDrawData(t.text,this.__)}__updateBoxBounds(){const t=this.__,e=this.__layout,{lineHeight:i,letterSpacing:s,fontFamily:n,fontSize:o,fontWeight:r,italic:h,textCase:l,textOverflow:d,padding:c}=t,u=t.__autoWidth,_=t.__autoHeight;t.__lineHeight=Va.number(i,o),t.__letterSpacing=Va.number(s,o),t.__padding=c?a.fourNumber(c):void 0,t.__baseLine=t.__lineHeight-(t.__lineHeight-.7*o)/2,t.__font=`${h?"italic ":""}${"small-caps"===l?"small-caps ":""}${"normal"!==r?r+" ":""}${o}px ${n}`,t.__clipText="show"!==d&&!t.__autoSize,this.__updateTextDrawData();const{bounds:p}=t.__textDrawData,g=e.boxBounds;if(t.__lineHeight<o&&xl(p,o/2),u||_){if(g.x=u?p.x:0,g.y=_?p.y:0,g.width=u?p.width:t.width,g.height=_?p.height:t.height,c){const[e,i,s,n]=t.__padding;u&&(g.x-=n,g.width+=i+n),_&&(g.y-=e,g.height+=s+e)}this.__updateNaturalSize()}else super.__updateBoxBounds();h&&(g.width+=.16*o);const f=vl(g,p)?g:p;wl(f,e.contentBounds)?t.__textBoxBounds=f:(e.contentBounds=f,e.renderChanged=!0,bl(t.__textBoxBounds={},[g,p]))}__updateRenderSpread(){let t=super.__updateRenderSpread();return t||(t=this.__layout.boxBounds===this.__layout.contentBounds?0:1),t}__updateRenderBounds(){ml(this.__layout.renderBounds,this.__.__textBoxBounds,this.__layout.renderSpread)}};zt([Gn(mh)],Bl.prototype,"__",void 0),zt([Pn(0)],Bl.prototype,"width",void 0),zt([Pn(0)],Bl.prototype,"height",void 0),zt([Rn(!1)],Bl.prototype,"resizeFontSize",void 0),zt([Fn("#000000")],Bl.prototype,"fill",void 0),zt([Mn("outside")],Bl.prototype,"strokeAlign",void 0),zt([Un("all")],Bl.prototype,"hitFill",void 0),zt([Pn("")],Bl.prototype,"text",void 0),zt([Pn("L")],Bl.prototype,"fontFamily",void 0),zt([Pn(12)],Bl.prototype,"fontSize",void 0),zt([Pn("normal")],Bl.prototype,"fontWeight",void 0),zt([Pn(!1)],Bl.prototype,"italic",void 0),zt([Pn("none")],Bl.prototype,"textCase",void 0),zt([Pn("none")],Bl.prototype,"textDecoration",void 0),zt([Pn(0)],Bl.prototype,"letterSpacing",void 0),zt([Pn({type:"percent",value:1.5})],Bl.prototype,"lineHeight",void 0),zt([Pn(0)],Bl.prototype,"paraIndent",void 0),zt([Pn(0)],Bl.prototype,"paraSpacing",void 0),zt([Pn("left")],Bl.prototype,"textAlign",void 0),zt([Pn("top")],Bl.prototype,"verticalAlign",void 0),zt([Pn(!0)],Bl.prototype,"autoSizeAlign",void 0),zt([Pn("normal")],Bl.prototype,"textWrap",void 0),zt([Pn("show")],Bl.prototype,"textOverflow",void 0),Bl=zt([so()],Bl);let Rl=class extends kh{get __tag(){return"Path"}constructor(t){super(t)}};zt([Gn(gh)],Rl.prototype,"__",void 0),zt([Mn("center")],Rl.prototype,"strokeAlign",void 0),Rl=zt([so()],Rl);let Cl=class extends Eh{get __tag(){return"Pen"}constructor(t){super(t)}setStyle(t){const e=this.pathElement=new Rl(t);return this.pathStyle=t,this.__path=e.path||(e.path=[]),this.add(e),this}beginPath(){return this.__path.length=0,this.paint(),this}moveTo(t,e){return this}lineTo(t,e){return this}bezierCurveTo(t,e,i,s,n,o){return this}quadraticCurveTo(t,e,i,s){return this}closePath(){return this}rect(t,e,i,s){return this}roundRect(t,e,i,s,n){return this}ellipse(t,e,i,s,n,o,r,a){return this}arc(t,e,i,s,n,o){return this}arcTo(t,e,i,s,n){return this}drawEllipse(t,e,i,s,n,o,r,a){return this}drawArc(t,e,i,s,n,o){return this}drawPoints(t,e,i){return this}clearPath(){return this}paint(){this.pathElement.__layout.boxChanged||this.pathElement.forceUpdate("path")}};zt([Gn(fh)],Cl.prototype,"__",void 0),zt([(t,e)=>{vn(t,e,{get(){return this.__path}})}],Cl.prototype,"path",void 0),Cl=zt([io(ss,["set","beginPath","path","paint"]),so()],Cl);let kl=class extends Oh{get __tag(){return"App"}get isApp(){return!0}constructor(t,e){super(t,e)}init(t,i){if(super.init(t,i),t){const{ground:i,tree:s,sky:n,editor:o}=t;i&&(this.ground=this.addLeafer(i)),(s||o)&&(this.tree=this.addLeafer(s)),(n||o)&&(this.sky=this.addLeafer(n||{type:"draw",usePartRender:!1})),o&&this.sky.add(this.editor=e.editor(o))}}__setApp(){const{canvas:t}=this,{realCanvas:e,view:i}=this.config;e||i===this.canvas.view||!t.parentView?this.realCanvas=!0:t.unrealCanvas(),this.leafer=this,this.watcher.disable(),this.layouter.disable(),this.__eventIds.push(this.on_(Xo.CHANGE,this.__onPropertyChange,this))}start(){super.start(),this.children.forEach((t=>t.start()))}stop(){this.children.forEach((t=>t.stop())),super.stop()}unlockLayout(){super.unlockLayout(),this.children.forEach((t=>t.unlockLayout()))}lockLayout(){super.lockLayout(),this.children.forEach((t=>t.lockLayout()))}forceRender(t){this.children.forEach((e=>e.forceRender(t)))}addLeafer(t){const e=new Oh(t);return this.add(e),e}add(t,e){if(!t.view){if(this.realCanvas&&!this.canvas.bounds)return void setTimeout((()=>this.add(t,e)),10);t.init(this.__getChildConfig(t.userConfig),this)}super.add(t,e),void 0!==e&&(t.canvas.childIndex=e),this.__listenChildEvents(t)}__onPropertyChange(){vt.showHitView&&this.children.forEach((t=>t.forceUpdate("surface")))}__onCreated(){this.created=this.children.every((t=>t.created))}__onReady(){this.children.every((t=>t.ready))&&super.__onReady()}__onViewReady(){this.children.every((t=>t.viewReady))&&super.__onViewReady()}__onChildRenderEnd(t){this.renderer.addBlock(t.renderBounds),this.viewReady&&this.renderer.update()}__render(t,e){if(t.context){if(e.matrix){const{a:i,b:s,c:n,d:o,e:r,f:a}=e.matrix;t.setTransform(i,s,n,o,r,a)}this.children.forEach((e=>t.copyWorld(e.canvas)))}}__onResize(t){this.children.forEach((e=>e.resize(t))),super.__onResize(t)}__checkUpdateLayout(){this.children.forEach((t=>t.__layout.update()))}__getChildConfig(t){let e=Object.assign({},this.config);return e.hittable=e.realCanvas=void 0,t&&Dt.assign(e,t),this.autoLayout&&Dt.copyAttrs(e,this,Kt),e.view=this.realCanvas?void 0:this.view,e.fill=void 0,e}__listenChildEvents(t){t.once(Vo.END,(()=>this.__onReady())),t.once(Go.START,(()=>this.__onCreated())),t.once(Go.END,(()=>this.__onViewReady())),this.realCanvas&&this.__eventIds.push(t.on_(Go.END,this.__onChildRenderEnd,this))}};kl=zt([so()],kl);const El={},Tl={isHoldSpaceKey:()=>Tl.isHold("Space"),isHold:t=>El[t],setDownCode(t){El[t]||(El[t]=!0)},setUpCode(t){El[t]=!1}},Pl={LEFT:1,RIGHT:2,MIDDLE:4,defaultLeft(t){t.buttons||(t.buttons=1)},left:t=>1===t.buttons,right:t=>2===t.buttons,middle:t=>4===t.buttons};class Ol extends No{get spaceKey(){return Tl.isHoldSpaceKey()}get left(){return Pl.left(this)}get right(){return Pl.right(this)}get middle(){return Pl.middle(this)}constructor(t){super(t.type),this.bubbles=!0,this.getInner=this.getInnerPoint,this.getLocal=this.getLocalPoint,this.getPage=this.getPagePoint,Object.assign(this,t)}getBoxPoint(t){return t||(t=this.current),t.getBoxPoint(this)}getInnerPoint(t){return t||(t=this.current),t.getInnerPoint(this)}getLocalPoint(t){return t||(t=this.current),t.getLocalPoint(this)}getPagePoint(){return this.current.getPagePoint(this)}static changeName(t,e){Ot.changeName(t,e)}}let Sl=class extends Ol{};Sl.POINTER="pointer",Sl.BEFORE_DOWN="pointer.before_down",Sl.BEFORE_MOVE="pointer.before_move",Sl.BEFORE_UP="pointer.before_up",Sl.DOWN="pointer.down",Sl.MOVE="pointer.move",Sl.UP="pointer.up",Sl.OVER="pointer.over",Sl.OUT="pointer.out",Sl.ENTER="pointer.enter",Sl.LEAVE="pointer.leave",Sl.TAP="tap",Sl.DOUBLE_TAP="double_tap",Sl.CLICK="click",Sl.DOUBLE_CLICK="double_click",Sl.LONG_PRESS="long_press",Sl.LONG_TAP="long_tap",Sl.MENU="pointer.menu",Sl.MENU_TAP="pointer.menu_tap",Sl=zt([no()],Sl);const Ll=Sl,Dl={};let Ml=class extends Sl{static setList(t){this.list=t instanceof ha?t:new ha(t)}static setData(t){this.data=t}static getValidMove(t,e,i){const{draggable:s,dragBounds:n,x:o,y:r}=t,a=t.getLocalPoint(i,null,!0);return a.x+=e.x-o,a.y+=e.y-r,n&&this.getMoveInDragBounds(t.__local,"parent"===n?t.parent.boxBounds:n,a,!0),"x"===s&&(a.y=0),"y"===s&&(a.x=0),a}static getMoveInDragBounds(t,e,i,s){const n=t.x+i.x,o=t.y+i.y,r=n+t.width,a=o+t.height,h=e.x+e.width,l=e.y+e.height;return s||(i=Object.assign({},i)),nt.includes(t,e)?(n>e.x?i.x+=e.x-n:r<h&&(i.x+=h-r),o>e.y?i.y+=e.y-o:a<l&&(i.y+=l-a)):(n<e.x?i.x+=e.x-n:r>h&&(i.x+=h-r),o<e.y?i.y+=e.y-o:a>l&&(i.y+=l-a)),i}getPageMove(t){return this.assignMove(t),this.current.getPagePoint(Dl,null,!0)}getInnerMove(t,e){return t||(t=this.current),this.assignMove(e),t.getInnerPoint(Dl,null,!0)}getLocalMove(t,e){return t||(t=this.current),this.assignMove(e),t.getLocalPoint(Dl,null,!0)}getPageTotal(){return this.getPageMove(!0)}getInnerTotal(t){return this.getInnerMove(t,!0)}getLocalTotal(t){return this.getLocalMove(t,!0)}getPageBounds(){const t=this.getPageTotal(),e=this.getPagePoint(),i={};return nt.set(i,e.x-t.x,e.y-t.y,t.x,t.y),nt.unsign(i),i}assignMove(t){Dl.x=t?this.totalX:this.moveX,Dl.y=t?this.totalY:this.moveY}};Ml.BEFORE_DRAG="drag.before_drag",Ml.START="drag.start",Ml.DRAG="drag",Ml.END="drag.end",Ml.OVER="drag.over",Ml.OUT="drag.out",Ml.ENTER="drag.enter",Ml.LEAVE="drag.leave",Ml=zt([no()],Ml);const Al=Ml;let Il=class extends Sl{static setList(t){Ml.setList(t)}static setData(t){Ml.setData(t)}};Il.DROP="drop",Il=zt([no()],Il);let Wl=class extends Ml{};Wl.BEFORE_MOVE="move.before_move",Wl.START="move.start",Wl.MOVE="move",Wl.END="move.end",Wl=zt([no()],Wl);let Fl=class extends Ol{};Fl.BEFORE_ROTATE="rotate.before_rotate",Fl.START="rotate.start",Fl.ROTATE="rotate",Fl.END="rotate.end",Fl=zt([no()],Fl);let zl=class extends Ml{};zl.SWIPE="swipe",zl.LEFT="swipe.left",zl.RIGHT="swipe.right",zl.UP="swipe.up",zl.DOWN="swipe.down",zl=zt([no()],zl);let Nl=class extends Ol{};Nl.BEFORE_ZOOM="zoom.before_zoom",Nl.START="zoom.start",Nl.ZOOM="zoom",Nl.END="zoom.end",Nl=zt([no()],Nl);let Yl=class extends Ol{};function Xl(t){t.isApp||t.__eventIds.push(t.on_(Wl.BEFORE_MOVE,(e=>{t.zoomLayer.move(t.getValidMove(e.moveX,e.moveY))})),t.on_(Nl.BEFORE_ZOOM,(e=>{const{zoomLayer:i}=t,s=t.getValidScale(e.scale);1!==s&&(L.scaleOf(i,e,s),i.scale=i.__.scaleX*s)})))}Yl.DOWN="key.down",Yl.HOLD="key.hold",Yl.UP="key.up",Yl=zt([no()],Yl);const jl=vt.get("LeaferTypeCreator"),Hl={list:{},register(t,e){Ul[t]?jl.repeat(t):Ul[t]=e},run(t,e){const i=Ul[t];i&&i(e)}},{list:Ul,register:Vl}=Hl;Vl("design",Xl),Vl("document",(function(t){Xl(t);const{move:e,zoom:i}=t.config;e.scroll="limit",i.min=1})),Vl("block",(function(t){const{config:e}=t;(e.wheel||(e.wheel={})).preventDefault=!1,(e.touch||(e.touch={})).preventDefault="auto"}));const Gl=Oh.prototype;Gl.initType=function(t){Hl.run(t,this)},Gl.getValidMove=function(t,e){const{scroll:i,disabled:s}=this.app.config.move;if(i&&(Math.abs(t)>Math.abs(e)?e=0:t=0,"limit"===i)){const{x:i,y:s,width:n,height:o}=new ht(this.__world).addPoint(this.zoomLayer),r=i+n-this.width,a=s+o-this.height;i>=0&&r<=0?t=0:t>0?i+t>0&&(t=-i):t<0&&r+t<0&&(t=-r),s>=0&&a<=0?e=0:e>0?s+e>0&&(e=-s):e<0&&a+e<0&&(e=-a)}return{x:s?0:t,y:s?0:e}},Gl.getValidScale=function(t){const{scaleX:e}=this.zoomLayer.__,{min:i,max:s,disabled:n}=this.app.config.zoom,o=Math.abs(e*t);return o<i?t=i/e:o>s&&(t=s/e),n?1:t};class Kl{get transforming(){return!!(this.moveData||this.zoomData||this.rotateData)}constructor(t){this.interaction=t}move(t){const{interaction:e}=this;if(t.moveType||(t.moveType="move"),!this.moveData){const{path:i}=e.selector.getByPoint(t,e.hitRadius);t.path=i,this.moveData=Object.assign(Object.assign({},t),{moveX:0,moveY:0}),e.cancelHover(),e.emit(Wl.START,this.moveData)}t.path=this.moveData.path,e.emit(Wl.BEFORE_MOVE,t),e.emit(Wl.MOVE,t),this.transformEndWait()}zoom(t){const{interaction:e}=this;if(!this.zoomData){const{path:i}=e.selector.getByPoint(t,e.hitRadius);t.path=i,this.zoomData=Object.assign(Object.assign({},t),{scale:1}),e.cancelHover(),e.emit(Nl.START,this.zoomData)}t.path=this.zoomData.path,e.emit(Nl.BEFORE_ZOOM,t),e.emit(Nl.ZOOM,t),this.transformEndWait()}rotate(t){const{interaction:e}=this;if(!this.rotateData){const{path:i}=e.selector.getByPoint(t,e.hitRadius);t.path=i,this.rotateData=Object.assign(Object.assign({},t),{rotation:0}),e.cancelHover(),e.emit(Fl.START,this.rotateData)}t.path=this.rotateData.path,e.emit(Fl.BEFORE_ROTATE,t),e.emit(Fl.ROTATE,t),this.transformEndWait()}transformEndWait(){clearTimeout(this.transformTimer),this.transformTimer=setTimeout((()=>{this.transformEnd()}),this.interaction.config.pointer.transformTime)}transformEnd(){this.moveEnd(),this.zoomEnd(),this.rotateEnd()}moveEnd(){this.moveData&&(this.interaction.emit(Wl.END,this.moveData),this.moveData=null)}zoomEnd(){this.zoomData&&(this.interaction.emit(Nl.END,this.zoomData),this.zoomData=null)}rotateEnd(){this.rotateData&&(this.interaction.emit(Fl.END,this.rotateData),this.rotateData=null)}destroy(){this.zoomData=this.moveData=this.rotateData=null}}const ql={getMoveEventData:(t,e,i)=>Object.assign(Object.assign({},i),{x:t.x,y:t.y,moveX:e.x,moveY:e.y}),getRotateEventData:(t,e,i)=>Object.assign(Object.assign({},i),{x:t.x,y:t.y,rotation:e}),getZoomEventData:(t,e,i)=>Object.assign(Object.assign({},i),{x:t.x,y:t.y,scale:e}),getDragEventData:(t,e,i)=>Object.assign(Object.assign({},i),{x:i.x,y:i.y,moveX:i.x-e.x,moveY:i.y-e.y,totalX:i.x-t.x,totalY:i.y-t.y}),getDropEventData:(t,e,i)=>Object.assign(Object.assign({},t),{list:e,data:i}),getSwipeDirection:t=>t<-45&&t>-135?zl.UP:t>45&&t<135?zl.DOWN:t<=45&&t>=-45?zl.RIGHT:zl.LEFT,getSwipeEventData:(t,e,i)=>Object.assign(Object.assign({},i),{moveX:e.moveX,moveY:e.moveY,totalX:i.x-t.x,totalY:i.y-t.y,type:Zl.getSwipeDirection(L.getAngle(t,i))}),getBase(t){const e=1===t.button?4:t.button;return{altKey:t.altKey,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,metaKey:t.metaKey,buttons:void 0===t.buttons?1:0===t.buttons?e:t.buttons,origin:t}},pathHasEventType(t,e){const{list:i}=t;for(let t=0,s=i.length;t<s;t++)if(i[t].hasEvent(e))return!0;return!1},filterPathByEventType(t,e){const i=new ha,{list:s}=t;for(let t=0,n=s.length;t<n;t++)s[t].hasEvent(e)&&i.add(s[t]);return i},pathCanDrag:t=>t&&t.list.some((t=>t.draggable||t.editable||!t.isLeafer&&t.hasEvent(Ml.DRAG))),pathHasOutside:t=>t&&t.list.some((t=>t.isOutside))},Zl=ql,Ql=new ha,{getDragEventData:Jl,getDropEventData:$l,getSwipeEventData:td}=ql;class ed{constructor(t){this.interaction=t}setDragData(t){this.animateWait&&this.dragEndReal(),this.downData=this.interaction.downData,this.dragData=Jl(t,t,t),this.canAnimate=this.canDragOut=!0}getList(t,e){const{proxy:i}=this.interaction.selector,s=i&&i.list.length,n=Ml.list||this.draggableList||Ql;return this.dragging&&(s?t?Ql:new ha(e?[...i.list,...i.dragHoverExclude]:i.list):n)}checkDrag(t,e){const{interaction:i}=this;if(this.moving&&t.buttons<1)return this.canAnimate=!1,void i.pointerCancel();!this.moving&&e&&(this.moving=i.canMove(this.downData)||i.isHoldRightKey||i.isMobileDragEmpty)&&(this.dragData.moveType="drag",i.emit(Wl.START,this.dragData)),this.moving||this.dragStart(t,e),this.drag(t)}dragStart(t,e){this.dragging||(this.dragging=e&&Pl.left(t),this.dragging&&(this.interaction.emit(Ml.START,this.dragData),this.getDraggableList(this.dragData.path),this.setDragStartPoints(this.realDraggableList=this.getList(!0))))}setDragStartPoints(t){this.dragStartPoints={},t.forEach((t=>this.dragStartPoints[t.innerId]={x:t.x,y:t.y}))}getDraggableList(t){let e;for(let i=0,s=t.length;i<s;i++)if(e=t.list[i],(e.draggable||e.editable)&&e.hitSelf&&!e.locked){this.draggableList=new ha(e);break}}drag(t){const{interaction:e,dragData:i,downData:s}=this,{path:n,throughPath:o}=s;this.dragData=Jl(s,i,t),o&&(this.dragData.throughPath=o),this.dragData.path=n,this.moving?(this.dragData.moveType="drag",e.emit(Wl.BEFORE_MOVE,this.dragData),e.emit(Wl.MOVE,this.dragData)):this.dragging&&(this.dragReal(),e.emit(Ml.BEFORE_DRAG,this.dragData),e.emit(Ml.DRAG,this.dragData))}dragReal(){const{running:t}=this.interaction,e=this.realDraggableList;if(e.length&&t){const{totalX:t,totalY:i}=this.dragData;e.forEach((e=>e.draggable&&e.move(Ml.getValidMove(e,this.dragStartPoints[e.innerId],{x:t,y:i}))))}}dragOverOrOut(t){const{interaction:e}=this,{dragOverPath:i}=this,{path:s}=t;this.dragOverPath=s,i?s.indexAt(0)!==i.indexAt(0)&&(e.emit(Ml.OUT,t,i),e.emit(Ml.OVER,t,s)):e.emit(Ml.OVER,t,s)}dragEnterOrLeave(t){const{interaction:e}=this,{dragEnterPath:i}=this,{path:s}=t;e.emit(Ml.LEAVE,t,i,s),e.emit(Ml.ENTER,t,s,i),this.dragEnterPath=s}dragEnd(t,e){if(!this.dragging&&!this.moving)return;const{moveX:i,moveY:s}=this.dragData;this.interaction.config.move.dragAnimate&&this.canAnimate&&this.moving&&(Math.abs(i)>1||Math.abs(s)>1)?(t=Object.assign({},t),e=.9*(e||("touch"===t.pointerType?2:1)),L.move(t,i*e,s*e),this.drag(t),this.animate((()=>{this.dragEnd(t,1)}))):this.dragEndReal(t)}dragEndReal(t){const{interaction:e,downData:i,dragData:s}=this;t||(t=s);const{path:n,throughPath:o}=i,r=Jl(i,t,t);if(o&&(r.throughPath=o),r.path=n,this.moving&&(this.moving=!1,r.moveType="drag",e.emit(Wl.END,r)),this.dragging){const n=this.getList();this.dragging=!1,e.emit(Ml.END,r),this.swipe(t,i,s,r),this.drop(t,n,this.dragEnterPath)}this.autoMoveCancel(),this.dragReset(),this.animate(null,"off")}animate(t,e){const i=t||this.animateWait;i&&this.interaction.target.nextRender(i,null,e),this.animateWait=t}swipe(t,e,i,s){const{interaction:n}=this;if(L.getDistance(e,t)>n.config.pointer.swipeDistance){const t=td(e,i,s);this.interaction.emit(t.type,t)}}drop(t,e,i){const s=$l(t,e,Ml.data);s.path=i,this.interaction.emit(Il.DROP,s),this.interaction.emit(Ml.LEAVE,t,i)}dragReset(){Ml.list=Ml.data=this.draggableList=this.dragData=this.downData=this.dragOverPath=this.dragEnterPath=null}checkDragOut(t){const{interaction:e}=this;this.autoMoveCancel(),this.dragging&&!e.shrinkCanvasBounds.hitPoint(t)&&this.autoMoveOnDragOut(t)}autoMoveOnDragOut(t){const{interaction:e,downData:i,canDragOut:s}=this,{autoDistance:n,dragOut:o}=e.config.move;if(!o||!s||!n)return;const r=e.shrinkCanvasBounds,{x:a,y:h}=r,l=nt.maxX(r),d=nt.maxY(r),c=t.x<a?n:l<t.x?-n:0,u=t.y<h?n:d<t.y?-n:0;let _=0,p=0;this.autoMoveTimer=setInterval((()=>{_+=c,p+=u,L.move(i,c,u),L.move(this.dragData,c,u),e.move(Object.assign(Object.assign({},t),{moveX:c,moveY:u,totalX:_,totalY:p,moveType:"drag"})),e.pointerMoveReal(t)}),10)}autoMoveCancel(){this.autoMoveTimer&&(clearInterval(this.autoMoveTimer),this.autoMoveTimer=0)}destroy(){this.dragReset()}}const id=vt.get("emit");const sd=["move","zoom","rotate","key"];function nd(t,e,i,s,n){if(sd.some((t=>e.startsWith(t)))&&t.__.hitChildren&&!rd(t,n)){let o;for(let r=0,a=t.children.length;r<a;r++)o=t.children[r],!i.path.has(o)&&o.__.hittable&&od(o,e,i,s,n)}}function od(t,e,i,s,n){if(t.destroyed)return!1;if(t.__.hitSelf&&!rd(t,n)&&($a.updateEventStyle&&!s&&$a.updateEventStyle(t,e),t.hasEvent(e,s))){i.phase=s?1:t===i.target?2:3;const n=Ot.get(e,i);if(t.emitEvent(n,s),n.isStop)return!0}return!1}function rd(t,e){return e&&e.has(t)}const ad={getData(t){const e=t[0],i=t[1],s=L.getCenter(e.from,i.from),n=L.getCenter(e.to,i.to),o={x:n.x-s.x,y:n.y-s.y},r=L.getDistance(e.from,i.from);return{move:o,scale:L.getDistance(e.to,i.to)/r,angle:L.getRotation(e.from,i.from,e.to,i.to),center:n}}},hd={wheel:{zoomSpeed:.5,moveSpeed:.5,rotateSpeed:.5,delta:{x:20,y:8},preventDefault:!0},pointer:{hitRadius:5,tapTime:120,longPressTime:800,transformTime:500,hover:!0,dragHover:!0,dragDistance:2,swipeDistance:20,preventDefaultMenu:!0},touch:{preventDefault:!0},multiTouch:{},cursor:!0,keyEvent:!0},{pathHasEventType:ld,getMoveEventData:dd,getZoomEventData:cd,getRotateEventData:ud,pathCanDrag:_d,pathHasOutside:pd}=ql;class gd{get dragging(){return this.dragger.dragging}get transforming(){return this.transformer.transforming}get moveMode(){return!0===this.config.move.drag||this.isHoldSpaceKey||this.isHoldMiddleKey||this.isHoldRightKey&&this.dragger.moving||this.isDragEmpty}get canHover(){return this.config.pointer.hover&&!this.config.mobile}get isDragEmpty(){return this.config.move.dragEmpty&&this.isRootPath(this.hoverData)&&(!this.downData||this.isRootPath(this.downData))}get isMobileDragEmpty(){return this.config.move.dragEmpty&&!this.canHover&&this.downData&&this.isTreePath(this.downData)}get isHoldMiddleKey(){return this.config.move.holdMiddleKey&&this.downData&&Pl.middle(this.downData)}get isHoldRightKey(){return this.config.move.holdRightKey&&this.downData&&Pl.right(this.downData)}get isHoldSpaceKey(){return this.config.move.holdSpaceKey&&Tl.isHoldSpaceKey()}get hitRadius(){return this.config.pointer.hitRadius}constructor(t,e,i,s){this.config=Dt.clone(hd),this.tapCount=0,this.downKeyMap={},this.target=t,this.canvas=e,this.selector=i,this.defaultPath=new ha(t),this.transformer=new Kl(this),this.dragger=new ed(this),s&&(this.config=Dt.default(s,this.config)),this.__listenEvents()}start(){this.running=!0}stop(){this.running=!1}receive(t){}pointerDown(t,e){t||(t=this.hoverData),t&&(Pl.defaultLeft(t),this.updateDownData(t),this.checkPath(t,e),this.downTime=Date.now(),this.emit(Sl.BEFORE_DOWN,t),this.emit(Sl.DOWN,t),Pl.left(t)&&(this.tapWait(),this.longPressWait(t)),this.waitRightTap=Pl.right(t),this.dragger.setDragData(t),this.isHoldRightKey||this.updateCursor(t))}pointerMove(t){if(t||(t=this.hoverData),!t)return;const{downData:e}=this;e&&Pl.defaultLeft(t);(this.canvas.bounds.hitPoint(t)||e)&&(this.pointerMoveReal(t),e&&this.dragger.checkDragOut(t))}pointerMoveReal(t){const{dragHover:e,dragDistance:i}=this.config.pointer;if(this.emit(Sl.BEFORE_MOVE,t,this.defaultPath),this.downData){const e=L.getDistance(this.downData,t)>i;e&&(this.waitTap&&this.pointerWaitCancel(),this.waitRightTap=!1),this.dragger.checkDrag(t,e)}this.dragger.moving||(this.updateHoverData(t),this.checkPath(t),this.emit(Sl.MOVE,t),this.dragging&&!e||this.pointerHover(t),this.dragger.dragging&&(this.dragger.dragOverOrOut(t),this.dragger.dragEnterOrLeave(t))),this.updateCursor(this.downData||t)}pointerUp(t){const{downData:e}=this;if(t||(t=e),!e)return;Pl.defaultLeft(t),t.multiTouch=e.multiTouch,this.findPath(t);const i=Object.assign(Object.assign({},t),{path:t.path.clone()});t.path.addList(e.path.list),this.checkPath(t),this.downData=null,this.emit(Sl.BEFORE_UP,t),this.emit(Sl.UP,t),this.touchLeave(t),t.isCancel||(this.tap(t),this.menuTap(t)),this.dragger.dragEnd(t),this.updateCursor(i)}pointerCancel(){const t=Object.assign({},this.dragger.dragData);t.isCancel=!0,this.pointerUp(t)}multiTouch(t,e){if(this.config.multiTouch.disabled)return;const{move:i,angle:s,scale:n,center:o}=ad.getData(e);this.rotate(ud(o,s,t)),this.zoom(cd(o,n,t)),this.move(dd(o,i,t))}menu(t){this.findPath(t),this.emit(Sl.MENU,t),this.waitMenuTap=!0,!this.downData&&this.waitRightTap&&this.menuTap(t)}menuTap(t){this.waitRightTap&&this.waitMenuTap&&(this.emit(Sl.MENU_TAP,t),this.waitRightTap=this.waitMenuTap=!1)}move(t){this.transformer.move(t)}zoom(t){this.transformer.zoom(t)}rotate(t){this.transformer.rotate(t)}transformEnd(){this.transformer.transformEnd()}keyDown(t){if(!this.config.keyEvent)return;const{code:e}=t;this.downKeyMap[e]||(this.downKeyMap[e]=!0,Tl.setDownCode(e),this.emit(Yl.HOLD,t,this.defaultPath),this.moveMode&&(this.cancelHover(),this.updateCursor())),this.emit(Yl.DOWN,t,this.defaultPath)}keyUp(t){if(!this.config.keyEvent)return;const{code:e}=t;this.downKeyMap[e]=!1,Tl.setUpCode(e),this.emit(Yl.UP,t,this.defaultPath),"grab"===this.cursor&&this.updateCursor()}pointerHover(t){this.canHover&&(this.pointerOverOrOut(t),this.pointerEnterOrLeave(t))}pointerOverOrOut(t){const{path:e}=t,{overPath:i}=this;this.overPath=e,i?e.indexAt(0)!==i.indexAt(0)&&(this.emit(Sl.OUT,t,i),this.emit(Sl.OVER,t,e)):this.emit(Sl.OVER,t,e)}pointerEnterOrLeave(t){let{path:e}=t;this.downData&&!this.moveMode&&(e=e.clone(),this.downData.path.forEach((t=>e.add(t))));const{enterPath:i}=this;this.enterPath=e,this.emit(Sl.LEAVE,t,i,e),this.emit(Sl.ENTER,t,e,i)}touchLeave(t){"touch"===t.pointerType&&this.enterPath&&(this.emit(Sl.LEAVE,t),this.dragger.dragging&&this.emit(Il.LEAVE,t))}tap(t){const{pointer:e}=this.config,i=this.longTap(t);if(!e.tapMore&&i)return;if(!this.waitTap)return;e.tapMore&&this.emitTap(t);const s=Date.now()-this.downTime,n=[Sl.DOUBLE_TAP,Sl.DOUBLE_CLICK].some((e=>ld(t.path,e)));s<e.tapTime+50&&n?(this.tapCount++,2===this.tapCount?(this.tapWaitCancel(),this.emitDoubleTap(t)):(clearTimeout(this.tapTimer),this.tapTimer=setTimeout((()=>{e.tapMore||(this.tapWaitCancel(),this.emitTap(t))}),e.tapTime))):e.tapMore||(this.tapWaitCancel(),this.emitTap(t))}findPath(t,e){const{hitRadius:i,through:s}=this.config.pointer,{bottomList:n}=this,o=this.selector.getByPoint(t,i,Object.assign({bottomList:n,name:t.type},e||{through:s}));return o.throughPath&&(t.throughPath=o.throughPath),t.path=o.path,o.path}isRootPath(t){return t&&t.path.list[0].isLeafer}isTreePath(t){const e=this.target.app;return!(!e||!e.isApp)&&(e.editor&&!t.path.has(e.editor)&&t.path.has(e.tree)&&!t.target.syncEventer)}checkPath(t,e){(e||this.moveMode&&!pd(t.path))&&(t.path=this.defaultPath)}canMove(t){return t&&(this.moveMode||"auto"===this.config.move.drag&&!_d(t.path))&&!pd(t.path)}isDrag(t){return this.dragger.getList().has(t)}isPress(t){return this.downData&&this.downData.path.has(t)}isHover(t){return this.enterPath&&this.enterPath.has(t)}isFocus(t){return this.focusData===t}cancelHover(){const{hoverData:t}=this;t&&(t.path=this.defaultPath,this.pointerHover(t))}updateDownData(t,e,i){const{downData:s}=this;!t&&s&&(t=s),t&&(this.findPath(t,e),i&&s&&t.path.addList(s.path.list),this.downData=t)}updateHoverData(t){t||(t=this.hoverData),t&&(this.findPath(t,{exclude:this.dragger.getList(!1,!0),name:Sl.MOVE}),this.hoverData=t)}updateCursor(t){if(!this.config.cursor||!this.canHover)return;if(t||(this.updateHoverData(),t=this.downData||this.hoverData),this.dragger.moving)return this.setCursor("grabbing");if(this.canMove(t))return this.setCursor(this.downData?"grabbing":"grab");if(!t)return;let e,i;const{path:s}=t;for(let t=0,n=s.length;t<n&&(e=s.list[t],i=e.syncEventer&&e.syncEventer.cursor||e.cursor,!i);t++);this.setCursor(i)}setCursor(t){this.cursor=t}getLocal(t,e){const i=this.canvas.getClientBounds(e);return{x:t.clientX-i.x,y:t.clientY-i.y}}emitTap(t){this.emit(Sl.TAP,t),this.emit(Sl.CLICK,t)}emitDoubleTap(t){this.emit(Sl.DOUBLE_TAP,t),this.emit(Sl.DOUBLE_CLICK,t)}pointerWaitCancel(){this.tapWaitCancel(),this.longPressWaitCancel()}tapWait(){clearTimeout(this.tapTimer),this.waitTap=!0}tapWaitCancel(){clearTimeout(this.tapTimer),this.waitTap=!1,this.tapCount=0}longPressWait(t){clearTimeout(this.longPressTimer),this.longPressTimer=setTimeout((()=>{this.longPressed=!0,this.emit(Sl.LONG_PRESS,t)}),this.config.pointer.longPressTime)}longTap(t){let e;return this.longPressed&&(this.emit(Sl.LONG_TAP,t),(ld(t.path,Sl.LONG_TAP)||ld(t.path,Sl.LONG_PRESS))&&(e=!0)),this.longPressWaitCancel(),e}longPressWaitCancel(){clearTimeout(this.longPressTimer),this.longPressed=!1}__onResize(){this.shrinkCanvasBounds=new ht(this.canvas.bounds),this.shrinkCanvasBounds.spread(-2)}__listenEvents(){const{target:t}=this;this.__eventIds=[t.on_(Ho.RESIZE,this.__onResize,this)],t.once(Ko.READY,(()=>this.__onResize()))}__removeListenEvents(){this.target.off_(this.__eventIds),this.__eventIds.length=0}emit(t,e,i,s){this.running&&function(t,e,i,s){if(!i&&!e.path)return;let n;e.type=t,i?e=Object.assign(Object.assign({},e),{path:i}):i=e.path,e.target=i.indexAt(0);try{for(let o=i.length-1;o>-1;o--){if(n=i.list[o],od(n,t,e,!0,s))return;n.isApp&&nd(n,t,e,!0,s)}for(let o=0,r=i.length;o<r;o++)if(n=i.list[o],n.isApp&&nd(n,t,e,!1,s),od(n,t,e,!1,s))return}catch(t){id.error(t)}}(t,e,i,s)}destroy(){this.__eventIds.length&&(this.stop(),this.__removeListenEvents(),this.dragger.destroy(),this.transformer.destroy(),this.downData=this.overPath=this.enterPath=null)}}class fd{static set(t,e){this.custom[t]=e}static get(t){return this.custom[t]}}fd.custom={};class yd extends Lt{constructor(){super(...arguments),this.maxTotal=1e3,this.pathList=new ha,this.pixelList=new ha}getPixelType(t,i){return this.__autoClear(),this.pixelList.add(t),e.hitCanvas(i)}getPathType(t){return this.__autoClear(),this.pathList.add(t),e.hitCanvas()}clearImageType(){this.__clearLeafList(this.pixelList)}clearPathType(){this.__clearLeafList(this.pathList)}__clearLeafList(t){t.length&&(t.forEach((t=>{t.__hitCanvas&&(t.__hitCanvas.destroy(),t.__hitCanvas=null)})),t.reset())}__autoClear(){this.pathList.length+this.pixelList.length>this.maxTotal&&this.clear()}clear(){this.clearPathType(),this.clearImageType()}}const{toInnerRadiusPointOf:md,copy:vd,setRadius:wd}=L,xd={},bd=Jr.prototype;bd.__hitWorld=function(t){if(!this.__.hitSelf)return!1;this.__.hitRadius&&(vd(xd,t),wd(t=xd,this.__.hitRadius)),md(t,this.__world,xd);const{width:e,height:i}=this.__world,s=e<10&&i<10;if(this.__.hitBox||s){if(nt.hitRadiusPoint(this.__layout.boxBounds,xd))return!0;if(s)return!1}return!this.__layout.hitCanvasChanged&&this.__hitCanvas||(this.__updateHitCanvas(),this.__layout.boundsChanged||(this.__layout.hitCanvasChanged=!1)),this.__hit(xd)},bd.__hitFill=function(t){var e;return null===(e=this.__hitCanvas)||void 0===e?void 0:e.hitFill(t,this.__.windingRule)},bd.__hitStroke=function(t,e){var i;return null===(i=this.__hitCanvas)||void 0===i?void 0:i.hitStroke(t,e)},bd.__hitPixel=function(t){var e;return null===(e=this.__hitCanvas)||void 0===e?void 0:e.hitPixel(t,this.__layout.renderBounds,this.__hitCanvas.hitScale)},bd.__drawHitPath=function(t){t&&this.__drawRenderPath(t)};const Bd=new z,Rd=kh.prototype;Rd.__updateHitCanvas=function(){const e=this.__,{hitCanvasManager:i}=this.leafer,s=(e.__pixelFill||e.__isCanvas)&&"pixel"===e.hitFill,n=e.__pixelStroke&&"pixel"===e.hitStroke,o=s||n;this.__hitCanvas||(this.__hitCanvas=o?i.getPixelType(this,{contextSettings:{willReadFrequently:!0}}):i.getPathType(this));const r=this.__hitCanvas;if(o){const{renderBounds:i}=this.__layout,o=t.image.hitCanvasSize,a=r.hitScale=lt.set(0,0,o,o).getFitMatrix(i).a,{x:h,y:l,width:d,height:c}=lt.set(i).scale(a);r.resize({width:d,height:c,pixelRatio:1}),r.clear(),pn.patternLocked=!0,this.__renderShape(r,{matrix:Bd.setWith(this.__world).scaleWith(1/a).invertWith().translate(-h,-l)},!s,!n),pn.patternLocked=!1,r.resetTransform(),e.__isHitPixel=!0}else e.__isHitPixel&&(e.__isHitPixel=!1);this.__drawHitPath(r),r.setStrokeOptions(e)},Rd.__hit=function(e){"miniapp"===t.name&&this.__drawHitPath(this.__hitCanvas);const i=this.__;if(i.__isHitPixel&&this.__hitPixel(e))return!0;const{hitFill:s}=i,n=(i.fill||i.__isCanvas)&&("path"===s||"pixel"===s&&!(i.__pixelFill||i.__isCanvas))||"all"===s;if(n&&this.__hitFill(e))return!0;const{hitStroke:o,__strokeWidth:r}=i,a=i.stroke&&("path"===o||"pixel"===o&&!i.__pixelStroke)||"all"===o;if(!n&&!a)return!1;const h=2*e.radiusX;let l=h;if(a)switch(i.strokeAlign){case"inside":if(l+=2*r,!n&&this.__hitFill(e)&&this.__hitStroke(e,l))return!0;l=h;break;case"center":l+=r;break;case"outside":if(l+=2*r,!n){if(!this.__hitFill(e)&&this.__hitStroke(e,l))return!0;l=h}}return!!l&&this.__hitStroke(e,l)};const Cd=kh.prototype,kd=Sh.prototype,Ed=Fh.prototype;kd.__updateHitCanvas=Ed.__updateHitCanvas=function(){this.stroke||this.cornerRadius||(this.fill||this.__.__isCanvas)&&"pixel"===this.hitFill||"all"===this.hitStroke?Cd.__updateHitCanvas.call(this):this.__hitCanvas&&(this.__hitCanvas=null)},kd.__hitFill=Ed.__hitFill=function(t){return this.__hitCanvas?Cd.__hitFill.call(this,t):nt.hitRadiusPoint(this.__layout.boxBounds,t)};const Td=kh.prototype,Pd=Eh.prototype;Td.find=function(t,e){return this.leafer?this.leafer.selector.getBy(t,this,!1,e):[]},Td.findOne=function(t,e){return this.leafer?this.leafer.selector.getBy(t,this,!0,e):null},Pd.pick=function(t,e){return this.__layout.update(),e||(e={}),this.leafer?this.leafer.selector.getByPoint(t,e.hitRadius||0,Object.assign(Object.assign({},e),{target:this})):null};const Od=qt.prototype;Od.hitFill=function(t,e){return e?this.context.isPointInPath(t.x,t.y,e):this.context.isPointInPath(t.x,t.y)},Od.hitStroke=function(t,e){return this.strokeWidth=e,this.context.isPointInStroke(t.x,t.y)},Od.hitPixel=function(t,e,i=1){let{x:s,y:n,radiusX:o,radiusY:r}=t;e&&(s-=e.x,n-=e.y),lt.set(s-o,n-r,2*o,2*r).scale(i).ceil();const{data:a}=this.context.getImageData(lt.x,lt.y,lt.width||1,lt.height||1);for(let t=0,e=a.length;t<e;t+=4)if(a[t+3]>0)return!0;return a[3]>0};const Sd={convert(t,e){const i=ql.getBase(t),s=Object.assign(Object.assign({},i),{x:e.x,y:e.y,width:t.width,height:t.height,pointerType:t.pointerType,pressure:t.pressure});return"pen"===s.pointerType&&(s.tangentialPressure=t.tangentialPressure,s.tiltX=t.tiltX,s.tiltY=t.tiltY,s.twist=t.twist),s},convertMouse(t,e){const i=ql.getBase(t);return Object.assign(Object.assign({},i),{x:e.x,y:e.y,width:1,height:1,pointerType:"mouse",pressure:.5})},convertTouch(t,e){const i=Sd.getTouch(t),s=ql.getBase(t);return Object.assign(Object.assign({},s),{x:e.x,y:e.y,width:1,height:1,pointerType:"touch",multiTouch:t.touches.length>1,pressure:i.force})},getTouch:t=>t.targetTouches[0]||t.changedTouches[0]},Ld={getMove(t,e){let{moveSpeed:i}=e,{deltaX:s,deltaY:n}=t;return t.shiftKey&&!s&&(s=n,n=0),s>50&&(s=Math.max(50,s/3)),n>50&&(n=Math.max(50,n/3)),{x:-s*i*2,y:-n*i*2}},getScale(e,i){let s,n=1,{zoomMode:o,zoomSpeed:r}=i;const h=e.deltaY||e.deltaX;if(o?(s="mouse"===o||!e.deltaX&&(t.intWheelDeltaY?Math.abs(h)>17:Math.ceil(h)!==h),(e.shiftKey||e.metaKey||e.ctrlKey)&&(s=!0)):s=!e.shiftKey&&(e.metaKey||e.ctrlKey),s){r=a.within(r,0,1);n=1-h/(4*(e.deltaY?i.delta.y:i.delta.x))*r,n<.5&&(n=.5),n>=1.5&&(n=1.5)}return n}},Dd={convert(t){const e=ql.getBase(t);return Object.assign(Object.assign({},e),{code:t.code,key:t.key})}},{getMoveEventData:Md,getZoomEventData:Ad,getRotateEventData:Id,pathCanDrag:Wd}=ql;class Fd extends gd{__listenEvents(){super.__listenEvents();const t=this.view=this.canvas.view;this.viewEvents={pointerdown:this.onPointerDown,mousedown:this.onMouseDown,touchstart:this.onTouchStart,contextmenu:this.onContextMenu,wheel:this.onWheel,gesturestart:this.onGesturestart,gesturechange:this.onGesturechange,gestureend:this.onGestureend},this.windowEvents={pointermove:this.onPointerMove,pointerup:this.onPointerUp,pointercancel:this.onPointerCancel,mousemove:this.onMouseMove,mouseup:this.onMouseUp,touchmove:this.onTouchMove,touchend:this.onTouchEnd,touchcancel:this.onTouchCancel,keydown:this.onKeyDown,keyup:this.onKeyUp,scroll:this.onScroll};const{viewEvents:e,windowEvents:i}=this;for(let i in e)e[i]=e[i].bind(this),t.addEventListener(i,e[i]);for(let t in i)i[t]=i[t].bind(this),window.addEventListener(t,i[t])}__removeListenEvents(){super.__removeListenEvents();const{viewEvents:t,windowEvents:e}=this;for(let e in t)this.view.removeEventListener(e,t[e]),this.viewEvents={};for(let t in e)window.removeEventListener(t,e[t]),this.windowEvents={}}getTouches(t){const e=[];for(let i=0,s=t.length;i<s;i++)e.push(t[i]);return e}preventDefaultPointer(t){const{pointer:e}=this.config;e.preventDefault&&t.preventDefault()}preventDefaultWheel(t){const{wheel:e}=this.config;e.preventDefault&&t.preventDefault()}preventWindowPointer(t){return!this.downData&&t.target!==this.view}onKeyDown(t){this.keyDown(Dd.convert(t))}onKeyUp(t){this.keyUp(Dd.convert(t))}onContextMenu(t){this.config.pointer.preventDefaultMenu&&t.preventDefault(),this.menu(Sd.convert(t,this.getLocal(t)))}onScroll(){this.canvas.updateClientBounds()}onPointerDown(t){this.preventDefaultPointer(t),this.config.pointer.touch||this.useMultiTouch||(this.usePointer||(this.usePointer=!0),this.pointerDown(Sd.convert(t,this.getLocal(t))))}onPointerMove(t){this.config.pointer.touch||this.useMultiTouch||this.preventWindowPointer(t)||(this.usePointer||(this.usePointer=!0),this.pointerMove(Sd.convert(t,this.getLocal(t,!0))))}onPointerUp(t){this.downData&&this.preventDefaultPointer(t),this.config.pointer.touch||this.useMultiTouch||this.preventWindowPointer(t)||this.pointerUp(Sd.convert(t,this.getLocal(t)))}onPointerCancel(){this.useMultiTouch||this.pointerCancel()}onMouseDown(t){this.preventDefaultPointer(t),this.useTouch||this.usePointer||this.pointerDown(Sd.convertMouse(t,this.getLocal(t)))}onMouseMove(t){this.useTouch||this.usePointer||this.preventWindowPointer(t)||this.pointerMove(Sd.convertMouse(t,this.getLocal(t,!0)))}onMouseUp(t){this.downData&&this.preventDefaultPointer(t),this.useTouch||this.usePointer||this.preventWindowPointer(t)||this.pointerUp(Sd.convertMouse(t,this.getLocal(t)))}onMouseCancel(){this.useTouch||this.usePointer||this.pointerCancel()}onTouchStart(t){const e=Sd.getTouch(t),i=this.getLocal(e,!0),{preventDefault:s}=this.config.touch;(!0===s||"auto"===s&&Wd(this.findPath(i)))&&t.preventDefault(),this.multiTouchStart(t),this.usePointer||(this.touchTimer&&(window.clearTimeout(this.touchTimer),this.touchTimer=0),this.useTouch=!0,this.pointerDown(Sd.convertTouch(t,i)))}onTouchMove(t){if(this.multiTouchMove(t),this.usePointer||this.preventWindowPointer(t))return;const e=Sd.getTouch(t);this.pointerMove(Sd.convertTouch(t,this.getLocal(e)))}onTouchEnd(t){if(this.multiTouchEnd(),this.usePointer||this.preventWindowPointer(t))return;this.touchTimer&&clearTimeout(this.touchTimer),this.touchTimer=setTimeout((()=>{this.useTouch=!1}),500);const e=Sd.getTouch(t);this.pointerUp(Sd.convertTouch(t,this.getLocal(e)))}onTouchCancel(){this.usePointer||this.pointerCancel()}multiTouchStart(t){this.useMultiTouch=t.touches.length>1,this.touches=this.useMultiTouch?this.getTouches(t.touches):void 0,this.useMultiTouch&&this.pointerCancel()}multiTouchMove(t){if(this.useMultiTouch&&t.touches.length>1){const e=this.getTouches(t.touches),i=this.getKeepTouchList(this.touches,e);i.length>1&&(this.multiTouch(ql.getBase(t),i),this.touches=e)}}multiTouchEnd(){this.touches=null,this.useMultiTouch=!1,this.transformEnd()}getKeepTouchList(t,e){let i;const s=[];return t.forEach((t=>{i=e.find((e=>e.identifier===t.identifier)),i&&s.push({from:this.getLocal(t),to:this.getLocal(i)})})),s}getLocalTouchs(t){return t.map((t=>this.getLocal(t)))}onWheel(t){this.preventDefaultWheel(t);const{wheel:e}=this.config;if(e.disabled)return;const i=e.getScale?e.getScale(t,e):Ld.getScale(t,e),s=this.getLocal(t),n=ql.getBase(t);1!==i?this.zoom(Ad(s,i,n)):this.move(Md(s,e.getMove?e.getMove(t,e):Ld.getMove(t,e),n))}onGesturestart(t){this.useMultiTouch||(this.preventDefaultWheel(t),this.lastGestureScale=1,this.lastGestureRotation=0)}onGesturechange(t){if(this.useMultiTouch)return;this.preventDefaultWheel(t);const e=this.getLocal(t),i=ql.getBase(t),s=t.scale/this.lastGestureScale,n=t.rotation-this.lastGestureRotation;let{rotateSpeed:o}=this.config.wheel;o=a.within(o,0,1),this.zoom(Ad(e,s*s,i)),this.rotate(Id(e,n/Math.PI*180*(o/4+.1),i)),this.lastGestureScale=t.scale,this.lastGestureRotation=t.rotation}onGestureend(t){this.useMultiTouch||(this.preventDefaultWheel(t),this.transformEnd())}setCursor(t){super.setCursor(t);const e=[];this.eachCursor(t,e),"object"==typeof e[e.length-1]&&e.push("default"),this.canvas.view.style.cursor=e.map((t=>"object"==typeof t?`url(${t.url}) ${t.x||0} ${t.y||0}`:t)).join(",")}eachCursor(t,e,i=0){if(i++,t instanceof Array)t.forEach((t=>this.eachCursor(t,e,i)));else{const s="string"==typeof t&&fd.get(t);s&&i<2?this.eachCursor(s,e,i):e.push(t)}}destroy(){this.view&&(super.destroy(),this.view=null,this.touches=null)}}function zd(t,e){let i;const{rows:s,decorationY:n,decorationHeight:o}=t.__.__textDrawData;for(let t=0,r=s.length;t<r;t++)i=s[t],i.text?e.fillText(i.text,i.x,i.y):i.data&&i.data.forEach((t=>{e.fillText(t.char,t.x,i.y)})),n&&e.fillRect(i.x,i.y+n,i.width,o)}function Nd(t,e,i){const{strokeAlign:s}=e.__,n="string"!=typeof t;switch(s){case"center":i.setStroke(n?void 0:t,e.__.strokeWidth,e.__),n?jd(t,!0,e,i):Xd(e,i);break;case"inside":Yd("inside",t,n,e,i);break;case"outside":Yd("outside",t,n,e,i)}}function Yd(t,e,i,s,n){const{__strokeWidth:o,__font:r}=s.__,a=n.getSameCanvas(!0,!0);a.setStroke(i?void 0:e,2*o,s.__),a.font=r,i?jd(e,!0,s,a):Xd(s,a),a.blendMode="outside"===t?"destination-out":"destination-in",zd(s,a),a.blendMode="normal",s.__worldFlipped?n.copyWorldByReset(a,s.__nowWorld):n.copyWorldToInner(a,s.__nowWorld,s.__layout.renderBounds),a.recycle(s.__nowWorld)}function Xd(t,e){let i;const{rows:s,decorationY:n,decorationHeight:o}=t.__.__textDrawData;for(let t=0,r=s.length;t<r;t++)i=s[t],i.text?e.strokeText(i.text,i.x,i.y):i.data&&i.data.forEach((t=>{e.strokeText(t.char,t.x,i.y)})),n&&e.strokeRect(i.x,i.y+n,i.width,o)}function jd(t,e,i,s){let n;for(let o=0,r=t.length;o<r;o++)n=t[o],n.image&&qa.checkImage(i,s,n,!1)||n.style&&(s.strokeStyle=n.style,n.blendMode?(s.saveBlendMode(n.blendMode),e?Xd(i,s):s.stroke(),s.restoreBlendMode()):e?Xd(i,s):s.stroke())}const{getSpread:Hd,getOuterOf:Ud,getByMove:Vd,getIntersectData:Gd}=nt;let Kd;function qd(t,e,i){if("object"!=typeof e||!1===e.visible||0===e.opacity)return;const{boxBounds:s}=i.__layout;switch(e.type){case"solid":let{type:n,blendMode:o,color:r,opacity:a}=e;return{type:n,blendMode:o,style:Ua.string(r,a)};case"image":return qa.image(i,t,e,s,!Kd||!Kd[e.url]);case"linear":return Za.linearGradient(e,s);case"radial":return Za.radialGradient(e,s);case"angular":return Za.conicGradient(e,s);default:return void 0!==e.r?{type:"solid",style:Ua.string(e)}:void 0}}const Zd={compute:function(t,e){const i=e.__,s=[];let n,o=i.__input[t];o instanceof Array||(o=[o]),Kd=qa.recycleImage(t,i);for(let i,n=0,r=o.length;n<r;n++)i=qd(t,o[n],e),i&&s.push(i);i["_"+t]=s.length?s:void 0,s.length&&s[0].image&&(n=s[0].image.hasOpacityPixel),"fill"===t?i.__pixelFill=n:i.__pixelStroke=n},fill:function(t,e,i){i.fillStyle=t,e.__.__font?zd(e,i):e.__.windingRule?i.fill(e.__.windingRule):i.fill()},fills:function(t,e,i){let s;const{windingRule:n,__font:o}=e.__;for(let r=0,a=t.length;r<a;r++)s=t[r],s.image&&qa.checkImage(e,i,s,!o)||s.style&&(i.fillStyle=s.style,s.transform?(i.save(),i.transform(s.transform),s.blendMode&&(i.blendMode=s.blendMode),o?zd(e,i):n?i.fill(n):i.fill(),i.restore()):s.blendMode?(i.saveBlendMode(s.blendMode),o?zd(e,i):n?i.fill(n):i.fill(),i.restoreBlendMode()):o?zd(e,i):n?i.fill(n):i.fill())},fillText:zd,stroke:function(t,e,i){const s=e.__,{__strokeWidth:n,strokeAlign:o,__font:r}=s;if(n)if(r)Nd(t,e,i);else switch(o){case"center":i.setStroke(t,n,s),i.stroke();break;case"inside":i.save(),i.setStroke(t,2*n,s),s.windingRule?i.clip(s.windingRule):i.clip(),i.stroke(),i.restore();break;case"outside":const o=i.getSameCanvas(!0,!0);o.setStroke(t,2*n,s),e.__drawRenderPath(o),o.stroke(),s.windingRule?o.clip(s.windingRule):o.clip(),o.clearWorld(e.__layout.renderBounds),e.__worldFlipped?i.copyWorldByReset(o,e.__nowWorld):i.copyWorldToInner(o,e.__nowWorld,e.__layout.renderBounds),o.recycle(e.__nowWorld)}},strokes:function(t,e,i){const s=e.__,{__strokeWidth:n,strokeAlign:o,__font:r}=s;if(n)if(r)Nd(t,e,i);else switch(o){case"center":i.setStroke(void 0,n,s),jd(t,!1,e,i);break;case"inside":i.save(),i.setStroke(void 0,2*n,s),s.windingRule?i.clip(s.windingRule):i.clip(),jd(t,!1,e,i),i.restore();break;case"outside":const{renderBounds:o}=e.__layout,r=i.getSameCanvas(!0,!0);e.__drawRenderPath(r),r.setStroke(void 0,2*n,s),jd(t,!1,e,r),s.windingRule?r.clip(s.windingRule):r.clip(),r.clearWorld(o),e.__worldFlipped?i.copyWorldByReset(r,e.__nowWorld):i.copyWorldToInner(r,e.__nowWorld,o),r.recycle(e.__nowWorld)}},strokeText:Nd,drawTextStroke:Xd,shape:function(t,e,i){const s=e.getSameCanvas(),n=t.__nowWorld;let o,r,a,h,{scaleX:l,scaleY:d}=n;if(l<0&&(l=-l),d<0&&(d=-d),e.bounds.includes(n))h=s,o=a=n;else{const{renderShapeSpread:s}=t.__layout,c=Gd(s?Hd(e.bounds,l===d?s*l:[s*d,s*l]):e.bounds,n);r=e.bounds.getFitMatrix(c);let{a:u,d:_}=r;if(r.a<1&&(h=e.getSameCanvas(),t.__renderShape(h,i),l*=u,d*=_),a=Ud(n,r),o=Vd(a,-r.e,-r.f),i.matrix){const{matrix:t}=i;r.multiply(t),u*=t.scaleX,_*=t.scaleY}i=Object.assign(Object.assign({},i),{matrix:r.withScale(u,_)})}return t.__renderShape(s,i),{canvas:s,matrix:r,bounds:o,worldCanvas:h,shapeBounds:a,scaleX:l,scaleY:d}}};let Qd={};const{get:Jd,rotateOfOuter:$d,translate:tc,scaleOfOuter:ec,scale:ic,rotate:sc}=x;function nc(t,e,i,s,n,o,r){const a=Jd();tc(a,e.x+i,e.y+s),ic(a,n,o),r&&$d(a,{x:e.x+e.width/2,y:e.y+e.height/2},r),t.transform=a}function oc(t,e,i,s,n,o,r){const a=Jd();tc(a,e.x+i,e.y+s),n&&ic(a,n,o),r&&sc(a,r),t.transform=a}function rc(t,e,i,s,n,o,r,a,h,l){const d=Jd();if(h)if("center"===l)$d(d,{x:i/2,y:s/2},h);else switch(sc(d,h),h){case 90:tc(d,s,0);break;case 180:tc(d,i,s);break;case 270:tc(d,0,i)}Qd.x=e.x+n,Qd.y=e.y+o,tc(d,Qd.x,Qd.y),r&&ec(d,Qd,r,a),t.transform=d}const{get:ac,translate:hc}=x,lc=new ht,dc={},cc={};function uc(t,e,i,s){const{blendMode:n,sync:o}=i;n&&(t.blendMode=n),o&&(t.sync=o),t.data=_c(i,s,e)}function _c(t,e,i){let{width:s,height:n}=i;t.padding&&(e=lc.set(e).shrink(t.padding)),"strench"===t.mode&&(t.mode="stretch");const{opacity:o,mode:r,align:h,offset:l,scale:d,size:c,rotation:u,repeat:_}=t,p=e.width===s&&e.height===n,g={mode:r},f="center"!==h&&(u||0)%180==90,y=f?n:s,m=f?s:n;let v,w,x=0,b=0;if(r&&"cover"!==r&&"fit"!==r)(d||c)&&(a.getScaleData(d,c,i,cc),v=cc.scaleX,w=cc.scaleY);else if(!p||u){const t=e.width/y,i=e.height/m;v=w="fit"===r?Math.min(t,i):Math.max(t,i),x+=(e.width-s*v)/2,b+=(e.height-n*w)/2}if(h){const t={x:x,y:b,width:y,height:m};v&&(t.width*=v,t.height*=w),yt.toPoint(h,t,e,dc,!0),x+=dc.x,b+=dc.y}switch(l&&(x+=l.x,b+=l.y),r){case"stretch":p||(s=e.width,n=e.height);break;case"normal":case"clip":(x||b||v||u)&&oc(g,e,x,b,v,w,u);break;case"repeat":(!p||v||u)&&rc(g,e,s,n,x,b,v,w,u,h),_||(g.repeat="repeat");break;default:v&&nc(g,e,x,b,v,w,u)}return g.transform||(e.x||e.y)&&(g.transform=ac(),hc(g.transform,e.x,e.y)),v&&"stretch"!==r&&(g.scaleX=v,g.scaleY=w),g.width=s,g.height=n,o&&(g.opacity=o),_&&(g.repeat="string"==typeof _?"x"===_?"repeat-x":"repeat-y":"repeat"),g}let pc,gc=new ht;const{isSame:fc}=nt;function yc(t,e,i,s,n,o){if("fill"===e&&!t.__.__naturalWidth){const e=t.__;if(e.__naturalWidth=s.width/e.pixelRatio,e.__naturalHeight=s.height/e.pixelRatio,e.__autoSide)return t.forceUpdate("width"),t.__proxyData&&(t.setProxyAttr("width",e.width),t.setProxyAttr("height",e.height)),!1}return n.data||uc(n,s,i,o),!0}function mc(t,e){xc(t,jo.LOAD,e)}function vc(t,e){xc(t,jo.LOADED,e)}function wc(t,e,i){e.error=i,t.forceUpdate("surface"),xc(t,jo.ERROR,e)}function xc(t,e,i){t.hasEvent(e)&&t.emitEvent(new jo(e,i))}function bc(t,e){const{leafer:i}=t;i&&i.viewReady&&(i.renderer.ignore=e)}const{get:Bc,scale:Rc,copy:Cc}=x,{ceil:kc,abs:Ec}=Math;function Tc(e,i,s){let{scaleX:n,scaleY:o}=pn.patternLocked?e.__world:e.__nowWorld;const r=n+"-"+o+"-"+s;if(i.patternId===r||e.destroyed)return!1;{n=Ec(n),o=Ec(o);const{image:e,data:a}=i;let h,l,{width:d,height:c,scaleX:u,scaleY:_,opacity:p,transform:g,repeat:f}=a;u&&(l=Bc(),Cc(l,g),Rc(l,1/u,1/_),n*=u,o*=_),n*=s,o*=s,d*=n,c*=o;const y=d*c;if(!f&&y>t.image.maxCacheSize)return!1;let m=t.image.maxPatternSize;if(!e.isSVG){const t=e.width*e.height;m>t&&(m=t)}y>m&&(h=Math.sqrt(y/m)),h&&(n/=h,o/=h,d/=h,c/=h),u&&(n/=u,o/=_),(g||1!==n||1!==o)&&(l||(l=Bc(),g&&Cc(l,g)),Rc(l,1/n,1/o));const v=e.getCanvas(kc(d)||1,kc(c)||1,p),w=e.getPattern(v,f||t.origin.noRepeat||"no-repeat",l,i);return i.style=w,i.patternId=r,!0}}const{abs:Pc}=Math;const Oc={image:function(t,e,i,s,n){let o,r;const a=pn.get(i);return pc&&i===pc.paint&&fc(s,pc.boxBounds)?o=pc.leafPaint:(o={type:i.type,image:a},pc=a.use>1?{leafPaint:o,paint:i,boxBounds:gc.set(s)}:null),(n||a.loading)&&(r={image:a,attrName:e,attrValue:i}),a.ready?(yc(t,e,i,a,o,s),n&&(mc(t,r),vc(t,r))):a.error?n&&wc(t,r,a.error):(n&&(bc(t,!0),mc(t,r)),o.loadId=a.load((()=>{bc(t,!1),t.destroyed||(yc(t,e,i,a,o,s)&&(a.hasOpacityPixel&&(t.__layout.hitCanvasChanged=!0),t.forceUpdate("surface")),vc(t,r)),o.loadId=null}),(e=>{bc(t,!1),wc(t,r,e),o.loadId=null}))),o},checkImage:function(e,i,s,n){const{scaleX:o,scaleY:r}=pn.patternLocked?e.__world:e.__nowWorld,{pixelRatio:a}=i;if(!s.data||s.patternId===o+"-"+r+"-"+a&&!Ja.running)return!1;{const{data:h}=s;if(n)if(h.repeat)n=!1;else{let{width:e,height:i}=h;e*=Pc(o)*a,i*=Pc(r)*a,h.scaleX&&(e*=h.scaleX,i*=h.scaleY),n=e*i>t.image.maxCacheSize||Ja.running}return n?(i.save(),e.windingRule?i.clip(e.windingRule):i.clip(),s.blendMode&&(i.blendMode=s.blendMode),h.opacity&&(i.opacity*=h.opacity),h.transform&&i.transform(h.transform),i.drawImage(s.image.view,0,0,h.width,h.height),i.restore(),!0):(!s.style||s.sync||Ja.running?Tc(e,s,a):s.patternTask||(s.patternTask=pn.patternTasker.add((()=>Nt(this,void 0,void 0,(function*(){s.patternTask=null,i.bounds.hit(e.__nowWorld)&&Tc(e,s,a),e.forceUpdate("surface")}))),300)),!1)}},createPattern:Tc,recycleImage:function(t,e){const i=e["_"+t];if(i instanceof Array){let s,n,o,r;for(let a=0,h=i.length;a<h;a++)s=i[a].image,r=s&&s.url,r&&(n||(n={}),n[r]=!0,pn.recycle(s),s.loading&&(o||(o=e.__input&&e.__input[t]||[],o instanceof Array||(o=[o])),s.unload(i[a].loadId,!o.some((t=>t.url===r)))));return n}return null},createData:uc,getPatternData:_c,fillOrFitMode:nc,clipMode:oc,repeatMode:rc},{toPoint:Sc}=pt,Lc={},Dc={};function Mc(t,e,i){if(e){let s;for(let n=0,o=e.length;n<o;n++)s=e[n],"string"==typeof s?t.addColorStop(n/(o-1),Ua.string(s,i)):t.addColorStop(s.offset,Ua.string(s.color,i))}}const{getAngle:Ac,getDistance:Ic}=L,{get:Wc,rotateOfOuter:Fc,scaleOfOuter:zc}=x,{toPoint:Nc}=pt,Yc={},Xc={};function jc(t,e,i,s,n){let o;const{width:r,height:a}=t;if(r!==a||s){const t=Ac(e,i);o=Wc(),n?(zc(o,e,r/a*(s||1),1),Fc(o,e,t+90)):(zc(o,e,1,r/a*(s||1)),Fc(o,e,t))}return o}const{getDistance:Hc}=L,{toPoint:Uc}=pt,Vc={},Gc={};const Kc={linearGradient:function(e,i){let{from:s,to:n,type:o,blendMode:r,opacity:a}=e;Sc(s||"top",i,Lc),Sc(n||"bottom",i,Dc);const h=t.canvas.createLinearGradient(Lc.x,Lc.y,Dc.x,Dc.y);Mc(h,e.stops,a);const l={type:o,style:h};return r&&(l.blendMode=r),l},radialGradient:function(e,i){let{from:s,to:n,type:o,opacity:r,blendMode:a,stretch:h}=e;Nc(s||"center",i,Yc),Nc(n||"bottom",i,Xc);const l=t.canvas.createRadialGradient(Yc.x,Yc.y,0,Yc.x,Yc.y,Ic(Yc,Xc));Mc(l,e.stops,r);const d={type:o,style:l},c=jc(i,Yc,Xc,h,!0);return c&&(d.transform=c),a&&(d.blendMode=a),d},conicGradient:function(e,i){let{from:s,to:n,type:o,opacity:r,blendMode:a,stretch:h}=e;Uc(s||"center",i,Vc),Uc(n||"bottom",i,Gc);const l=t.conicGradientSupport?t.canvas.createConicGradient(0,Vc.x,Vc.y):t.canvas.createRadialGradient(Vc.x,Vc.y,0,Vc.x,Vc.y,Hc(Vc,Gc));Mc(l,e.stops,r);const d={type:o,style:l},c=jc(i,Vc,Gc,h||1,t.conicGradientRotate90);return c&&(d.transform=c),a&&(d.blendMode=a),d},getTransform:jc},{copy:qc,toOffsetOutBounds:Zc}=nt,Qc={},Jc={};function $c(e,i,s,n){const{bounds:o,shapeBounds:r}=n;if(t.fullImageShadow){if(qc(Qc,e.bounds),Qc.x+=i.x-r.x,Qc.y+=i.y-r.y,s){const{matrix:t}=n;Qc.x-=(o.x+(t?t.e:0)+o.width/2)*(s-1),Qc.y-=(o.y+(t?t.f:0)+o.height/2)*(s-1),Qc.width*=s,Qc.height*=s}e.copyWorld(n.canvas,e.bounds,Qc)}else s&&(qc(Qc,i),Qc.x-=i.width/2*(s-1),Qc.y-=i.height/2*(s-1),Qc.width*=s,Qc.height*=s),e.copyWorld(n.canvas,r,s?Qc:i)}const{toOffsetOutBounds:tu}=nt,eu={};const iu={shadow:function(t,e,i){let s,n;const{__nowWorld:o,__layout:r}=t,{shadow:a}=t.__,{worldCanvas:h,bounds:l,shapeBounds:d,scaleX:c,scaleY:u}=i,_=e.getSameCanvas(),p=a.length-1;Zc(l,Jc),a.forEach(((a,g)=>{_.setWorldShadow(Jc.offsetX+a.x*c,Jc.offsetY+a.y*u,a.blur*c,a.color),n=a.spread?1+2*a.spread/(r.boxBounds.width+2*(r.strokeBoxSpread||0)):0,$c(_,Jc,n,i),s=l,a.box&&(_.restore(),_.save(),h&&(_.copyWorld(_,l,o,"copy"),s=o),h?_.copyWorld(h,o,o,"destination-out"):_.copyWorld(i.canvas,d,l,"destination-out")),t.__worldFlipped?e.copyWorldByReset(_,s,o,a.blendMode):e.copyWorldToInner(_,s,r.renderBounds,a.blendMode),p&&g<p&&_.clearWorld(s,!0)})),_.recycle(s)},innerShadow:function(t,e,i){let s,n;const{__nowWorld:o,__layout:r}=t,{innerShadow:a}=t.__,{worldCanvas:h,bounds:l,shapeBounds:d,scaleX:c,scaleY:u}=i,_=e.getSameCanvas(),p=a.length-1;tu(l,eu),a.forEach(((a,g)=>{_.save(),_.setWorldShadow(eu.offsetX+a.x*c,eu.offsetY+a.y*u,a.blur*c),n=a.spread?1-2*a.spread/(r.boxBounds.width+2*(r.strokeBoxSpread||0)):0,$c(_,eu,n,i),_.restore(),h?(_.copyWorld(_,l,o,"copy"),_.copyWorld(h,o,o,"source-out"),s=o):(_.copyWorld(i.canvas,d,l,"source-out"),s=l),_.fillWorld(s,a.color,"source-in"),t.__worldFlipped?e.copyWorldByReset(_,s,o,a.blendMode):e.copyWorldToInner(_,s,r.renderBounds,a.blendMode),p&&g<p&&_.clearWorld(s,!0)})),_.recycle(s)},blur:function(t,e,i){const{blur:s}=t.__;i.setWorldBlur(s*t.__nowWorld.a),i.copyWorldToInner(e,t.__nowWorld,t.__layout.renderBounds),i.filter="none"},backgroundBlur:function(t,e,i){}},{excludeRenderBounds:su}=Ro;function nu(t,e,i,s,n,o){switch(e){case"alpha":!function(t,e,i,s){const n=t.__nowWorld;i.resetTransform(),i.opacity=1,i.useMask(s,n),s.recycle(n),ru(t,e,i,1)}(t,i,s,n);break;case"opacity-path":ru(t,i,s,o);break;case"path":i.restore()}}function ou(t){return t.getSameCanvas(!1,!0)}function ru(t,e,i,s){const n=t.__nowWorld;e.resetTransform(),e.opacity=s,e.copyWorld(i,n),i.recycle(n)}Eh.prototype.__renderMask=function(t,e){let i,s,n,o,r;const{children:a}=this;for(let h=0,l=a.length;h<l;h++)i=a[h],i.__.mask&&(r&&(nu(this,r,t,n,s,o),s=n=null),"path"===i.__.mask?(i.opacity<1?(r="opacity-path",o=i.opacity,n||(n=ou(t))):(r="path",t.save()),i.__clip(n||t,e)):(r="alpha",s||(s=ou(t)),n||(n=ou(t)),i.__render(s,e)),"clipping"!==i.__.mask)||su(i,e)||i.__render(n||t,e);nu(this,r,t,n,s,o)};const au=">)]}%!?,.:;'\"",hu=au+"_#~&*+\\=|",lu=new RegExp([[19968,40959],[13312,19903],[131072,173791],[173824,177983],[177984,178207],[178208,183983],[183984,191471],[196608,201551],[201552,205743],[11904,12031],[12032,12255],[12272,12287],[12288,12351],[12736,12783],[12800,13055],[13056,13311],[63744,64255],[65072,65103],[127488,127743],[194560,195103]].map((([t,e])=>`[\\u${t.toString(16)}-\\u${e.toString(16)}]`)).join("|"));function du(t){const e={};return t.split("").forEach((t=>e[t]=!0)),e}const cu=du("ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz"),uu=du("{[(<'\""),_u=du(au),pu=du(hu),gu=du("- ");var fu;!function(t){t[t.Letter=0]="Letter",t[t.Single=1]="Single",t[t.Before=2]="Before",t[t.After=3]="After",t[t.Symbol=4]="Symbol",t[t.Break=5]="Break"}(fu||(fu={}));const{Letter:yu,Single:mu,Before:vu,After:wu,Symbol:xu,Break:bu}=fu;function Bu(t){return cu[t]?yu:gu[t]?bu:uu[t]?vu:_u[t]?wu:pu[t]?xu:lu.test(t)?mu:yu}const Ru={trimRight(t){const{words:e}=t;let i,s=0,n=e.length;for(let o=n-1;o>-1&&(i=e[o].data[0]," "===i.char);o--)s++,t.width-=i.width;s&&e.splice(n-s,s)}};function Cu(t,e,i){switch(e){case"title":return i?t.toUpperCase():t;case"upper":return t.toUpperCase();case"lower":return t.toLowerCase();default:return t}}const{trimRight:ku}=Ru,{Letter:Eu,Single:Tu,Before:Pu,After:Ou,Symbol:Su,Break:Lu}=fu;let Du,Mu,Au,Iu,Wu,Fu,zu,Nu,Yu,Xu,ju,Hu,Uu,Vu,Gu,Ku,qu,Zu=[];function Qu(t,e){Yu&&!Nu&&(Nu=Yu),Du.data.push({char:t,width:e}),Au+=e}function Ju(){Iu+=Au,Du.width=Au,Mu.words.push(Du),Du={data:[]},Au=0}function $u(){Vu&&(Gu.paraNumber++,Mu.paraStart=!0,Vu=!1),Yu&&(Mu.startCharSize=Nu,Mu.endCharSize=Yu,Nu=0),Mu.width=Iu,Ku.width?ku(Mu):qu&&t_(),Zu.push(Mu),Mu={words:[]},Iu=0}function t_(){Iu>(Gu.maxWidth||0)&&(Gu.maxWidth=Iu)}const e_=0,i_=1,s_=2;const{top:n_,right:o_,bottom:r_,left:a_}=ct;function h_(t,e,i){const{bounds:s,rows:n}=t;s[e]+=i;for(let t=0;t<n.length;t++)n[t][e]+=i}const l_={getDrawData:function(e,i){"string"!=typeof e&&(e=String(e));let s=0,n=0,o=i.__getInput("width")||0,r=i.__getInput("height")||0;const{textDecoration:a,__font:h,__padding:l}=i;l&&(o?(s=l[a_],o-=l[o_]+l[a_]):i.autoSizeAlign||(s=l[a_]),r?(n=l[n_],r-=l[n_]+l[r_]):i.autoSizeAlign||(n=l[n_]));const d={bounds:{x:s,y:n,width:o,height:r},rows:[],paraNumber:0,font:t.canvas.font=h};return function(e,i,s){Gu=e,Zu=e.rows,Ku=e.bounds,qu=!Ku.width&&!s.autoSizeAlign;const{__letterSpacing:n,paraIndent:o,textCase:r}=s,{canvas:a}=t,{width:h,height:l}=Ku;if(h||l||n||"none"!==r){const t="none"!==s.textWrap,e="break"===s.textWrap;Vu=!0,ju=null,Nu=zu=Yu=Au=Iu=0,Du={data:[]},Mu={words:[]};for(let s=0,l=i.length;s<l;s++)Fu=i[s],"\n"===Fu?(Au&&Ju(),Mu.paraEnd=!0,$u(),Vu=!0):(Xu=Bu(Fu),Xu===Eu&&"none"!==r&&(Fu=Cu(Fu,r,!Au)),zu=a.measureText(Fu).width,n&&(n<0&&(Yu=zu),zu+=n),Hu=Xu===Tu&&(ju===Tu||ju===Eu)||ju===Tu&&Xu!==Ou,Uu=!(Xu!==Pu&&Xu!==Tu||ju!==Su&&ju!==Ou),Wu=Vu&&o?h-o:h,t&&h&&Iu+Au+zu>Wu&&(e?(Au&&Ju(),Iu&&$u()):(Uu||(Uu=Xu===Eu&&ju==Ou),Hu||Uu||Xu===Lu||Xu===Pu||Xu===Tu||Au+zu>Wu?(Au&&Ju(),Iu&&$u()):Iu&&$u()))," "===Fu&&!0!==Vu&&Iu+Au===0||(Xu===Lu?(" "===Fu&&Au&&Ju(),Qu(Fu,zu),Ju()):Hu||Uu?(Au&&Ju(),Qu(Fu,zu)):Qu(Fu,zu)),ju=Xu);Au&&Ju(),Iu&&$u(),Zu.length>0&&(Zu[Zu.length-1].paraEnd=!0)}else i.split("\n").forEach((t=>{Gu.paraNumber++,Iu=a.measureText(t).width,Zu.push({x:o||0,text:t,width:Iu,paraStart:!0}),qu&&t_()}))}(d,e,i),l&&function(t,e,i,s,n){if(!s&&i.autoSizeAlign)switch(i.textAlign){case"left":h_(e,"x",t[a_]);break;case"right":h_(e,"x",-t[o_])}if(!n&&i.autoSizeAlign)switch(i.verticalAlign){case"top":h_(e,"y",t[n_]);break;case"bottom":h_(e,"y",-t[r_])}}(l,d,i,o,r),function(t,e){const{rows:i,bounds:s}=t,{__lineHeight:n,__baseLine:o,__letterSpacing:r,__clipText:a,textAlign:h,verticalAlign:l,paraSpacing:d,autoSizeAlign:c}=e;let{x:u,y:_,width:p,height:g}=s,f=n*i.length+(d?d*(t.paraNumber-1):0),y=o;if(a&&f>g)f=Math.max(g,n),t.overflow=i.length;else if(g||c)switch(l){case"middle":_+=(g-f)/2;break;case"bottom":_+=g-f}y+=_;let m,v,w,x=p||c?p:t.maxWidth;for(let o=0,l=i.length;o<l;o++){if(m=i[o],m.x=u,m.width<p||m.width>p&&!a)switch(h){case"center":m.x+=(x-m.width)/2;break;case"right":m.x+=x-m.width}m.paraStart&&d&&o>0&&(y+=d),m.y=y,y+=n,t.overflow>o&&y>f&&(m.isOverflow=!0,t.overflow=o+1),v=m.x,w=m.width,r<0&&(m.width<0?(w=-m.width+e.fontSize+r,v-=w,w+=e.fontSize):w-=r),v<s.x&&(s.x=v),w>s.width&&(s.width=w),a&&p&&p<w&&(m.isOverflow=!0,t.overflow||(t.overflow=i.length))}s.y=_,s.height=f}(d,i),function(t,e,i,s){const{rows:n}=t,{textAlign:o,paraIndent:r,letterSpacing:a}=e;let h,l,d,c,u;n.forEach((t=>{t.words&&(d=r&&t.paraStart?r:0,l=i&&"justify"===o&&t.words.length>1?(i-t.width-d)/(t.words.length-1):0,c=a||t.isOverflow?e_:l>.01?i_:s_,t.isOverflow&&!a&&(t.textMode=!0),c===s_?(t.x+=d,function(t){t.text="",t.words.forEach((e=>{e.data.forEach((e=>{t.text+=e.char}))}))}(t)):(t.x+=d,h=t.x,t.data=[],t.words.forEach((e=>{c===i_?(u={char:"",x:h},h=function(t,e,i){return t.forEach((t=>{i.char+=t.char,e+=t.width})),e}(e.data,h,u),(t.isOverflow||" "!==u.char)&&t.data.push(u)):h=function(t,e,i,s){return t.forEach((t=>{(s||" "!==t.char)&&(t.x=e,i.push(t)),e+=t.width})),e}(e.data,h,t.data,t.isOverflow),!t.paraEnd&&l&&(h+=l,t.width+=l)}))),t.words=null)}))}(d,i,o),d.overflow&&function(e,i,s,n){if(!n)return;const{rows:o,overflow:r}=e;let{textOverflow:a}=i;if(o.splice(r),a&&"show"!==a){let e,h;"hide"===a?a="":"ellipsis"===a&&(a="...");const l=a?t.canvas.measureText(a).width:0,d=s+n-l;("none"===i.textWrap?o:[o[r-1]]).forEach((t=>{if(t.isOverflow&&t.data){let i=t.data.length-1;for(let s=i;s>-1&&(e=t.data[s],h=e.x+e.width,!(s===i&&h<d));s--){if(h<d&&" "!==e.char){t.data.splice(s+1),t.width-=e.width;break}t.width-=e.width}t.width+=l,t.data.push({char:a,x:h}),t.textMode&&function(t){t.text="",t.data.forEach((e=>{t.text+=e.char})),t.data=null}(t)}}))}}(d,i,s,o),"none"!==a&&function(t,e){const{fontSize:i}=e;switch(t.decorationHeight=i/11,e.textDecoration){case"under":t.decorationY=.15*i;break;case"delete":t.decorationY=.35*-i}}(d,i),d}};const d_={string:function(t,e){const i="number"==typeof e&&1!==e;if("string"==typeof t){if(!i||!Ua.object)return t;t=Ua.object(t)}let s=void 0===t.a?1:t.a;i&&(s*=e);const n=t.r+","+t.g+","+t.b;return 1===s?"rgb("+n+")":"rgba("+n+","+s+")"}},{setPoint:c_,addPoint:u_,toBounds:__}=Y;const p_={export(i,s,n){this.running=!0;const o=ln.fileType(s),r=s.includes(".");return n=ln.getExportOptions(n),function(t){g_||(g_=new _n);return new Promise((e=>{g_.add((()=>Nt(this,void 0,void 0,(function*(){return yield t(e)}))),{parallel:!1})}))}((h=>new Promise((l=>{const d=t=>{h(t),l(),this.running=!1},{toURL:c}=t,{download:u}=t.origin;if("json"===o)return r&&u(c(JSON.stringify(i.toJSON(n.json)),"text"),s),d({data:!!r||i.toJSON(n.json)});if("svg"===o)return r&&u(c(i.toSVG(),"svg"),s),d({data:!!r||i.toSVG()});const{leafer:_}=i;_?(f_(i),_.waitViewCompleted((()=>Nt(this,void 0,void 0,(function*(){let t,o,r=1,h=1;const{worldTransform:l,isLeafer:c,isFrame:u}=i,{slice:p,trim:g,onCanvas:f}=n,y=void 0===n.smooth?_.config.smooth:n.smooth,m=n.contextSettings||_.config.contextSettings,v=n.screenshot||i.isApp,w=c&&v&&void 0===n.fill?i.fill:n.fill,x=ln.isOpaqueImage(s)||w,b=new z;if(v)t=!0===v?c?_.canvas.bounds:i.worldRenderBounds:v;else{let e=n.relative||(c?"inner":"local");switch(r=l.scaleX,h=l.scaleY,e){case"inner":b.set(l);break;case"local":b.set(l).divide(i.localTransform),r/=i.scaleX,h/=i.scaleY;break;case"world":r=1,h=1;break;case"page":e=i.leafer;default:b.set(l).divide(i.getTransform(e));const t=e.worldTransform;r/=r/t.scaleX,h/=h/t.scaleY}t=i.getBounds("render",e)}const B={scaleX:1,scaleY:1};a.getScaleData(n.scale,n.size,t,B);let R=n.pixelRatio||1;i.isApp&&(B.scaleX*=R,B.scaleY*=R,R=i.app.pixelRatio);const{x:C,y:k,width:E,height:T}=new ht(t).scale(B.scaleX,B.scaleY),P={matrix:b.scale(1/B.scaleX,1/B.scaleY).invert().translate(-C,-k).withScale(1/r*B.scaleX,1/h*B.scaleY)};let O,S=e.canvas({width:Math.round(E),height:Math.round(T),pixelRatio:R,smooth:y,contextSettings:m});if(p&&(O=i,O.__worldOpacity=0,i=_,P.bounds=S.bounds),S.save(),u&&void 0!==w){const t=i.get("fill");i.fill="",i.__render(S,P),i.fill=t}else i.__render(S,P);if(S.restore(),O&&O.__updateWorldOpacity(),g){o=function(t){const{width:e,height:i}=t.view,{data:s}=t.context.getImageData(0,0,e,i);let n,o,r,a=0;for(let t=0;t<s.length;t+=4)0!==s[t+3]&&(n=a%e,o=(a-n)/e,r?u_(r,n,o):c_(r={},n,o)),a++;const h=new ht;return __(r,h),h.scale(1/t.pixelRatio).ceil()}(S);const t=S,{width:i,height:s}=o,n={x:0,y:0,width:i,height:s,pixelRatio:R};S=e.canvas(n),S.copyWorld(t,o,n)}x&&S.fillWorld(S.bounds,w||"#FFFFFF","destination-over"),f&&f(S);const L="canvas"===s?S:yield S.export(s,n);d({data:L,width:S.pixelWidth,height:S.pixelHeight,renderBounds:t,trimBounds:o})}))))):d({data:!1})}))))}};let g_;function f_(t){t.__.__needComputePaint&&t.__.__computePaint(),t.isBranch&&t.children.forEach((t=>f_(t)))}const y_=qt.prototype,m_=vt.get("@leafer-ui/export");y_.export=function(t,e){const{quality:i,blob:s}=ln.getExportOptions(e);return t.includes(".")?this.saveAs(t,i):s?this.toBlob(t,i):this.toDataURL(t,i)},y_.toBlob=function(e,i){return new Promise((s=>{t.origin.canvasToBolb(this.view,e,i).then((t=>{s(t)})).catch((t=>{m_.error(t),s(null)}))}))},y_.toDataURL=function(e,i){return t.origin.canvasToDataURL(this.view,e,i)},y_.saveAs=function(e,i){return new Promise((s=>{t.origin.canvasSaveAs(this.view,e,i).then((()=>{s(!0)})).catch((t=>{m_.error(t),s(!1)}))}))},Object.assign(Ha,l_),Object.assign(Ua,d_),Object.assign(Ka,Zd),Object.assign(qa,Oc),Object.assign(Za,Kc),Object.assign(Qa,iu),Object.assign(Ja,p_),Object.assign(e,{interaction:(t,e,i,s)=>new Fd(t,e,i,s),hitCanvas:(t,e)=>new ua(t,e),hitCanvasManager:()=>new yd}),ga();export{yt as AlignHelper,It as Answer,kl as App,pt as AroundHelper,dt as AutoBounds,Re as BezierHelper,ht as Bounds,nt as BoundsHelper,Fh as Box,ah as BoxData,aa as Branch,ko as BranchHelper,Tr as BranchRender,yl as Canvas,wh as CanvasData,Lt as CanvasManager,Yo as ChildEvent,Ua as ColorConvert,e as Creator,fd as Cursor,Dt as DataHelper,vt as Debug,ct as Direction4,ut as Direction9,Ml as DragEvent,Il as DropEvent,Qa as Effect,jh as Ellipse,uh as EllipseData,De as EllipseHelper,No as Event,Ot as EventCreator,Zo as Eventer,Ja as Export,ln as FileHelper,zh as Frame,lh as FrameData,Eh as Group,rh as GroupData,yd as HitCanvasManager,gl as Image,vh as ImageData,jo as ImageEvent,pn as ImageManager,i as IncrementId,Fd as Interaction,gd as InteractionBase,ql as InteractionHelper,Yl as KeyEvent,Tl as Keyboard,Vo as LayoutEvent,Pa as Layouter,Jr as Leaf,Cr as LeafBounds,Ro as LeafBoundsHelper,At as LeafData,dr as LeafDataProxy,ar as LeafEventer,fo as LeafHelper,zo as LeafLayout,la as LeafLevelList,ha as LeafList,yr as LeafMatrix,kr as LeafRender,Oh as Leafer,ua as LeaferCanvas,qt as LeaferCanvasBase,hh as LeaferData,Ko as LeaferEvent,mn as LeaferImage,Hl as LeaferTypeCreator,Jh as Line,dh as LineData,a as MathHelper,z as Matrix,x as MatrixHelper,Wl as MoveEvent,ad as MultiTouchHelper,Al as MyDragEvent,fl as MyImage,Ll as MyPointerEvent,te as NeedConvertToCanvasCommandMap,h as OneRadian,l as PI2,d as PI_2,Ka as Paint,Za as PaintGradient,qa as PaintImage,Rl as Path,Ga as PathArrow,Zs as PathBounds,Ni as PathCommandDataHelper,Jt as PathCommandMap,yi as PathConvert,on as PathCorner,ss as PathCreator,gh as PathData,ms as PathDrawer,Zt as PathHelper,ne as PathNumberCommandLengthMap,se as PathNumberCommandMap,Cl as Pen,fh as PenData,t as Platform,W as Point,L as PointHelper,Pl as PointerButton,Sl as PointerEvent,al as Polygon,_h as PolygonData,Xo as PropertyEvent,Sh as Rect,ch as RectData,oe as RectHelper,Rh as RectRender,Go as RenderEvent,Sa as Renderer,Ho as ResizeEvent,Fl as RotateEvent,Bt as Run,Na as Selector,pl as Star,ph as StarData,$a as State,mt as StringNumberMap,zl as SwipeEvent,un as TaskItem,_n as TaskProcessor,Bl as Text,Ha as TextConvert,mh as TextData,th as Transition,Y as TwoPointBoundsHelper,kh as UI,xh as UIBounds,Et as UICreator,oh as UIData,Ol as UIEvent,bh as UIRender,Va as UnitConvert,Oo as WaitHelper,Uo as WatchEvent,ya as Watcher,Nl as ZoomEvent,Xl as addInteractionWindow,Wn as affectRenderBoundsType,Mn as affectStrokeBoundsType,bn as attr,kn as autoLayoutType,Pn as boundsType,hn as canvasPatch,Kt as canvasSizeAttrs,Vn as cursorType,Gn as dataProcessor,Rn as dataType,xn as decorateLeafAttr,qn as defineDataProcessor,vn as defineKey,Bn as defineLeafAttr,Sn as doBoundsType,An as doStrokeType,Ya as effectType,Wt as emptyData,Hn as eraserType,u as getBoundsData,wn as getDescriptor,_ as getMatrixData,c as getPointData,Un as hitType,Ft as isNull,Kn as layoutProcessor,jn as maskType,On as naturalBoundsType,Ct as needPlugin,zn as opacityType,Ln as pathInputType,Dn as pathType,rn as pen,Cn as positionType,so as registerUI,no as registerUIEvent,Xa as resizeType,$n as rewrite,to as rewriteAble,Tn as rotationType,En as scaleType,Xn as sortType,In as strokeType,Fn as surfaceType,lt as tempBounds,N as tempMatrix,F as tempPoint,ga as useCanvas,io as useModule,da as version,Nn as visibleType,ja as zoomLayerType};
